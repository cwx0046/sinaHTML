<!DOCTYPE html>
<html>
<head>
<meta charset="GB2312">
<meta http-equiv="X-UA-Compatible" content="IE=8" />
<title>翻牌游戏</title>

<script src="http://i2.sinaimg.cn/cj/dfz/js/base.js" type="text/javascript"></script>
<script type="text/javascript" src="http://jiangsu.sinaimg.cn/z/js/weiboApi.js" charset="utf-8"></script>
<script type="text/javascript" src="http://i.sso.sina.com.cn/js/ssologin.js" charset="utf-8"></script>
<script type="text/javascript" src="http://i.sso.sina.com.cn/js/sinaSSOManager.js" charset="utf-8"></script>
<script type="text/javascript" src="http://ria.city.sina.com.cn/s/g=dialog_login_v1.1-sp1.js"></script>
<link type="text/css" href="http://ria.city.sina.com.cn/s/g=dialog_login_v1.1-sp1.css" rel="stylesheet" media="all" />

<style type="text/css">
body, ul, ol, li, p, h1, h2, h3, h4, h5, h6, table, td, th, form, fieldset, img, dl, dt, dd { margin:0; padding:0; }
textarea, input, select, body { font-size:12px; }
select, input { vertical-align:middle; }
fieldset, img { border:0; }
ul, ol { list-style:none; }
img { border:0; }
a { text-decoration:none; color:#000; }
a:hover { color:#ffa10d; }
.fl { float:left; display:inline; }
.fr { float:right; display:inline; }
.cb { clear:both; display:block; height:0px; overflow:hidden; width:100%; }
.clearfix:after { clear:both; content:""; display:block; height:0; }
</style>
<style type="text/css">
.headimg{ min-width: 1000px; height: 400px; background: url("http://hubei.sinaimg.cn/2014/0721/S122974T1405906828814.jpg") no-repeat center top;}
.content{ width: 1000px; margin: 0 auto; } 

#partCardGame{
	position: relative;
	width: 1030px;
	height: 500px;
	padding: 9px;
	background: url("http://s3img.city.sina.com.cn/activity/common/large/05138347472364a46edc03d67e21f08c.jpg") no-repeat;
}
#gameblock{
	width: 624px;
	height: 424px;
}

#gamehover{
	position: absolute;
	top: 10px;
	left: 10px;
	width: 621px;
	height: 480px;
	z-index: 2;
	display: none; 
	/* background: #ba8baf; */
	/* background-color: RGBA(255,255,0,.9); */
}
.card{
	width: 153px;
	height: 158px;
	background-color: #00F;
	float: left;
	margin: 1px 2px 2px 1px;
	background: url("http://s3img.city.sina.com.cn/activity/common/large/7d3f48533a5699d67858f64e23d1cce4.jpg") no-repeat;
	cursor: pointer;
}
.card:hover{
	border: 1px solid #86aeef ;
	margin: 0 1px 1px 0;
}
	

.card img{
	display: none;
}

#gametitle, #gametext{
	position: absolute;
	left: 650px;
	top: 100px;
	color: #FFF;
	font-family: "microsoft yahei";
	font-size: 35px;
	font-weight: bold;
	width: 366px;
	text-align: center;
}
#gametext{
	top: 174px;
	font-weight: normal;
	font-size: 16px;
	line-height: 28px;
	text-indent: 2em;
	width: 366px;
	text-align: left;
}

#step {
	font-size: 76px;
	left: 872px;
	top: 371px;
	color: #FFF;
	width: 100px;
	height: 100px;
	text-align: center;
	line-height: 100px;
	position: absolute;
	font-weight: bold;
}

input[type=button]:disabled{
cursor: default;
}
</style>
</head>
<body>
<div id="partCardGame">
	<div id="gameblock">
		<ul id="gameul">
			<li class="card"><img alt="" src=""></li>
			<li class="card"><img alt="" src=""></li>
			<li class="card"><img alt="" src=""></li>
			<li class="card"><img alt="" src=""></li>
			<li class="card"><img alt="" src=""></li>
			<li class="card"><img alt="" src=""></li>

			<li class="card"><img alt="" src=""></li>
			<li class="card"><img alt="" src=""></li>
			<li class="card"><img alt="" src=""></li>
			<li class="card"><img alt="" src=""></li>
			<li class="card"><img alt="" src=""></li>
			<li class="card"><img alt="" src=""></li>
		</ul>
		<div id="gamehover">
			<style>
						#gamehover{font-family: "microsoft yahei"; }
#gamehover p{ margin-top:152px;margin-bottom:54px; padding: 0 62px; font-family: "楷体"; font-size:28px; font-weight:bold; color:#f67a00; line-height:52px;}
						.btn{ width: 106px; height:36px; line-height:36xp; font-size:14px; color:#FFF; font-family: "microsoft yahei"; background:url("http://jiangsu.sinaimg.cn/2014/0804/U9263P1194DT20140804095834.png"); border:none; cursor:pointer; }
						</style>
			<p>亲，恭喜您在<span id="steptext">0</span>步完成了所有的翻牌。分享微博才有机会获奖哦！</p>
			<div style="text-align:center;">
			<input id="submitbtn" class="btn" type="button" onclick="sendweibo()" value="分享微博">
			<input class="btn" type="button" onclick="onceagain()" value="再次挑战">
			</div>
		</div>
	</div>
</div>
<p id="gametitle">免费赢昆山特色礼包</p>
<p id="gametext">点击左侧卡片每次最多翻开2张卡片，若翻开的2张卡片相同，即可看到相应的图片。所有卡片都被翻开，游戏结束。完成游戏并分享微博即可成功报名甄选【新浪旅行家】，还有机会获得<span style="color:#F00;">昆山特色礼包</span>一份哟！（获奖名单请关注 @玩转昆山 @新浪江苏旅游 官方微博）</p>
<div id="step">0</div>

<script type="text/javascript">
	$(function() {
		$("#gameul").cardgame();
	});
	
	
	$.fn.cardgame = function () {
		$(this).each(function() {
			
			//对象
			var gameul = $(this);//
			var li = gameul.find("li");
			
 			//定义已翻开卡牌
 			var visibleCardList = [];
 			var cardshow = [];
 			
 			//计数器
 			var step = 0;
 			
			//初始化图片列表
			li.find("img").hide();
			var imglist = getRandomImgList();
			for (var i = 0; i < li.length; i++) {
				li[i].innerHTML = '<img alt="" src="'+imglist[i]+'">';
			}
			
 
			li.bind("click", function() {
				var cardIndex = li.index($(this));
				/* 已翻开的卡牌没有响应 */
				if (isExistInArray(cardIndex, visibleCardList)) {
					return;
				}
				/* 翻开卡牌 */
				$(this).find("img").stop(true,true).show();
				cardshow.push(cardIndex);
				visibleCardList.push(cardIndex);
				step++;
				$("#step").html(step);
				
				/* 如果已经有2张卡翻开，进行相同对比 */
				if(cardshow.length == 2){
					var card1src = li.slice(cardshow[0], cardshow[0]+1).find("img").attr("src");
					var card2src = $(this).find("img").attr("src");
					
					/* 相同 */
					if(card1src == card2src){
						/* 清空临时翻卡 */
						cardshow = [];
						
						/* 完成  */
						if (visibleCardList.length == li.length) {
							//alert("完成！ 您用了 "+step+" 步");

$("#gameul").fadeOut(600);
							$("#gamehover").show(600);
$("#steptext").html($("#step").html());
							$("#gamehovertext").html("完成！ 您用了 "+step+" 步");
							$("#submitbtn").removeAttr("disabled");
							// 清空初始化
							//resetGame();
						}
						
						/* 结束退出 */
						return;
					}else{
						//不相同
						/* 隐藏图片 */
						li.slice(cardshow[0], cardshow[0]+1).find("img").stop(true,true).delay(300).fadeOut(600);
						$(this).find("img").stop(true,true).delay(300).fadeOut(600);
						
						/* 清空临时翻卡 */
						cardshow = [];
						visibleCardList.splice(visibleCardList.length-2,2); //移除刚刚翻出的2张卡
					}					
				}
			});
			
			
			function resetGame(){
				visibleCardList=[];
				cardshow = [];
				li.find("img").hide();
				step = 0;
				$("#step").html(step);
				imglist = getRandomImgList();
				for (var i = 0; i < li.length; i++) {
					li[i].innerHTML = '<img alt="" src="'+imglist[i]+'">';
				}
			}
		});
	}
	/* 开始新的游戏 */
	function onceagain() {
		$("#gameul").cardgame();
$("#gameul").fadeIn(600);
							$("#gamehover").hide(600);
	}
	
	/* 数组中是否存在 */
	function isExistInArray(obj, array){
		for (index in array) {
			if (array[index] == obj) {
				return true;
			}
		}
		return false;
	}
	
	
	/* 初始化并打乱图片列表 */
	function getRandomImgList(){
		var imgList = [];
		imgList[0] = "http://s3img.city.sina.com.cn/activity/common/large/6cf3129210e24100bf216066578a390e.jpg";
		imgList[1] = "http://s3img.city.sina.com.cn/activity/common/large/e86aa779758532d62670931d3dde1d3d.jpg";
		imgList[2] = "http://s3img.city.sina.com.cn/activity/common/large/2dabd04a6fd07c56571ebbb9867d8502.jpg";
		imgList[3] = "http://s3img.city.sina.com.cn/activity/common/large/ea9b08b5a7b0a6b759c1fc9aa1b61837.jpg";
		imgList[4] = "http://s3img.city.sina.com.cn/activity/common/large/c790b87c74fdf8a3035719ff2cc341a1.jpg";
		imgList[5] = "http://s3img.city.sina.com.cn/activity/common/large/ca054c6f67b2082f139ae294aa82c0ad.jpg";
		var orginalLength = imgList.length;
		for(i = 0; i < orginalLength; i++){
			imgList.push(imgList[i]);
		}
		return  imgList.sort(function(){ return 0.5 - Math.random() });
	}

/* 发微博并抽奖 */
function sendweibo(){
/* 禁用按钮 */
$("#submitbtn").attr("disabled","disabled");

function openLoginDialog(){DFZ.APP.DialogLogin.open();$("#ui-dialog-title-1").html("新浪微博登录");}

var uinfo = sinaSSOManager.getSinaCookie();
/* 微博内容 */
var content = "#看见昆山看见台湾#【哇~！玩配对游戏赢免费昆山台湾游】昆山、台湾的美景美食、特色文化，我都想实地体验一番呢！还有特色礼包等你来拿！小伙伴们，快快跟我来一起加入新浪旅行家征集活动，嗨翻一夏！详戳http://t.cn/RPisnbX @玩转昆山";

	if (!uinfo) {
		/* alert("没有登录"); */
		openLoginDialog();
		$("#submitbtn").removeAttr("disabled");
		return false;
	} else {
		/* alert("登录成功"); */
		g_login = true;
		
		/* 发微博 */
		
		/* 抽奖 */
		var uid = uinfo.uid;
		var step = $("#step").html()+"";
		$.JSONP('http://act.city.sina.com.cn/interface/activity/json_add_signup.php',{act_id:6482,custom_1:content,custom_2:uid,custom_3:step},function(json){
			if(json.error==0){
				/*
				var contentWeibo = content;
				addWeiboByCookie( contentWeibo, '', '微博发布成功' );
				*/
				/* 中奖提示 */
				alert(json.draw.tip.text);
				
			}else{
				alert(json.errmsg);
				return false;
			}
		});
		
	}

}
	
</script>
</body>
</html>