<style type="text/css">
    .center{text-align:center;} 
    .vote-block{ background: url("http://s3img.city.sina.com.cn/activity/common/large/29f97ce4a0905daf3b3fdc5c8cd1c756.jpg") no-repeat right bottom #f3fce6;font: normal 12px/22px "Microsoft YaHei","SimHei";}
    .vote-cont{ width: 950px; margin: 0 auto; background: url("http://jiangsu.sinaimg.cn/2015/0326/U8752P1194DT20150326094913.jpg") no-repeat center 0; position:relative; }
    .v-btn{ display:inline-block; background-color:#c70237; color:#fff; padding: 0 20px; font-size: 18px; border-radius: 4px; line-height: 35px;}
    
    .p1,.v-btn,.weibo-icon,.up-pic,.v-btn{ position: absolute; top:10px; left: 10px;}
    .p1{ width: 440px; left: 70px; top: 340px; font-size: 14px; line-height: 23px; text-indent:2em;}
    .ds-more{ top:490px; left: 80px; color: #fff;}
    .ds-sub{left: 830px;top: 490px;}
    .weibo-icon{ top:240px;left: 680px; width:95px; height: 95px; border-radius: 50px;}
    .up-pic{ top:310px; left: 540px; width: 380px; height: 140px; background-color: #c70237; cursor: pointer; text-align: center; color: #fff; font-size: 36px; line-height: 140px;}

    .works-list { }
    .works-list li{ width: 164px; float: left; margin: 15px 12px; background-color: #fff; padding-bottom: 5px;}
    .icon-area { line-height: 50px; padding-left: 5px; margin-top:8px; }
    .icon-area p{ line-height: 50px; height:50px; overflow:hidden;}
    .icon-pic{ border-radius: 25px; float: left; margin-right:10px; }

    #upPic{top: 162px; left: 230px; position: absolute;}
    #upPic input{ border: none; background: none; height: 26px; width: 70px;}
    .tips-form{ background: url("http://s3img.city.sina.com.cn/activity/common/large/dc59dd1290a4e2f247bc4fd87ed61cc2.jpg") no-repeat 0 0; width:554px; height: 390px; position: absolute; box-shadow:0 0 5px rgb(0,0,0,0.5); z-index: 1000; display: none;}
    .txt-area{ width: 178px; height: 26px; position: absolute; font-size: 14px;}
    .tijiao-form{ top: 310px; left: 342px;}
    .t-close{position:absolute;right:-20px; top:-20px; cursor: pointer;}
    .compeBox{ padding: 10px 30px; margin-bottom: 20px; display: none;}
    .compeBox h2{ text-align: center; color: #c70237; font-size: 30px; line-height: 50px;}
    .compeBox p{ font-size: 14px; line-height: 28px;}
    .ds-close{ margin: 0 auto; position: relative;}

#page {text-align:center; padding-bottom:20px;}
#page a{ color:#c70237;margin: 0 10px;font-size: 16px;}
#page a.cur{background-color:#c70237; color:#fff;padding:0 5px; line-height:18px}


.work-voteBtn {
    background-color: #d53b3f;
    border: medium none;
    color: #fff;
    cursor: pointer;
    font-size: 18px;
    font-weight: bold;
    outline: medium none;
    padding: 12px 0;
    width: 100%;
    text-align: center;
}
.work-votenumBox{  padding: 0 1em;}
.work-votenumBox:BEFORE{ content:"票数："; }
</style>

    <script type="text/javascript">
        document.domain = "sina.com.cn";
    </script> 
    <script src="http://act.city.sina.com.cn/js/uploadButton.js" type="text/javascript"></script> 
    <script>
<!--
var oldhref="";
var oldhref_thumbnail="";
function pic_upload_callback(json)
{
if(json.error==0){
  console.log(json)
    var real_pic_name = json.real_pic_name;
    var pic_url = json.pic_large;
    $(".newShref").html("上传成功："+real_pic_name);
    oldhref = pic_url;
    oldhref_thumbnail = json.pic_thumbnail;
}else
{
alert(json.errmsg)
}
}
function pic_before_callback()
{
    $(".newShref").html("上传中...");
}
function openLoginDialog(){DFZ.APP.DialogLogin.open();$("#ui-dialog-title-1").html("新浪微博登录");$(".ui-dialog").css("z-index","99999")}
$(function()
{
    $("#submitForm").click(function()
    {
        var uinfo = sinaSSOManager.getSinaCookie();
	 if (!uinfo) {openLoginDialog();return false;} 

            //var t_weibo = $('#weibo').val();
            var t_phone = $('#phone').val();
           // var t_workName = $('#workName').val();
            var t_shotLocation = $('#shotLocation').val();
            var t_flowerSeeds = $('#flowerSeeds').val();
            //var t_intro = $('#intro').val();
            
            if(oldhref==""){oldhref="http://jiangsu.sinaimg.cn/2014/0626/U11392P1194DT20140626222148.jpg"}
            if(oldhref_thumbnail==""){alert("请上传作品"); return false;}
            //if(t_weibo==""){alert("请输入微博名"); return false;}
            if(t_phone==""){alert("请输入手机号"); return false;}
            //if(t_workName==""){alert("请输入作品名称"); return false;}
            if(t_shotLocation==""){alert("请输入拍摄地点"); return false;}
            if(t_flowerSeeds==""){alert("请输入所拍花种"); return false;}
            //if(t_intro==""){alert("请输入作品描述"); return false;}
            var content='我在参与由@江苏微旅游 @新浪江苏旅游 举办的#江苏春花烂漫随手拍#活动――一个权威的江苏春花摄影大赛！大奖还有iwatch苹果手表别怪我没提醒你哟~这是我的作品，我为江苏最美花海代言！小伙伴们快来参加→_→http://jiangsu.sina.com.cn/z/springflowers2015/index.shtml #畅游江苏悦赏繁春#';
            addWeiboByCookie (content,oldhref);
            
            $.JSONP('http://act.city.sina.com.cn/interface/activity/json_add_signup.php',
            {
                act_id:10643,
                custom_2:t_phone,
                custom_4:t_shotLocation,
                custom_5:t_flowerSeeds,
                custom_7:oldhref,
                custom_8:oldhref_thumbnail 
                },function(bm){
                    if(bm.error==0){
                        alert("提交成功！");
                    location.reload();
                    }else{
                        alert(bm.errmsg)
                    }

            });
    });

    $(".ds-more").click(function()
    {
        $(".compeBox").slideDown();
        var topNum = $(".ds-more").offset().top;
        $('body,html').animate({scrollTop:topNum},1000);
    });
    $(".ds-close").click(function()
    {
        $(".compeBox").slideUp();
var topNum = $(".weibo-icon").offset().top;
$('body,html').animate({scrollTop:topNum},1000);
    })
});
-->
</script>

    <div class="vote-block">
        <div class="vote-cont">
                <p class="p1">
    “春天花会开，鸟儿自由自在……” 每到春季，江苏各地百花齐放，争奇斗艳，何处风景曾经让你心动？何处风景最值得我们流连？<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;江苏省旅游局联合新浪江苏，举办“江苏春花烂漫，随手拍摄影赛”，面向全国摄影爱好者征集捕捉最美江苏花海的摄影作品。上传作品参赛，秀出你的风采，有机会赢<span style="color:#a40000;font-weight:bold;">iwatch苹果手表、拍立得相机和手机充值卡</span>等超多礼品哦~</p>
                <a class="v-btn ds-more" href="javascript:;">大赛详情</a>
                <div class="up-pic">上传作品</div>
                 <img class="weibo-icon" src="http://tp1.sinaimg.cn/2489839700/180/5719811922/0" />
                <!--a class="v-btn ds-sub"  href="javascript:;">确认</a-->
                <div style="height:560px;"></div>
                <div class="compeBox">
                    <h2>大赛详情</h2>
                   <p>
                     一、大赛组织机构   <br/>
                    主办单位：江苏省旅游局<br/>
                    承办单位：新浪江苏<br/><br/>

                    二、大赛主题：江苏春花烂漫，随手拍摄影赛<br/><br/>

                    三、大赛时间<br/>
                    网络征集：2015年3月25日~4月17日<br/>
                    网络评选：2015年4月18日~4月30日<br/>
                    专家评选：2015年5月4日~5月8日<br/>
                    发布结果：2015年5月11日<br/><br/>

                    四、征稿规则<br/>
                    1、拍摄的江苏区域内的繁花春景作品，或花卉与景点相结合的摄影作品。<br/>
                    2、所有投稿作品均应为未在全国性影展、影赛入选的作品。<br/>
                    3、投稿作品不限黑白、彩色，单幅、组照均可（组照视为一件作品）。每件作品的票数单独统计，不做合并统计。<br/>
                    4、投递格式为JPG。投稿作品可以进行后期处理，允许图像合成。<br/>
                    5、投稿作者必须拥有作品的完整著作权；所有投稿作品有关的著作权、肖像权、名誉权等法律问题，均由作者自行解决并承担责任。<br/><br/>

                    五、投稿方式<br/>
                    1、本次投稿采用网络投稿方式。（1）微博：发布带话题#畅游江苏悦赏繁春#、#江苏春花烂漫随手拍#微博，@新浪江苏旅游 @江苏微旅游；（2）专题：在专题上找到参赛区域，上传参赛作品即可。<br/>
                    2、随上传作品，作者还可将拍摄经过、当地摄影感受、推荐景点及其它相关文字资料一起上传分享。（备注：投稿者请务必在填写文档时填写真实姓名、网名、联系电话及通讯地址等相关资料；如因作者资料缺失或不准确而导致无法与之取得联系，失去参评资格，主办方不承担责任。）<br/><br/>

                    六、评选办法<br/>
                    1、网络投票，开放网友线上投票通道，选出入围作品。<br/>
                    2、组织专家评审。邀请有关领导、摄影家、专家组成评审委员会进行客观、公正、公平的评选，评选出大展设置的奖项。评选结果公示后，大赛组委会将对一、二、三等奖获奖作品进行奖励。<br/>
                    3、本次活动的解释权归主办单位。参加本次征集活动即视为同意并遵守本次征集 活动各项规则。凡不符合征稿要求的作品，一经发现将一律取消参评资格。<br/><br/>

                    七、奖项设置：<br/>
                    一等奖：三名，iwatch苹果手表+获奖证书<br/>
                    二等奖：五名，拍立得相机+获奖证书<br/>
                    三等奖：十名，100元手机充值卡+获奖证书<br/><br/>

                    注：评选细则<br/>
                    由电脑专题、微博参赛的作品票选前300名入围，经专家评审出最终奖项。<br/>
                    一等奖：二名，iwatch苹果手表+获奖证书<br/>
                    二等奖：三名，拍立得相机+获奖证书<br/>
                    三等奖：七名，100元手机充值卡+获奖证书<br/>

                    由手机H5专题参赛的作品票选前200名入围，经专家评审出最终奖项。<br/>
                    一等奖：一名，iwatch苹果手表+获奖证书<br/>
                    二等奖：二名，拍立得相机+获奖证书<br/>
                    三等奖：三名，100元手机充值卡+获奖证书 

                    </p>
                    <div class="center"><a class="v-btn ds-close" href="javascript:;">关闭</a></div>
                    

                </div>
                <ul id="voList" class="works-list clearfix">

                </ul>
            <div id="page"></div>
               

        </div>
    </div>
<script src="http://jiangsu.sinaimg.cn/js/popBox.js" type="text/javascript" charset="utf-8"></script> 
<script type="text/javascript">
(function($) {
	$.fn.bgIframe = $.fn.bgiframe = function(s) {
		if ($.browser.msie && /6.0/.test(navigator.userAgent)) {
			s = $.extend({
				top: 'auto',
				left: 'auto',
				width: 'auto',
				height: 'auto',
				opacity: true,
				src: 'javascript:false;'
			},
			s || {});
			var prop = function(n) {
				return n && n.constructor == Number ? n + 'px': n;
			},
			html = '<iframe class="bgiframe"frameborder="0"tabindex="-1"src="' + s.src + '"' + 'style="display:block;position:absolute;z-index:-1;' + (s.opacity !== false ? 'filter:Alpha(Opacity=\'0\');': '') + 'top:' + (s.top == 'auto' ? 'expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+\'px\')': prop(s.top)) + ';' + 'left:' + (s.left == 'auto' ? 'expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+\'px\')': prop(s.left)) + ';' + 'width:' + (s.width == 'auto' ? 'expression(this.parentNode.offsetWidth+\'px\')': prop(s.width)) + ';' + 'height:' + (s.height == 'auto' ? 'expression(this.parentNode.offsetHeight+\'px\')': prop(s.height)) + ';' + '"/>';
			return this.each(function() {
				if ($('> iframe.bgiframe', this).length == 0) this.insertBefore(document.createElement(html), this.firstChild);
			});
		}
		return this;
	};
})(jQuery);
(function($, root) {
	var CAP = {};
	CAP.ui = {};
	/**private**/
	CAP.ui.BasicDiaglog = function(options) {
		this.init(options);
	}
	function now() {
		return new Date().getTime();
	}
	function bind(obj, func) {
		return function() {
			return func.apply(obj, arguments);
		};
	}
	$.extend(CAP.ui.BasicDiaglog.prototype, {
		constructor: CAP.ui.BasicDiaglog,
		init: function(options) {
			var self = this,
			tpl = '<h3 class="yzm-tit" style="line-height:30px;padding-left:10px;font-size:12px;font-weight:bold;background-color:#f2f2f2;color:#333;">请输入验证码</h3><a href="javascript:void(0);" class="close-a">关闭</a>',
			$window = $(window);
			self.ie6 = !!window.ActiveXObject && !window.XMLHttpRequest;
			self.options = $.extend({
				content: "......",
				width: 0,
				height: 0,
				zIndex: 10001,
				esc: false,
				hidden: true,
				noDrag: true,
				isBg: true,
				isHover: false,
				isTitle: true,
				isClose: true,
				bgColor: "#000",
				opacity: .4,
				onClose: function() {}
			},options || {});
			var options = self.options;
			self._drag = null;
			options.isBg && self.setMask(options.zIndex, options.hidden);
			self._$node = $('<div class="yzm-box" style="position:absolute;background-color:#fff;color:#333;">'+tpl+options.content+'</div>');
			self._$node.appendTo("body");
			if (options.zIndex) {
				self._$node.css("z-index", options.zIndex);
			};
			if (options.hidden) {
				self._$node.css("visibility", "hidden");
			};
			if (self.ie6) {
				self._$node.bgIframe && self._$node.bgIframe();
			};
			self._$btnClose = self._$node.find(".close-a");
			self._bindClose = bind(self, self._setBtnClose);
			self._$btnClose.bind("click", self._bindClose);
			self._$btnMove = {};
			self._$btnMove["resize"] = function() {
				self.resize();
			};
			self._$btnMove["scroll"] = function() {
				self.scroll();
			};
			self._$btnMove["keydown"] = function(event) {
				if (options.esc) {
					return;
				};
				if (!self._$btnMove) {
					return;
				};
				var p = event.keyCode;
				if (p === 27) {
					self.close()
				};
			};
			!options.isHover && self.setMiddle();
			if (options.hidden) {
				self._$node.css("visibility", "hidden");
				self.focusTarget = self._$btnClose;
			} else {
				self._$node.css("visibility", "visible");
				self._$btnClose.focus().blur();
			};
			if (!options.isTitle) {
				self._$btnMove.hide();
			};
			if (!options.isClose) {
				self._$btnClose.hide();
			};
			$window.bind({
				"resize": self._$btnMove["resize"],
				"scroll": self._$btnMove["scroll"]
			});
			$(document).bind("keydown", self._$btnMove["keydown"]);
		},
		_setBtnClose: function() {
			var self=this;
			self.close();
			return false;
		},
		distory: function() {
			var self = this,
			options = self.options;
			if (self._distory) {
				return;
			};
			$(window).unbind({
				"resize": self._$btnMove["resize"],
				"scroll": self._$btnMove["scroll"]
			});
			self._drag && self._drag.destory();
			self._$btnClose.unbind("click", self._bindClose);
			self._$btnClose = null;
			self._$node.remove();
			self._$mask && self._$mask.remove();
			self._$node = null;
			self._$btnMove["resize"] = null;
			self._$btnMove["scroll"] = null;
			self._$btnMove["close"] = null;
			self._$btnMove = null;
			self._destory = true;
			self._close = true;
		},
		close: function() {
			var self = this,
			options = self.options;
			if (self._close) {
				return;
			};
			setTimeout(function() {
				options.onClose();
			},0);
			self.distory();
		},
		show: function() {
			var self = this,
			options = self.options;
			if (!self._$node) {
				return;
			};
			self._$node.css("visibility", "visible");
			if (self._$mask) {
				self._$mask.css("visibility", "visible");
			};
			if (self.focusTarget) {
				self.focusTarget.focus()
			};
			if (self._$mask && self.ie6) {
				var html = document.getElementsByTagName('html')[0];
				if (document.body.currentStyle.backgroundAttachment !== 'fixed') {
					html.style.backgroundImage = 'url(about:blank)';
					html.style.backgroundAttachment = 'fixed';
				};
			};
			self.resize();
			!options.isHover && self.setMiddle();
		},
		setMask: function(z, hidden) {
			var self = this,
			options = self.options;
			self._$mask = $("<div class=\"setFixedIE6\"></div>").appendTo("body");
			if (hidden) {
				self._$mask.css("visibility", "hidden");
			}
			self._$mask.css({
				position: "fixed",
				backgroundColor: options.bgColor,
				width: "100%",
				height: "100%",
				zIndex: parseInt(z),
				opacity: options.opacity
			});
			if (self.ie6) {
				self._$mask.bgIframe && self._$mask.bgIframe();
				self._$mask.css({
					"position": "absolute"
				});
			} else {
				self._$mask.css({
					left: 0,
					top: 0
				});
			}
		},
		resize: function() {
			var self = this,
			options = self.options;
			self.setMiddle();
			if (self._$mask) {
				if (self.ie6) {
					self._setIE6Scroll();
				}
			}
		},
		_setIE6Scroll: function() {
			var self = this,
			$window = $(window);
			if (self._$mask && self.ie6) {
				self._$mask.css({
					"width": $window.width() + "px",
					"height": $window.height() + "px"
				});
			}
		},
		scroll: function() {
			var self = this;
			self.setMiddle();
			self._setIE6Scroll();
		},
		setMiddle: function() {
			var self = this,
			options = self.options,
			w = self._$node.outerWidth(),
			h = self._$node.outerHeight(),
			$window = $(window),
			s = $window.scrollTop(),
			b = {
				width: $window.width(),
				height: $window.height()
			},
			a = s + (b.height - h) / 2,
			c = (b.width - w) / 2;
			self._$node.css({
				"left": c + "px",
				"top": a < 20 ? 20: a + "px"
			});
		}
	});
	/**private**/
	CAP.ui.normal_captcha = function( options ) {
		var obj = {},
			self = this,
			url='http://vote.act.city.sina.com.cn/interface/captcha/captcha_img.php?',
			tpl = '<div class="yzm-con2">',
			btn_id = "btn_" + now(),
			_dialog = null,
			$btn = null;
		tpl += '<p><input type="text" class="yzm-text" value="" placeholder="按下图输入验证码，不区分大小写" title="按下图输入验证码，不区分大小写"/></p>';
		tpl += '<p><img src="" alt="" />看不清？<a href="javascript:void(0);" class="chose-btn-vote">换一张</a></p><p class="tc">';
		tpl += '<input type="button" class="sub-btn" value="提交" id="'+btn_id+'" /></p></div>';
		obj.content = tpl;
		_dialog = new CAP.ui.BasicDiaglog(obj);

		var $img = _dialog._$node.find('img'),
			$chose = _dialog._$node.find('a.chose-btn-vote');
		var g = function () {
			var $im = $img.get(0);
			$im.src = url+'&r='+now()+'&height='+options.height+'&width='+options.width+'&act_id='+options.act_id;
		};

		$img.bind('click',g);
		$chose.bind('click',g);
		$img.trigger('click');

		self.dialog = _dialog;
		self.btn = $("#" + btn_id);
		return self;
	};
	/**private**/
	CAP.ui.ads_captcha = function( options ){
		var obj = {},
			self = this,
			url='http://vote.act.city.sina.com.cn/interface/captcha/json_get_ads_captcha.php?',
			tpl = '<div class="yzm-con">',
			btn_id = "btn_" + now(),
			_dialog = null,
			$btn = null,
			loading = 'http://act.city.sina.com.cn/images/loading2.gif';
		self.options = $.extend({
			ok_callback: function() {}
		},
		options || {});
		tpl += '<p><a href="javascript:void(0);" class="chose-btn chose-btn-adcaptcha">换一张</a><i class="icon-q captcha-q">&nbsp;</i><span>请输入下图中本期访谈嘉宾的姓名是什么？</span></p>';
		tpl += '<div class="yzm-img" style="text-align:center;"><img src="'+loading+'" alt="" /></div><p><i class="icon-a">&nbsp;</i><input type="text" class="yzm-text" value="" placeholder="请在此输入正确答案" title="请在此输入正确答案"/></p><p class="tc">';
		tpl += '<span class="captcha-error" style="color:red;"></span><input type="button" class="sub-btn" value="提交" id="'+btn_id+'" /></p></div>';
		obj.content = tpl;
		_dialog = new CAP.ui.BasicDiaglog(obj);
		var $act_id = self.options.act_id,
			$img = _dialog._$node.find('img'),
			$chose = _dialog._$node.find('a.chose-btn-adcaptcha'),
			$question = _dialog._$node.find('i.captcha-q').next(),
			$error = _dialog._$node.find('span.captcha-error');

		var g = function(){
			var $im = $img.get(0);
			$im.src=loading;
			$.getJSON(url+'&callback=?&r='+now(),{'act_id':$act_id},function(json){
				if( json.error==0 ) {
					var data = json.data;
					$im.src = data.img;
					$question.text(data.question);
				} else {
					$error.text(json.errmsg);
				};
			});
		};
		$img.bind('click',g);
		$chose.bind('click',g);
		$img.trigger('click');

		self.dialog = _dialog;
		self.btn = $("#" + btn_id);
		return self;
	};
	/**public**/
	CAP.ui.captcha = function(options){
		var self = this,obj = {},_dialog = null,
			err = function(content){
				_dialog = new CAP.ui.BasicDiaglog({'content':content});
				_dialog.show();
			};
		self.cap = {};
		var options = $.extend({
			ok_callback: function() {}
		},options || {});
		var exec = function(){
			var $btn = self.cap.btn,
				_dialog = self.cap.dialog,
				_$node = self.cap.dialog._$node;
			var cap_text = _$node.find(':text')

			cap_text.focus(function(){
				if($(this).hasClass("icon-failure")){
					$(this).val('').removeClass("icon-failure icon-succeed");
				}
			});

			var sub = function() {
				$.get("http://vote.act.city.sina.com.cn/interface/captcha/json_check_captcha.php", {"captcha":cap_text.val(),"act_id":options.act_id}, function(json){
					if(json.error==1){
						cap_text.addClass("icon-failure");
					}else{
						cap_text.addClass("icon-succeed");
						close();
						options.ok_callback.call(self,cap_text.val(),'');
						
					}
					on_progress = false;
				},'jsonp')
			};
			var close = function() {
				$btn.unbind("click", arguments.callee);
				$btn = null;
				_dialog.close();
				self.cap = null;
				$(document).unbind("keyup", r);
				return false;
			}
			var r = function(event) {
				var x = event,
				w = x.target,
				tagName = w.tagName.toUpperCase();
				if (w.nodeType == 3) {
					w = w.parentNode;
				};
				if (w.tagName == "input" || w.tagName == "textarea") {
					return;
				};
				switch (x.keyCode) {
				case 27:
					close();
					break;
				case 13:
					sub();
				};
			};
			$btn.bind("click", sub);
			$(document).bind("keyup", r);
			_dialog.show();
		};


		//获取活动信息
		var act_info = null;
		$.get("http://vote.act.city.sina.com.cn/interface/activity/json_get_act_info.php?act_id="+options.act_id, {}, function(json){
			if(json.error==1){
				err('<span style="color:red;">'+json.errmsg+'</span>');
			}else{
				act_info = json.data;
				if(!act_info){
					err('<span style="color:red;">活动不存在</span>');
					return false;
				};
				//增加验证码类型参数;默认为投票类型;
				var capType = options.type || 'vote';
				if ( capType === 'vote' ) {
					cap = act_info.vote_captcha;
				} else if ( capType === 'work' ) {
					cap = act_info.work_captcha;
				};
				if( cap == 1 )
				{
					obj.height = options.height || 0;
					obj.width  = options.width || 0;
					obj.act_id = act_info.id;
					self.cap = new CAP.ui.normal_captcha(obj);
					exec();
				}else if( cap == 2 ) {
					obj.ok_callback = options.ok_callback || function(){};
					obj.act_id = act_info.id;
					self.cap = new CAP.ui.ads_captcha(obj);
					exec();
				}else{
					$.get("http://vote.act.city.sina.com.cn/interface/common/get_token.php", {"act_id":options.act_id,"work_id":options.work_id}, function(json){
							if(json.error==1){
								err('<span style="color:red;">'+json.errmsg+'</span>');
							}else{
					  			options.ok_callback.call(self,'',json.token);
					 		}
							on_progress = false;
					},'jsonp')
				};
			}
		}, 'jsonp');

		return self;
	};
	//将CAP添加到命名空间
	root.CAP = CAP;
})(jQuery,window);
</script>
<link rel="stylesheet" type="text/css" href="http://act.city.sina.com.cn/style/captcha.css" />



<script type="text/javascript">
function ajaxMess(p)
{
    var act_id = 10643;
    var pcount = 10;
    $.JSONP('http://act.city.sina.com.cn/interface/activity/json_get_user_works.php',{act_id:act_id,p:p,pcount:pcount,order:'vote'},function(json){
        var html ="";
        console.log(json)
        for(var i=0; i<json.data.length;i++){
                var data = json.data[i];

                 html += '   <li>'
                 html += '   <a href="http://jiangsu.sina.com.cn/1/2015-03-30/470.html?cid='+data.id+'" target="_blank"><img src="'+data.form_data.custom_8.value+'" width="164" height="164"></a>'
                 html += '   <div class="icon-area">'

                 /* 如果作品指定了作者，则显示指定后的作者头像、昵称  @20150421 NorthWind */
                 var imgurl = data.user_info.profile_image_url;
                 var usernick = data.user_info.screen_name;
                      
                 if( data.custom_user_info != "" ){
                    imgurl = data.custom_user_info.profile_image_url;
                    usernick = data.custom_user_info.screen_name; 
                 }
            
                 html += '   <img class="icon-pic" src="'+imgurl+'" width="50" height="50">'
                 html += '   <p>'+usernick+'</p>'
                 /* end 如果作品指定了作者，则显示指定后的作者头像、昵称  @20150421 NorthWind */

                 html += '   </div>'
                 html += '   <div class="work-votenumBox" id="votenum'+ data.id +'">'+data.vote_count+'</div>'
                 html += '   <div class="work-voteBtn" onclick="voteTo('+ data.id +',\''+ data.form_data.custom_8.value + '\')">投票</div>'

                var numCount = json.count;
                var pageCount = Math.ceil(parseInt(numCount)/pcount);
                var htmlPage = '';
                if(pageCount>1){
                    for(var k=1; k<=pageCount; k++){
                        if(k==p){
                            htmlPage += '<a href="javascript:;" onclick="pageBox('+k+')" class="cur">'+k+'</a>';
                        }else{
                            if(k<3 || (k>(p-4) && k<(p+4) )|| k>pageCount-3)
                            {
                                if(k == (p-3) && p>6)
                                {   
                                      htmlPage += '...<a href="javascript:;" onclick="pageBox('+k+')">'+k+'</a>';
                                }
                                else if(k == (p+3) && p< (pageCount-4))
                                {
                                    htmlPage += '<a href="javascript:;" onclick="pageBox('+k+')">'+k+'</a>...';
                                }
                                else
                                {
                                    htmlPage += '<a href="javascript:;" onclick="pageBox('+k+')">'+k+'</a>'; 
                                }
                            }
                        }
                    }
                }
                $('#page').html(htmlPage);
        }
        $('#voList').html(html);
    });
}

//初始加载
$(function()
{
    ajaxMess(1);
})
//翻页
$('#page a').bind('click', function(){
    var page = $(this).attr('page');
    ajaxMess(page);
});
function pageBox(a)
{
ajaxMess(a);
}

function closeAlert()
{
    $.hidePop("myCon","myBg");
}

$(function()
{
    $(".up-pic").click(function()
    {
            $.popBox({popid:'myCon',bgid:'myBg',ishtml:false,width:554,height:390});
window.$.tools.BindFileBeautify()
    })
    $("#close").click(function(){ closeAlert();});
})


/**
 * 投票方法
 * @param work_id 作品id
 */

function voteTo(work_id,imgurl){
new CAP.ui.captcha({act_id: 10643, height: 50, width: 120, ok_callback: function(captcha) {
	$.JSONP('http://vote.act.city.sina.com.cn/interface/activity/json_add_vote.php',{id: work_id, captcha: captcha},function(json){
		if(json.error == 0){
var numtextDom = $("#votenum"+work_id);
numtextDom.text( parseInt(numtextDom.text()) + 1);
			alert("投票成功!");

//投票后发微博
var uinfo = sinaSSOManager.getSinaCookie();
		if (!uinfo) { //判断登陆
		} else {
			addWeiboByCookie("我在由@江苏微旅游 @新浪江苏旅游 举办的#江苏春花烂漫随手拍#活动中为我喜欢的作品投了一票！快来帮你喜爱的作品上头条！一起为江苏最美花海代言！参与活动还有iwatch苹果手表大奖别怪我没提醒你哟~小伙伴们快来参加→_→http://t.cn/RwrK9wR #畅游江苏悦赏繁春#",imgurl,"");
console.log("成功发出微博"+ imgurl);
		}	
        }else{
            alert(json.errmsg);
        }
	});
}
});

}
</script>




