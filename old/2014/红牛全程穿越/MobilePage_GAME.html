<!DOCTYPE html>
<html>
<head>
<meta charset="GB2312">
<meta http-equiv="cache-control" content="no-cache"/>
<meta name="format-detection" content="telephone=no"/>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"> 
<title>红牛全城穿越</title>
<script src="http://i2.sinaimg.cn/cj/dfz/js/base.js" type="text/javascript"></script>
<!-- 
<script src="http://jiangsu.sinaimg.cn/js/jquery.transit.min.js"></script>
 -->
<link rel="stylesheet" href="http://jiangsu.sinaimg.cn/js/idangerous.swiper.css">
<script src="http://jiangsu.sinaimg.cn/js/idangerous.swiper.min.js"></script>
<style type="text/css">
body, ul, ol, li, p, h1, h2, h3, h4, h5, h6, table, td, th, form, fieldset, img, dl, dt, dd { margin:0; padding:0; }
textarea, input, select, body { font-size:12px; }
select, input { vertical-align:middle; }
fieldset, img { border:0; }
ul, ol { list-style:none; }
img { border:0; }
a { text-decoration:none; color:#000; }
a:hover { color:#ffa10d; }
.fl { float:left; display:inline; }
.fr { float:right; display:inline; }
.cb { clear:both; display:block; height:0px; overflow:hidden; width:100%; }
.clearfix:after { clear:both; content:""; display:block; height:0; }
</style>
<!-- 自适应缩放css -->
<style type="text/css">
body{ overflow-x: hidden; background-color: #2a2a2c; }
.swiper-container{ width: 640px; height: 960px; -webkit-transform-origin: top left; margin: 0; background-color: #2a2a2c; }
.swiper-wrapper *{ -webkit-backface-visibility: hidden; } /* 避免ip4Safari闪动 */
.page-provider{ position:absolute;top:0; text-align: center; width: 100%; font-size: 24px;line-height: 80px; color: #e5d2d4; }
.page-provider#page-provider-bottom{ top:auto; bottom: 0; }
.swiper-slide{ width: 640px; height: 960px; position: relative; overflow: hidden; background-position: left top; }
</style>
<!-- end 自适应缩放css -->
<style type="text/css">
body{ font-size: 24px; color: #FFF;}
.abs{position:absolute;}
.s_title{ left: 51px; top: 70px; width: 2em;color: #fdd000;}
.s_content{ left: 98px; top:174px; width: 453px; height: 595px; overflow-y:scroll; }
.b1{ left: 502px; top: 814px; cursor: pointer; }
.orange{color: #fdd000; }
.red{ color:#F00;}
.glay{ color: #b1b1b1;}
.fs20{ font-size: 20px;}
.fs28{ font-size: 28px;}
.fs15{ font-size: 15px;}
.fs14{ font-size: 14px;}
#s2,#s3,#s4,#s5,#s6{ background-image: url("http://jiangsu.sinaimg.cn/zt/s/hnqccy/bg.jpg"); }
</style>
<!-- Initialize swiper -->
<script type="text/javascript">
var mySwiper;

window.onload = function() {
	mySwiper = new Swiper('.swiper-container',{
		// options
		speed: 0,
		swipeToNext: false,
		swipeToPrev: false,
		mousewheelControl: true,
		onSlideChangeEnd : Swipercallback
	});  
}

/* SlideChangeEndCallback */
function Swipercallback(p){
    var act = p.activeIndex; //slideEndIndex
    // todo sth...
}
</script>
</head>
<body>
	<!-- 
	* 说明：
	* 多页面滑动模板，适用于 类ppt 页面
	* 页面 640x960 按宽度缩放
	* 使用 idangerous.swiper 插件切换页面 ，参数请在下方 【Initialize swiper】中自行更改
	*
	 -->
	<div class="swiper-container">
		<!-- 底层 -->
		<div class="page-provider" id="page-provider-top">新浪江苏 SINA 2014</div>
		<div class="page-provider" id="page-provider-bottom">新浪江苏 SINA 2014</div>
		
		<div class="swiper-wrapper">
		    <!--First Slide-->
			<div class="swiper-slide" id="s1">
			<img src="http://jiangsu.sinaimg.cn/zt/s/hnqccy/p1.jpg" usemap="#Map">
            <map name="Map">
              <area shape="poly" coords="239,635,401,633,320,495" href="javascript:mySwiper.swipeTo(6);">
              
              <area shape="poly" coords="81,863,243,861,162,723"  href="javascript:mySwiper.swipeTo(1);">
              <area shape="poly" coords="170,715,315,716,247,844" href="javascript:mySwiper.swipeTo(2);">
              <area shape="poly" coords="247,860,395,860,322,726" href="javascript:mySwiper.swipeTo(3);">
              <area shape="poly" coords="324,714,469,715,401,843" href="javascript:mySwiper.swipeTo(4);">
              <area shape="poly" coords="397,863,559,861,478,723" href="javascript:mySwiper.swipeTo(5);">
            </map>
			
		  </div>
			
			<!--Second Slide-->
			<div class="swiper-slide" id="s2">
				<div class="abs s_title">活动介绍</div>
				<div class="abs s_content">
<span class="orange">活动名称：</span>2014红牛【全城穿越】城市定向挑战赛<br/>
<span class="orange">活动时间：</span>11月8日；8:30-19:30；<br/>
<br/>
　　2014红牛【全城穿越】城市定向挑战赛是由南京红牛维他命饮料有限公司联合江苏省登山户外运动协会共同发起的大型户外娱乐竞技项目。
<br/>
<span class="orange">比赛类型：</span>长距离徒步+任务闯关；<br/>
<span class="orange">路线长度：</span>全程35KM，徒步路线20KM；<br/>
<span class="orange">参赛人员：</span>参赛者必须以2-4人小队形式参与，且 其中必须有1名女性；<br/>
<br/>
<span class="orange">赛事亮点：</span><br/>
1、途中设置打卡闯关点，集【智慧】、【勇气】、【人品】，【团队协作】为一体；<br/>
2、顺利闯关者可免费参加终点方山艺术音乐潮PA；<br/>
3、冠军队伍可获得1000元奖金+价值2000元的户外装备；<br/>
4、途中随机红牛能量补给，给你能量，等你挑战！<br/>
<br/>
红牛全城穿越，给你不一样的徒步体验，从细微处了解你所处城市的美与感动，在行进中完成城市地理与角色人文的双重穿越。
				</div>
				<img class="abs b1" src="http://jiangsu.sinaimg.cn/zt/s/hnqccy/b1.png" onclick="mySwiper.swipeTo(0)"/>
			</div>
			
			<!--Third Slide-->
			<div class="swiper-slide" id="s3">
				<div class="abs s_title">比赛规则</div>
				<div class="abs s_content">
1、参赛队伍以集体形式向赛事组委会报名，每队2-4名队员，必须至少有一名女性队员。<br/>
<br/>
2、所有参赛队在规定时间内，集体穿越比赛指定点标，并完成相关任务，以用时少、任务完成好者为胜。<br/>
<br/>
3、每参赛队需指定一名队长，参加赛事组委会安排的赛前培训，队长为该参赛队的负责人。4、参赛队员需在比赛日当天8:30之前到达比赛起点并接受检录，队长须在8:00前到达起点并签到、领取物品、召集队员。参赛队伍进入指定等候区域按指令依次出发，并在关门时间16点前到达终点。<br/>
<br/>
5、所有参赛队员在比赛中必须统一穿着赛事组委会提供的比活动标识物，并于前胸全程佩戴号码布。<br/>
6、比赛出发依据等时间隔发队办法，依次有序出发。<br/>
<br/>
7、每支参赛队伍配发打卡纸卡，由队长携带。在比赛过程中漏打，比赛成绩无效，比赛结束后归还于终点计时处。<br/>
<br/>
8、每支参赛队全体成员须集体按照任务书指令到达每个点标并完成任务，且中途不得更换队员。<br/>
9、参赛队伍在比赛中只能徒步或奔跑，并借助市内公共交通工具（仅限地铁、公交）。凡使用自驾、指派车辆等非公共交通工具，比赛成绩无效。<br/>
10、在比赛过程中，因坐标点拥挤造成等待，参赛队员须耐心接受并依次排队在等待区休息，按照裁判员要求完成相关任务。<br/>
11、参赛队员须遵守公共秩序、交通规则及比赛规则，如有违反，取消比赛成绩。<br/>
12、参赛队员自行解决在本次比赛中交通、地图、通讯、餐饮及其他相关费用。<br/>
				</div>
				<img class="abs b1" src="http://jiangsu.sinaimg.cn/zt/s/hnqccy/b1.png" onclick="mySwiper.swipeTo(0)"/>
			</div>
			
			<!--4 Slide-->
			<div class="swiper-slide" id="s4">
				<div class="abs s_title">能量攻略</div>
				<div class="abs s_content">
1、线路全长约35KM<br/>
<br/>
2、其中徒步线路控制在20KM<br/>
<br/>
3、起点设置在紫金山下白马公园<br/>
<br/>
4、市区路段尽量是沿着城墙走设置2个移动打卡点东水关设置医疗站<br/>
<br/>
5、夫子庙完成一次趣味闯关任务<br/>
<br/>
6、三山街-胜太路（乘坐做地铁路段）完成一个微信打卡任务<br/>
<br/>
7、在胜太路设置一个闯关点（获得一张帐篷音乐节门票）<br/>
<br/>
8、终点站方山艺术营大草坪设置“电网穿越”任务点、医疗站；<br/>
<br/>
<span class="glay">(此为提示性说明，具体的以比赛日任务书为准)</span>
				</div>
				<img class="abs b1" src="http://jiangsu.sinaimg.cn/zt/s/hnqccy/b1.png" onclick="mySwiper.swipeTo(0)"/>
			</div>
			<!--5 Slide-->
			<div class="swiper-slide" id="s5">
				<div class="abs s_title">趣玩定向</div>
				<div class="abs s_content">
<span class="orange">城市定向活动活动背景：</span><br/>
<span class="fs20">
　　定向运动起源于北欧，是利用地图和指南针到达地图上指定的点，并以到达时间最短者作为优胜方。它的起源也颇为有趣。19世纪末，北欧斯堪的纳维亚半岛的城镇、村庄稀疏，道路弯曲难辨，一个外来人要想穿越那里，在没有地图和指南针的情况下，十分困难。因此，那些经常在斯堪的纳维亚半岛山林中行动的军队，便成了开展定向运动的先驱。<br/>
　　城市定向则是由野外定向发展过来的全新运动。由野外转移到了城市，虽然少了一些野趣，但城市定向自有它的魅力所在。定向运动通常两到三人一组，以组为单位利用指南针等工具，通过自己的学识、判断，分析完成组织方统一制作的问卷，并到达终点，所用时间最短的小组取胜。当然，取得胜利也离不开强健的体魄。
</span>
<br/>
<br/>
<span class="orange">城市定向的乐趣：</span><br/>
<span class="fs20">
1.感触这座城市<br/>
　　或许你在一个城市里生活了20年，但她散落在边边角角的历史、文化和新奇，你都知道吗？城市定向就为大家提供了一个零距离了解她的机会。我们都是”从甲地赶往乙地”，目的具体而明确，很少停下匆匆的脚步，听听来自灵魂的声音。<br/>
2.未知的神秘乐趣<br/>
　　每段定向路线都是未知的，每个参赛队只有完成闯关任务，才能拿到下一段路程的指示，智力与体力的双重挑战，不仅考验每一个参赛者的体力，更考验每一组参赛队的配合协作。<br/>
2014“全城穿越”红牛城市定向挑战赛报名工作已经全面启动，够胆识、够魄力，你就来！
</span>
				</div>
				<img class="abs b1" src="http://jiangsu.sinaimg.cn/zt/s/hnqccy/b1.png" onclick="mySwiper.swipeTo(0)"/>
			</div>
			<!--5 Slide-->
			<div class="swiper-slide" id="s6">
				<div class="abs s_title">我要报名</div>
				<div class="abs s_content" style="text-align: center;">
<span class="orange fs28">报名方法：</span><br/>
先加入官方QQ群：260831688<br/>
下载报名资料<br/>
报名表上传QQ邮箱：2710946464@qq.com<br/>
<br/>
<span class="orange fs28">微博报名：</span><br/>
@红牛南京站  或  @泓策划<br/> 
（“姓名+联系方式”私信我们 ）<br/>
<br/><br/><br/>
<img src="http://jiangsu.sinaimg.cn/zt/s/hnqccy/logo.png">
				</div>
				<img class="abs b1" src="http://jiangsu.sinaimg.cn/zt/s/hnqccy/b1.png" onclick="mySwiper.swipeTo(0)"/>
			</div>

			<!--5 Slide-->
			<div class="swiper-slide" id="s6">
				<div id="gameBox" style="-webkit-transform: scale(2);-webkit-transform-origin: top left;">
					<div class="page" id="page1">
						<h2>全城穿越</h2>
						<div id="gc_start" class="gc_start" onclick="page(2,30)">开始</div>
					</div>
					
					<div class="page" id="page2">
						<canvas id="gameZone" width="320" height="480"></canvas>
						<div class="ui_infoPannel">
							<div class="ui_timebox"><span id="ui_time" class="ui_time">30</span>米</div>
							<div class="ui_scorebox"><span id="ui_score" class="ui_score">0</span>罐</div>
						</div>
						<div id="gc_pause" onclick="gamePause()">暂停</div>
					</div>
					
					<div class="page" id="page3" style="text-align: center;">
						<img src="http://jiangsu.sinaimg.cn/zt/s/hnqccy/logo.png" width="151" style="padding-top: 38px;"><br/>
<span class="fs15">主人主人！</span><br/>
你在红牛全城穿越游戏中<br/>
穿过<span class="orange fs14"><span class="ui_time"></span>米</span>，<br/>
带回红牛饮料<span class="orange fs14"><span id="ui_finalScore" class="ui_score"></span>罐</span>。<br/>
<br/>
点击右上角的分享按钮，<br/>
招呼小伙伴一起来白马公园参加<br/>
11月08日红牛南京城市定向挑战赛<br/>
<span class="red">1000元现金+价值2000元的户外装备</span><br/>
等你拿！<br/>
<img src="http://jiangsu.sinaimg.cn/zt/s/hnqccy/sanjiao.png" width="82" style="margin-top: 13px;" onclick="page(1)"><br/><br/>
<span onclick="mySwiper.swipeTo(0);" style="color: #fdefaf;">返回首页</span>
						<p>得分：<span id="ui_finalScore" class="ui_score">0</span></p>
					</div>
				</div>
			</div>
			<!--Etc..-->
			
		</div>
	</div>
</body>
<style type="text/css">
.score_3,.score_1,.score_-10{ font-size: 30px; font-weight:bold; text-align: center; 
-webkit-transform: translateZ(0);
-moz-transform: translateZ(0);
-ms-transform: translateZ(0);
transform: translateZ(0);}
.score_3{ color: #fd7c09;}
.score_1{ color: #fd7c09;}
.score_-10{ color: #231b1b;}

#page1 h2{ text-align: center; font-size: 40px; padding: 117px 0; text-shadow: 1px 4px 10px #333; }
#page1 p{ text-align: center; margin-top: 25px; color: #333;}
#page1 .gc_start{width: 100px; height: 40px; text-align:center; line-height:40px; font-size:22px; margin: 15px auto 0px; display: block;
border: none;
border-radius: 5px;
color: #FFF;
background-color: #eb9b07;
box-shadow: 0px 5px #c07e05;
}
#page1 .gc_start.gc_start_2{ -webkit-transform:scale(0.6); margin: 2px auto 0px; }
#page1 .gc_start.gc_start_3{ -webkit-transform:scale(0.6); margin: -8px auto 0px;}

#page2 { background-image: url("http://jiangsu.sinaimg.cn/zt/s/hnqccy/gbg.jpg"); background-size:100% 100%; }
#page2 #gameZone{ position: absolute; top: 0; left: 0;}
#page2 .ui_infoPannel{ position: absolute; top: 0; width: 100%; color: #FFF;}
#page2 #gc_pause{
display:none;
font-size: 18px;
position: absolute;
right:2px;
top: 0px;
border-radius: 5px;
background: none;
border: 2px solid #333;;
z-index: 3;
}
#page2 .ui_timebox,#page2 .ui_scorebox{ display: inline-block; width: 100px;
text-align: right; 
font-size: 14px;
margin-right: 5px;
padding-left: 5px; 
padding-bottom: 3px; 
 }
#page2 .ui_timebox{ font-style: italic; font-size: 16px; color: #FFF; line-height: 40px;}
#page2 .ui_scorebox{ background-image: url("http://jiangsu.sinaimg.cn/zt/s/hnqccy/guan.png"); background-size:100% 100%; width: 41px; height: 21px; line-height: 26px;padding-right: 40px;margin-left: 68px;}


#page3 p{ text-align: center; font-size: 40px; padding-top: 100px;}
#page3 #gc_restart{ width: 100px; height: 40px; text-align:center; line-height:40px; font-size:22px; margin: 15px auto 0px; display: block;
border: none;
border-radius: 4px;
color: #FFF;
background-color: #eb9b07;
box-shadow: 0px 5px #c07e05;
}
.page{ width: 320px; height:480px; position: absolute; left: 0; top: 0; }
#page3{ z-index: 3; background-color: RGBA(0,0,0,0.8); font-size:12px;}
#page2,#page3{display: none;}
</style>



<!-- page Auto scale -->
<script type="text/javascript">
	$(function() {
		pageAutoScale();
	});
	$(window).resize(function() {
		pageAutoScale();
	});
	var r;
	function pageAutoScale(){
		r = document.body.offsetWidth / 640;
		$(".swiper-container").css("-webkit-transform", "scale(" + r + ")");
		$("body").height( window.innerHeight ); //修正整数页面高度
		if (window.innerHeight<=960*r) {  //当用户显示区域小于960高度时，调整每页高度。
			//$(".swiper-container").css("height", parseInt( window.innerHeight / r) );
			$("#page-provider-bottom").css({"top":(window.innerHeight / r ) - $("#page-provider-bottom").height() , "bottom" : "auto"});  //服务提供商置于可视区域bottom
		}
	}
</script>
<!-- page switcher -->
<script type="text/javascript">
	function page(num,rate){
		var $page = $(".page"); 
		
		switch (num) {
		case 1:
			gameReset();
			$page.eq(0).show();
			$page.eq(1).hide();
			$page.eq(2).hide();
			break;
		case 2:
			$page.eq(1).fadeIn(200,function(){$page.eq(0).hide();});
			gameStart(rate);
			break;
		case 3:
			$page.eq(2).fadeIn(200);
			break;
		default:
			break;
		}
		
	}
</script>

<!-- 微信分享js -->
<script type="text/javascript">
	var dataForWeixin = {
		appId : "",
		title : "2014红牛全城穿越城市定向挑战赛，火爆开赛！",
		TLImg : "http://jiangsu.sinaimg.cn/zt/s/hnqccy/ico.jpg",
		desc : "",
		url : "http://jiangsu.sina.com.cn/zt/s/hnqccyh5.html", //请填写分享出去的URL
		TLTitle: "2014红牛全城穿越城市定向挑战赛，火爆开赛！" //朋友圈文字 iPhone max 30

	};

	var onBridgeReady = function() {
		
		//发送给朋友、群组
		WeixinJSBridge.on('menu:share:appmessage', function(argv) {
			WeixinJSBridge.invoke('sendAppMessage', {
				"appid" : dataForWeixin.appId,
				"img_url" : dataForWeixin.TLImg, //图片
				"title" : dataForWeixin.title, //标题
				"desc" : dataForWeixin.desc, //分享内容
				"link" : dataForWeixin.url,
			},function(){
				//alert("发送给朋友回调()");
				//location.href = "http://www.baidu.com";
			});
		});
		
		//分享到朋友圈
		WeixinJSBridge.on('menu:share:timeline', function(argv) {
			WeixinJSBridge.invoke('shareTimeline', {
				"appid" : dataForWeixin.appId,
				"title" : dataForWeixin.TLTitle, //描述文字
				"img_url" : dataForWeixin.TLImg, //图片
				"link" : dataForWeixin.url,
				"desc" : dataForWeixin.desc, //无用！必须存在！分享内容
			}, function (){
				//alert("分享到朋友圈回调()");
				
			});
		});

	};

	if (document.addEventListener) {
		document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
	} else if (document.attachEvent) {
		document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
		document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
	}
</script>

<!-- game -->
<script type="text/javascript">
	
	var gameZone = document.getElementById("gameZone");
	var canvas=gameZone.getContext("2d");


	var continerDom = $("#page2");
	var diskDom = $("#ui_disk");
	var scoreDom = $(".ui_score");
	var finalScoreDom = $("#ui_finalScore");
	var timeDom = $(".ui_time");
	var GAMEWIDTH = 320;
	var GAMEHEIGHT = 480;
	var FPS = 60;
	var SPEED = 5; //游戏速度
	var meter = 0;
	var fruitCount = 10000; //元素id
	var frame = 0;
	var score = 0;
	var time = 0;
	var pause = false;
	var fruits = [];
	var iFrame; //帧循环器
	var iTime;  //游戏时间计时器
	var rate = 20;   //水果产生率
	
	var img_3 = new Image(); img_3.src = "http://jiangsu.sinaimg.cn/zt/s/hnqccy/e1.png";
	var img_1 = new Image(); img_1.src = "http://jiangsu.sinaimg.cn/zt/s/hnqccy/e1.png";
	var img_m1 = new Image(); img_m1.src = "http://jiangsu.sinaimg.cn/zt/s/hnqccy/e2.png";
	var img_bg = new Image(); img_bg.src = "http://jiangsu.sinaimg.cn/zt/s/hnqccy/e3.png";
	var img_e0 = new Image(); img_e0.src = "http://jiangsu.sinaimg.cn/zt/s/hnqccy/e0.png";
	var img_e00 = new Image(); img_e00.src = "http://jiangsu.sinaimg.cn/zt/s/hnqccy/e00.png";
	
	
	var disk = {
			x: 30,
			y: 320,
			width: 40,
			height: 60,
			frame: 0,
			update: function (x){
						x = x<35 ? 35 : x;
						x = x>274 ? 274 : x;
						this.x = x;
					},
			draw : function(){
				if (frame%parseInt((FPS/SPEED)*4) <= FPS/SPEED/0.5) {
					//canvas.fillStyle = "#583a03";
					//canvas.fillRect(this.x,this.y,this.width,this.height);
					canvas.drawImage(img_e0, this.x -10 , this.y , img_e0.width, img_e0.height);
				}else{
					//canvas.fillStyle = "#3e2802";
					//canvas.fillRect(this.x,this.y,this.width,this.height);
					canvas.drawImage(img_e00, this.x -10 , this.y , img_e00.width, img_e00.height);
				}
				
			}
	};
	
	//背景构造器
	var BG = {
		x : 29,
		y : 0,
		update : function(dis){
			this.y += dis;
		},
		draw : function() {
			if (this.y >= img_bg.height) {
				this.y = 0;
			}
			canvas.drawImage(img_bg,this.x,this.y-img_bg.height, img_bg.width, img_bg.height);
			canvas.drawImage(img_bg,this.x,this.y, img_bg.width, img_bg.height);
		}
	}
	
	var t_f = [
			   {score : 1, className: "f_1"},
			   {score : 1, className: "f_1"},
			   {score : 0,className: "f_-10"}]; 
	
	/* 游戏入口 */
	function gameStart(rate){
		this.rate = rate;
		gameReset();
		timer();//计时器
		/* 帧播放 */
		iFrame = setInterval(function() {
			frame++;
			update();
			
			meter += SPEED/FPS;
			SPEED = SPEED>10 ? 10 : SPEED;
			if ( frame%360 === 0) {
				SPEED +=0.6;
			}
		}, 1000/FPS);
	}
	
	var ui_gc_pause = document.getElementById("gc_pause");
	function gamePause(){
		pause = !pause;
		
		//weixin
		
		dataForWeixin.desc = "我在全城穿越游戏中领到"+score+"罐红牛！11月8日十点白马公园，我们不见不散！";
		dataForWeixin.TLTitle = "我在全城穿越游戏中领到"+score+"罐红牛！11月8日十点白马公园，我们不见不散！";
		
		
		pause ? ui_gc_pause.innerHTML="继续" : ui_gc_pause.innerHTML="暂停";
	}
	
	/* 游戏重置 */
	function gameReset(){
		fruitCount = 10000; //元素id
		frame = 0;
		score = 0;
		time = 0;
		SPEED = 5; //游戏速度
		meter = 0;
		frame = 0;
		pause = false;
		fruits = [];
		
		clearInterval(iFrame); //帧停止
		clearInterval(iTime);  //时间计时停止
		
		scoreDom.text(score);
		
		//移除所有 f_ 开头的类元素
		//$("div:[class^=abs f_]").remove();
	}
	
	/* 帧更新 */
	function update() {
		if(pause){return;}
		canvas.clearRect(0, 0, GAMEWIDTH, GAMEHEIGHT);
		handleBGUpdate();
		handleBGDraw();
		handleFruitsAdd();
		handleFruitsUpdate(); //水果位置更新
		handleFruitsDraw(); //水果位置绘制
		handleDiskDraw();
		handleCollisions(); //碰撞检测
	}
	
	
	function handleBGUpdate() {
		BG.update(SPEED);
	}
	function handleBGDraw() {
		BG.draw();
	}
	
	function handleFruitsAdd() {
		//if(time<0){return;} //游戏不需要停止
		if(frame%parseInt((FPS/SPEED)*4)  == 0){ // 生成水果
			var r = Math.floor(Math.random()*t_f.length)//随机水果
			var f = t_f[r];
			fruits.push(fruit({
				x: parseInt(Math.random()*4)*70+57,
				score : f.score,
				className: f.className
			}));
			//console.info("Fruit pushed!");
		}
	}
	
	function handleFruitsUpdate() {
		fruits.forEach(function(F) { //水果位置更新
			//F.isInited ? F.update() : F.init();
			F.update();
		});
	}
	function handleFruitsDraw() {
		fruits.forEach(function(F) { //水果位置绘制
			F.draw();
		});
	}
	function handleDiskDraw() {
		disk.draw();
	}
	
	
	function handleCollisions() {
		fruits.forEach(function(F) {
			if (collides(F, disk)) {
				F.catched();
			}
		});
	}
	function collides(a, b) {
		  return a.x < b.x + b.width &&
		         a.x + a.width > b.x &&
		         a.y < b.y + b.height &&
		         a.y + a.height > b.y;
	}
	
	
	/* 时间 */
	function timer() {
		//timeDom.text(time);
		iTime = setInterval(function() {
			time += 0.1;
			if(pause){
				//等待最后一波水果掉落完毕
				setTimeout(function() {
					//设置分数
					//finalScoreDom.text(score);
					page(3);
					
				},300);
				setTimeout(function() {
					//处理微信方法
					
				}, 300);
				clearInterval(iTime);
				return;
			}
			timeDom.text(meter.toFixed(1));
		}, 100);
	}
	


	
	//水果构造器
	function fruit(F) {
		//F.x = 60;
		F.y = -50;
		F.width = 10;
		F.height = 30;
		//F.score = 3;
		F.v = SPEED;           //初速度
		F.id = "fruit_"+fruitCount;
		fruitCount++;
		//F.className = "f_3"; 
		
		F.update = function() {
			this.frame++;
			F.y += F.v;
			
			//var obj = $("#"+this.id);
			//obj.css("top",this.y);
			
			if(this.y >= GAMEHEIGHT){
				F.out();
			}
		};
		
		F.draw = function(){
			switch (this.score) {
			case 1:
				canvas.drawImage(img_1,this.x - 36,this.y, img_1.width, img_1.height);
				break;
			case 0:
				canvas.drawImage(img_m1,this.x - 24,this.y, img_m1.width, img_m1.height);
				break;
			default:
				break;
			}
			
		}
		F.destory = function() {
			$("#"+F.id).remove();
			fruits.forEach(function(o,i) {
				if(o.id === F.id){
					fruits.splice(i,1);
				}
			});
		}
		F.catched = function() { //被接住
			//console.log("Catched! " +this.score);
			//销毁div
			score += this.score; //分数计算
			scoreDom.text(score);
			
			//撞到垃圾游戏结束
			if (this.score == 0) {
				gamePause();
			}
			
			
			//scoreBubble(this.x,this.y,this.score); // 分数气泡
			 
			this.destory();
		};
		F.out = function() { //跌出屏幕
			//销毁div
			this.destory();
		};
		
		
		return F;
	}
	
	/* 分数气泡 */
	function scoreBubble(x,y,score) {
		var scoreText =  score>0 ? "+"+score : ""+score;
		$("<div>",{
	        "class": "abs score_"+score,
	        "id": this.id,
	        text: scoreText,
	        css:{
	            "left": x,
	            "top": y
	        }
	    }).appendTo(continerDom).animate({top:y-100,opacity:0},1000,function(){$(this).remove()});
	}

	
	//disk随鼠标移动
	$(function() {
		$(".swiper-container").bind("mousemove touchstart touchmove", function(e) {
			
			
			if( e.type === "mousemove"){
				var x = e.clientX / r /2;
			}else{
				var touch = event.targetTouches[0];  
				var x = touch.pageX / r /2;
			}
			diskMove(x);
		});
		
		$("canvas").bind("touchmove", function(e) {
			e.preventDefault();
		});
	});
		
	
	
	function diskMove(x) {
		var x = x - disk.width/2;
		disk.update(x); //更新对象属性
		//diskDom.css("left",x); //dom位置更新 
	}
	
</script>



</html>
