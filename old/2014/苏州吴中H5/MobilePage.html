<!DOCTYPE html>
<html>
<head>
<meta charset="GB2312">
<meta http-equiv="Cache-Control" content="no-cache"/>
<meta name="format-detection" content="telephone=no"/>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"> 
<title>苏州吴中太湖旅游拼图游戏</title>
<meta name="keywords" content="吴中,太湖,旅游,拼图游戏" />
<meta name="description" content="苏州吴中太湖旅游拼图游戏" />
<script src="http://i2.sinaimg.cn/cj/dfz/js/base.js" type="text/javascript"></script>
<!-- 
<script src="http://jiangsu.sinaimg.cn/js/jquery.transit.min.js"></script>
 -->
<style type="text/css">
body, ul, ol, li, p, h1, h2, h3, h4, h5, h6, table, td, th, form, fieldset, img, dl, dt, dd { margin:0; padding:0; }
textarea, input, select, body { font-size:12px; }
select, input { vertical-align:middle; }
fieldset, img { border:0; }
ul, ol { list-style:none; }
img { border:0; }
a { text-decoration:none; color:#000; }
a:hover { color:#ffa10d; }
.fl { float:left; display:inline; }
.fr { float:right; display:inline; }
.cb { clear:both; display:block; height:0px; overflow:hidden; width:100%; }
.clearfix:after { clear:both; content:""; display:block; height:0; }
</style>
<style type="text/css">
body {
	background: url("http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153757.gif") no-repeat center top;
	background-size: 100% auto;
}
#pageContent{
	padding: 0 20px;
}
#p1{
	margin-top: 108px;
}
.title{
	text-align: center;
	color: #02aeee;
	font-size: 16px;
	margin: 10px 0 15px 0;
}
#gameBox{
	position: absolute;
}
#gameBlock{
	width: 280px;
	height: 280px;
	margin: 0 auto;
	position: relative;
}
#imgArea {
width: 280px;
height: 280px;
position: relative;
}
#gameImgSelect{
	position: absolute;
}
#gameImgPreview{
	width: 280px;
	height: 280px;
	position: absolute;
	z-index: 100;
	display: none;
}
#gameImgSelect img{
width: 89px;
height: 89px;
cursor: pointer;
display: block;
float: left;
margin: 0px;
border: 2px solid transparent;
}
#gameImgSelect .imgselect{
	border: 2px solid #02aeee;
	border-radius:2px;
}
#gameFunctionBlock{
	position: relative;
	margin-top: 10px;
	height: 34px;
}
#startBtn, #resetBtn{
	width: 128px;
	height: 34px;
	background-image: url("http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153749.png");
	background-size: 100%;
	color: #FFF;
	line-height: 32px;
	margin: 0 auto;
	text-align: center;
	font-size: 14px;
	cursor: pointer;
}
#startBtn, #resetBtn{
	display: none;
}
#timer{
	position: absolute;
	top: 0px;
	line-height: 32px;
	left: 74%;
}

#p3{
	margin-top: 13px;
}
#ranking{
}
#ranking .title{
	margin: 0;
}
#weixinBlock{
}
#ranking,#weixinBlock{
	width: 50%;
	float: left;
}

.color02aeee{
	color: #02aeee;
}
.right{
	text-align: right;
}

/* game */
#imgArea div.imgCell { -webkit-transform: translateZ(0);
-moz-transform: translateZ(0);
-ms-transform: translateZ(0);
transform: translateZ(0);float: left; width: 73px; height: 73px; border: 2px solid #fff; border-radius: 4px; position: absolute; z-index: 10; box-shadow: 0px 0px 8px #fff; transition-property: background-position; transition-duration: 300ms; transition-timing-function: ease-in-out; }
#imgArea div.hover { filter: alpha(opacity=80); opacity: .8; box-shadow: 0px 0px 8px #000; z-index: 20; *border:1px solid #09F;
}
</style>
</head>
<body>
<div id="pageContent">
	<div id="p1" class="clearfix">
		<div style="float: left; display: inline-block; margin-right: 8px;">
			<img alt="" src="http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153749_1.png" width="70px">
		</div>
		<div style="float: left; display: inline-block; width: -moz-calc(100% - 78px);width: -webkit-calc(100% - 78px);width: -ms-calc(100% - 78px);width: calc(100% - 78px); line-height: 14px;">
			1.9张吴中风景美图任你选，让你爱上吴中；<br/>
			2.排名前30名的拼图达人即可赢取价值100元的吴中旅游精美杂志；<br/>
			3.点击开始“开始拼图”按钮，立即加入拼图大战；<br/>
			4.完成拼图，输入微信号即参加排名；<br/>
			5.关注“太湖旅游”微信，第一时间获取领奖方式；<br/>
			6.把你的战绩截图发给太湖旅游，就有机会赢取吴中旅游精美杂志。
		</div>
	</div>
	<div id="p2">
		<div class="title">选择一张图片开始拼图<img alt="" src="http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153750.png" width="14" style="margin: 0 0 -9px 4px;"></div>
		<div id="gameBlock">
			<div id="gameBox">
				<div id="imgArea"></div>
			</div>
			<div id="gameImgSelect">
				<img alt="" src="http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153756.jpg" />
				<img alt="" src="http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153755_1.jpg" />
				<img alt="" src="http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153755.jpg" />
				<img alt="" src="http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153754.jpg" />
				<img alt="" src="http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153753_1.jpg" />
				<img alt="" src="http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153753.jpg" />
				<img alt="" src="http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153752.jpg" />
				<img alt="" src="http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153751_1.jpg" />
				<img alt="" src="http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153751.jpg" />
			</div>
			<div id="gameImgPreview"></div>
		</div>
		<div id="gameFunctionBlock">
			<div id="startBtn">开始游戏</div>
			<div id="resetBtn">重新开始</div>
			<div id="timer">时间：<span id="timeSecond">0.0</span>秒</div>
		</div>
	</div>
	<div id="p3" class="clearfix">
		<div id="ranking">
			<div class="title">游戏排名<br><span style="color: #ffc300; font-size: 13px;">RANKING</span></div>
			<div id="rankingList">
				<table style="margin: 0 auto;" class="yy_yh">
					<tr><td>01</td><td>185*****234</td><td>23.0秒</td></tr>
					<tr><td>02</td><td>185*****234</td><td>3.0秒</td></tr>
					<tr><td>01</td><td>185*****234</td><td>3.0秒</td></tr>
					<tr><td>01</td><td>185*****234</td><td>3.0秒</td></tr>
					<tr><td>01</td><td>185*****234</td><td>3.0秒</td></tr>
					<tr><td>01</td><td>185*****234</td><td>3.0秒</td></tr>
					<tr><td>01</td><td>185*****234</td><td>0.1秒</td></tr>
					<tr><td>01</td><td>185*****234</td><td>3.0秒</td></tr>
					<tr><td>09</td><td>185*****234</td><td>3.0秒</td></tr>
					<tr><td>10</td><td>185*****234</td><td>23.0秒</td></tr>
				</table>
			</div>
		</div>
		<div id="weixinBlock">
			<div style="text-align: center;margin-top: 30px;"><img alt="" src="http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821175235.gif" width="77"></div>
			<div style="text-align: center;">扫一扫关注“太湖旅游”微信<br>
				第一时间获取中奖信息<br>
				最终活动解释权归太湖旅游所有
			</div>
		</div>
	</div>
	<div id="p4" style="display:none;">
	<a style="font-size: 16px; color:#f2395a; " href="http://mp.weixin.qq.com/s?__biz=MjM5MDI4MTUwMA==&amp;mid=200851464&amp;idx=1&amp;sn=a2259cf7ecb9cf7659ce0ea1dc5a18c5#rd" target="_blank">关注我们</a></div>
</div>
<!-- 分享到朋友圈 -->
<style>
.fenxiang {
	z-index:100;
	text-align: center;
	padding-top: 25px;
	width:100%;
	background:RGBA(0,0,0,0.5) url("http://jiangsu.sinaimg.cn/zt/s/2014qixi/qixi/7.png") no-repeat right 0;
	background-size: 40px auto;
	color: #FFF;
	font-size: 20px;
	height: 50px;
	position: fixed;
	top: 0;
	display: none; 
}
</style>
<div class="fenxiang">分享到<span class="red">朋友圈</span></div>
</body>
<script type="text/javascript">
var imgsrc = "";
(function() {
	$("#gameImgSelect img").live("touchend", function() {
		$("#gameImgSelect img").removeClass("imgselect");
		$(this).addClass("imgselect");
		imgsrc = $(this).attr("src");
		//console.log("点击-开始拼图:"+imgsrc);
		$("#gameImgSelect").hide(); //隐藏选择界面
		$("#startBtn").die();
		var pg = new puzzleGame({ 'img' : imgsrc });//拼图游戏开始
		$("#gameBox").show();
		$("#startBtn").show();
		$("#gameImgPreview").css("background","url('"+imgsrc+"')").show();
	});	
	/* $("#startBtn").live("touchstart", function() {
		if(imgsrc==""|imgsrc==undefined){
			alert("请先选择一张图片吧～");
			return;
		}
		//console.log("点击-开始拼图:"+imgsrc);
		$("#gameImgSelect").hide(); //隐藏选择界面
		$("#startBtn").die();
		var pg = new puzzleGame({ 'img' : imgsrc });//拼图游戏开始
		$("#gameBox").show();
	}); */
	
	//设置排行榜表格最后一列
	$("#rankingList tr").find(":last-child").css("text-align","right");
	//设置排名序号染色
	$("#rankingList tr").find(":first-child").css("color","#02aeee");
	
	$(".fenxiang").live("touchstart", function() {
		$(this).fadeOut(300);
	});
})();
</script>
<!-- 拼图js -->
<script type="text/javascript">
var t;
var s=ms=ten=lock=0;
var cellphone = 0;
function startTime() 
{ 
	ms++;
	if (ms>=10){s++;ms=0;}
	$('#timeSecond').html(s+"."+ms); 
	t=setTimeout('startTime()',100);
} 
function resetTime()
{
	clearTimeout(t);
	$('#timeSecond').html(0+"."+0);	
}


function topTen()
{
	$(".yy_yh").html("");
	$.JSONP('http://act.city.sina.com.cn/interface/activity/json_get_user_works.php',{act_id:6898,p:1,pcount:999999,order:'vote'},function(json){
		var jDate = json.data;	
		for (var i = 0; i < jDate.length; i++)
        {
            for (var j = i; j < jDate.length; j++)
             {
               if (parseFloat(jDate[i]["form_data"]["custom_1"]["value"]) > parseFloat(jDate[j]["form_data"]["custom_1"]["value"]))
                {
                    var temp = jDate[i];
                    jDate[i] = jDate[j];
                    jDate[j] = temp;
                }
            }
		}
		$.each(jDate, function (index, value) 
		{	
			//console.log(value);
			var custom_1 = 	value.form_data.custom_1.value;
			var custom_2 = 	value.form_data.custom_2.value;//微信号
			var html = '<tr>';
			html +='<td class="color02aeee">'; //索引
			if (index+1<10) {
				html +="0"+(index+1);
			}else{
				html +=(index+1);
			}
			html +='</td><td>';
			html += custom_2.substring(0,6)+'*****';		//微信号
			html +='</td><td class="right">'; //时间
			html += custom_1; 
			html +='秒</td>';
			html +='</tr>';
			$(".yy_yh").append(html);
			if (index+1 >= 10) {
				return false;
			}
			//if(index==9){ ten=value.form_data.custom_1.value;return false;}
		});
	});
}

topTen();

/* 提交得分 */
function subData(a,b){
	var t_phone = a;
	if(t_phone ==""| t_phone==undefined){ //实在不想填手机号
		return;
	}
		
	$.JSONP('http://act.city.sina.com.cn/interface/activity/json_add_signup.php',{act_id:6898,custom_1:b,custom_2:t_phone},function(bm){
		lock=0;
		if(bm.error==0){
			alert("提交成功～快向下滑动查看英雄榜～");
			topTen(); // 刷新游戏排名
		}else{
			//alert(bm.errmsg);
			alert("微信号写错了？");
			var cellphone = prompt("要仔细填写微信号哦:","");
			subData(cellphone,b);
		}
	});
}


$(".reset").live("click",function()
		{
			s=ms=0;
			$("#myBg").hide();
			$(".myCon").hide();
		})

/* $(".sub").live("click",function(){
	if(lock==0){
		lock=1;
		var cellphone = $("#t_phone").val();	
		var partten = /^[1-9][0-9]{4,13}$/;	
		if(!partten.test(cellphone)){alert("请填写正确的QQ号！"); return false;}	
		subData(cellphone,s+(ms*0.1));
		s=ms=0;
	}
	
}) */
		
var puzzleGame = function (param) 
{
    this.img = param.img || '';
    this.btnStart = $('#startBtn');
	this.myPhone = $('#phone');
    this.imgArea = $('#imgArea');
    this.imgCells = '';
    this.imgOrigArr = [];
    this.imgRandArr = [];
    this.levelArr = [[3, 3]];
    this.levelNow = 0;
    this.imgWidth = parseInt(this.imgArea.css('width'));
    this.imgHeight = parseInt(this.imgArea.css('height'));
    this.cellWidth = this.imgWidth  / this.levelArr[this.levelNow][1];
    this.cellHeight = this.imgHeight  / this.levelArr[this.levelNow][0];
    this.hasStart = 0;
    this.moveTime = 200;
	this.myTime;
	this.seconds=this.ms=0;
    this.init();
    
}
puzzleGame.prototype = 
{
    init : function () 
    {
        this.imgSplit();
        this.gameState();
    },
    imgSplit : function () 
    {
        this.imgOrigArr = [];
        this.imgArea.html("");
        var cell = '';
        for (var i = 0; i < this.levelArr[this.levelNow][0]; i++) 
        {
            for (var j = 0; j < this.levelArr[this.levelNow][1]; j++) 
            {
                this.imgOrigArr.push(i * this.levelArr[this.levelNow][1] + j);
                cell = document.createElement("div");
                cell.className = "imgCell";
                $(cell).css(
                {
                    'width' : (this.cellWidth - 2) + 'px', 'height' : (this.cellHeight - 2) + 'px', 'left' : j * this.cellWidth + 'px',
                    'top' : i * this.cellHeight + 'px', "background" : "url('" + this.img + "')", 'backgroundPosition' : ( - j) * this.cellWidth + 'px ' + ( - i) * this.cellHeight + 'px' 
                });
                this.imgArea.append(cell);
            }
        }
        this.imgCells = $('#imgArea div.imgCell');
    },
    gameState : function () 
    {
        var self = this;
        
        this.btnStart.bind('touchstart', function () 
        {
            $(this).addClass('mouseOn');
        }).bind('click', function () 
        {
			$(this).removeClass('mouseOn');
			if (self.hasStart == 0) 
					{
				$("#gameImgPreview").hide();
						$(this).text('重新开始');
						startTime();
						self.hasStart = 1;
						self.randomArr();
						self.cellOrder(self.imgRandArr);
						self.imgCells.css({
							'cursor' : 'pointer' 
						}).bind('touchstart', function (e) 
						{
					e.preventDefault();
					var touch = event.targetTouches[0];
					$(this).addClass('hover');
                    /*此处是图片移动*/
                    $(this).css('cursor', 'move');
                    //所选图片碎片的下标以及鼠标相对该碎片的位置
                    var cellIndex_1 = $(this).index();
                    var cell_mouse_x = touch.pageX - self.imgCells.eq(cellIndex_1).offset().left;
                    var cell_mouse_y = touch.pageY - self.imgCells.eq(cellIndex_1).offset().top;
					
                    $(document).bind('touchmove', function (e2) 
                    {
						e2.preventDefault();
						var touch2 = event.targetTouches[0];
						//alert(touch2.pageX - cell_mouse_x - self.imgArea.offset().left)
                        self.imgCells.eq(cellIndex_1).css(
                        {
                            'z-index' : '40', 'left' : (touch2.pageX - cell_mouse_x - self.imgArea.offset().left) + 'px', 
                            'top' : (touch2.pageY - cell_mouse_y - self.imgArea.offset().top) + 'px' 
                        });
                    }).bind('touchend', function (e3) 
                    {
                        //被交换的碎片下标
						e3.preventDefault();
						var touch3 = event.changedTouches[0];
						//console.log(touch3); 
                        var cellIndex_2 = self.cellChangeIndex((touch3.pageX - self.imgArea.offset().left), 
                        (touch3.pageY - self.imgArea.offset().top), cellIndex_1);
						//console.log(cellIndex_2); 
                        //碎片交换
                        if (cellIndex_1 == cellIndex_2) {
                            self.cellReturn(cellIndex_1);
                        }
                        else {
                            self.cellExchange(cellIndex_1, cellIndex_2);
                        }
                        //移除绑定
                        $(document).unbind('touchmove').unbind('touchend');
                    });
                }).bind('touchend', function () 
						{
							$(this).removeClass('hover');
							$(this).css('cursor', 'pointer');
						});
					}
					else if (self.hasStart == 1) 
					{
						
						if (!confirm('确定要重新开始？')) {
							return false;
						}
						resetTime();
						s=ms=0;
						$(this).text('开始拼图');
						self.hasStart = 0;
						self.cellOrder(self.imgOrigArr);
						self.imgCells.css('cursor', 'default').unbind('touchstart').unbind('touchend').unbind('touchstart');
						$("#gameImgSelect").show();
						$("#startBtn").hide();
						$("#gameBox").fadeOut();
						$("#startBtn").unbind();
						$("#startBtn").live("touchstart", function() {
							if(imgsrc==""|imgsrc==undefined){
								alert("请先选择一张图片吧～");
								return;
							}
							//console.log("点击-开始拼图:"+imgsrc);
							$("#gameImgSelect").hide(); //隐藏选择界面
							$("#startBtn").die();
							var pg = new puzzleGame({ 'img' : imgsrc });//拼图游戏开始
							$("#gameBox").show();
							$("#startBtn").show();
							$("#gameImgPreview").css("background","url('"+imgsrc+"')").show();
						});
						$("#gameImgSelect img").die();
						$("#gameImgSelect img").live("touchend", function() {
							$("#gameImgSelect img").removeClass("imgselect");
							$(this).addClass("imgselect");
							imgsrc = $(this).attr("src");
							//console.log("点击-开始拼图:"+imgsrc);
							$("#gameImgSelect").hide(); //隐藏选择界面
							$("#startBtn").die();
							var pg = new puzzleGame({ 'img' : imgsrc });//拼图游戏开始
							$("#gameBox").show();
							$("#startBtn").show();
							$("#gameImgPreview").css("background","url('"+imgsrc+"')").show();
						});	
					}
					
					
			
			
        });
		
       
      //模拟触发事件
		//this.btnStart.click();
		//puzzleGame.prototype.gameState.btnStart.click();
        //this.btnStart.delay(1000).click();
        /////////////////////
    },
    randomArr : function () 
    {
        this.imgRandArr = [];
        var order;
        for (var i = 0, len = this.imgOrigArr.length; i < len; i++)  
        {
            order = Math.floor(Math.random() * len);  //产生随机数
            if (this.imgRandArr.length > 0)  
            {
                while (jQuery.inArray(order, this.imgRandArr) > - 1) { //如果当前产生的随机数已经存在于数组中，则重新获取随机数
                    order = Math.floor(Math.random() * len);
                }
            }
            this.imgRandArr.push(order);
        }
        return;
    },
    cellOrder : function (arr) 
    {
        for (var i = 0, len = arr.length; i < len; i++) 
        {
            this.imgCells.eq(i).animate(
            {
                'left' : arr[i] % this.levelArr[this.levelNow][1] * this.cellWidth + 'px', 'top' : Math.floor(arr[i]  / this.levelArr[this.levelNow][0]) * this.cellHeight + 'px' 
            },
            this.moveTime);
        }
    },
    cellChangeIndex : function (x, y, orig) 
    {
        if (x < 0 || x > this.imgWidth || y < 0 || y > this.imgHeight) {
            return orig;
        }
        var row = Math.floor(y  / this.cellHeight), col = Math.floor(x  / this.cellWidth), location = row * this.levelArr[this.levelNow][1] + col;
        var i = 0, len = this.imgRandArr.length;
        while ((i < len) && (this.imgRandArr[i] != location)) {
            i++;
        }
        return i;
    },
    cellExchange : function (from, to) 
    {
        var self = this;
        var rowFrom = Math.floor(this.imgRandArr[from]  / this.levelArr[this.levelNow][1]);
        var colFrom = this.imgRandArr[from] % this.levelArr[this.levelNow][1];
        var rowTo = Math.floor(this.imgRandArr[to]  / this.levelArr[this.levelNow][1]);
        var colTo = this.imgRandArr[to] % this.levelArr[this.levelNow][1];
        var temp = this.imgRandArr[from];
        this.imgCells.eq(from).animate({
            'top' : rowTo * this.cellHeight + 'px', 'left' : colTo * this.cellWidth + 'px' 
        },
        this.moveTime, function () 
        {
            $(this).css('z-index', '10');
        });
        this.imgCells.eq(to).css('z-index', '30').animate({
            'top' : rowFrom * this.cellHeight + 'px', 'left' : colFrom * this.cellWidth + 'px' 
        },
        this.moveTime, function () 
        {
            $(this).css('z-index', '10');
            self.imgRandArr[from] = self.imgRandArr[to];
            self.imgRandArr[to] = temp;
            if (self.checkPass(self.imgOrigArr, self.imgRandArr)) {
                self.success();
            }
        });
    },
    cellReturn : function (index) 
    {
        var row = Math.floor(this.imgRandArr[index]  / this.levelArr[this.levelNow][1]);
        var col = this.imgRandArr[index] % this.levelArr[this.levelNow][1];
        this.imgCells.eq(index).animate({
            'top' : row * this.cellHeight + 'px', 'left' : col * this.cellWidth + 'px' 
        },
        this.moveTime, function () 
        {
            $(this).css('z-index', '10');
        });
    },
    checkPass : function (rightArr, puzzleArr) 
    {
        if (rightArr.toString() == puzzleArr.toString()) {
            return true;
        }
        return false;
    },
    success : function () 
    {
        for (var i = 0, len = this.imgOrigArr.length; i < len; i++) 
        {
            if (this.imgCells.eq(i).has('mouseOn')) {
                this.imgCells.eq(i).removeClass('mouseOn');
            }
        }
        this.imgCells.unbind('touchstart').unbind('touchend').unbind('touchend');
        this.btnStart.text('开始拼图');
        this.hasStart = 0;
		
		if(parseFloat(s+ms*0.1)<=parseFloat(ten))
		{
			$("#myBg").show();
			$("#myConV").show();
		}else
		{
			$("#myBg").show();
			$("#myConF").show();
		}
		this.imgCells.unbind('touchstart').unbind('touchend').unbind('touchend');
		this.btnStart.text('再来一次');
		this.hasStart = 1;
		
		gameFinished();
		
    }
}

/* 游戏完成！ */
function gameFinished() {
	clearTimeout(t);
	var timeuse = parseFloat($('#timeSecond').html());
	
	//微信内容变更
	dataForWeixin.title = "苏州吴中旅游拼图游戏";
	dataForWeixin.desc = "我只用了"+timeuse+"秒就完成了拼图哟～赢取吴中旅游精美杂志，快来挑战吧～";
	dataForWeixin.TLTitle = "我只用了"+timeuse+"秒就完成了拼图哟～赢取吴中旅游精美杂志，快来挑战吧～";
	$(".fenxiang").show();
	
	//时间太长直接忽略
	if( timeuse > 12 ){
		alert("加油哇～加把劲就能挤进排行榜了呢");
		resetTime(); // 重置时间
	}else{
		
		//判断是否进了前30
		//服务器查询
		$.JSONP('http://act.city.sina.com.cn/interface/activity/json_get_user_works.php',{act_id:6898,p:1,pcount:999999,order:'vote'},function(json){
		var jDate = json.data;	
		for (var i = 0; i < jDate.length; i++) {
            for (var j = i; j < jDate.length; j++)
             {
               if (parseFloat(jDate[i]["form_data"]["custom_1"]["value"]) > parseFloat(jDate[j]["form_data"]["custom_1"]["value"]))
                {
                    var temp = jDate[i];
                    jDate[i] = jDate[j];
                    jDate[j] = temp;
                }
            }
		}
		
		//如果进入了前30 名
		if( timeuse < parseFloat(jDate[29]["form_data"]["custom_1"]["value"]) ){
			cellphone = prompt("用时"+$('#timeSecond').html()+"秒～恭喜您荣登排行榜，留下您的微信大名吧。", "");//弹窗
			//TODO 向服务器提交用户信息；
			subData(cellphone, timeuse);
		}else {
			//没进入前30名
			alert("好可惜，差一点就进入前30呢～加把劲儿～");
		}
		
		resetTime(); // 重置时间
		});
	}
	
	
	return;
}

</script>
<!-- 微信分享js -->
<script type="text/javascript">
var dataForWeixin = {
		appId : "",
		title : "苏州吴中旅游拼图游戏",
		TLImg : "http://jiangsu.sinaimg.cn/2014/0821/U9263P1194DT20140821153757.gif",
		desc : "玩拼图游戏赢取吴中旅游精美杂志，快来参加吧～",
		url : "http://jiangsu.sina.com.cn/zt/s/SuzhouWuzhongPuzzleGame_H5.html", //请填写分享出去的URL
		TLTitle: "玩拼图游戏赢取吴中旅游精美杂志，快来参加吧～"

	};

	var onBridgeReady = function() {
		
		//发送给朋友、群组
		WeixinJSBridge.on('menu:share:appmessage', function(argv) {
			WeixinJSBridge.invoke('sendAppMessage', {
				"appid" : dataForWeixin.appId,
				"img_url" : dataForWeixin.TLImg, //图片
				"title" : dataForWeixin.title, //标题
				"desc" : dataForWeixin.desc, //分享内容
				"link" : dataForWeixin.url,
			},function(){
				//alert("发送给朋友回调()");
				//location.href = "http://www.baidu.com";
			});
		});
		
		//分享到朋友圈
		WeixinJSBridge.on('menu:share:timeline', function(argv) {
			WeixinJSBridge.invoke('shareTimeline', {
				"appid" : dataForWeixin.appId,
				"title" : dataForWeixin.TLTitle, //描述文字
				"img_url" : dataForWeixin.TLImg, //图片
				"link" : dataForWeixin.url,
				"desc" : dataForWeixin.desc, //无用！必须存在！分享内容
			}, function (){
				//alert("分享到朋友圈回调()");
				
			});
		});

	};

	if (document.addEventListener) {
		document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
	} else if (document.attachEvent) {
		document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
		document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
	}
</script>
</html>