<!DOCTYPE html>
<html>
<head>
<meta charset="GB2312">
<meta http-equiv="X-UA-Compatible" content="IE=8" />
<title>请在此插入网页标题</title>
<meta name="keywords" content="请在此插入关键词" />
<meta name="description" content="请在此写入一段页面描述" />
<script src="http://i2.sinaimg.cn/cj/dfz/js/base.js" type="text/javascript"></script>
<style type="text/css">
body, ul, ol, li, p, h1, h2, h3, h4, h5, h6, table, td, th, form, fieldset, img, dl, dt, dd { margin:0; padding:0; }
textarea, input, select, body { font-size:12px; }
select, input { vertical-align:middle; }
fieldset, img { border:0; }
ul, ol { list-style:none; }
img { border:0; }
a { text-decoration:none; color:#000; }
a:hover { color:#ffa10d; }
.fl { float:left; display:inline; }
.fr { float:right; display:inline; }
.cb { clear:both; display:block; height:0px; overflow:hidden; width:100%; }
.clearfix:after { clear:both; content:""; display:block; height:0; }
</style>
<style type="text/css">
.headimg{ min-width: 1000px; height: 400px; background: url("http://hubei.sinaimg.cn/2014/0721/S122974T1405906828814.jpg") no-repeat center top; }
.content{ width: 1000px; margin: 0 auto; position: relative;} 
</style>
<style type="text/css">
::selection{ background-color: #f2b42f;}
.activity2{ background:url("http://jiangsu.sinaimg.cn/2014/0905/U11392P1194DT20140905024843.jpg") repeat-x center bottom #f2b42f; width:100%; padding-top:30px; padding-bottom:40px;}
.tit{ text-align:center;}
.abs{ position: absolute;}
.activity2 .wrap { width:1000px; margin:0 auto; position: relative; height: 600px;}
.activity2 .pageSwitch{ z-index:2; top: 288px; width:50px; height:114px; cursor:pointer; background-image: url("http://jiangsu.sinaimg.cn/2014/1015/U9263P1194DT20141015171209.png"); }
.activity2 .pageSwitch.pageLast{ left:-58px; }
.activity2 .pageSwitch.pageNext { left: 959px; background-position: 50px 0px; }
.activity2 .pageSwitch.pageLast:HOVER{ background-position: 0px 114px; }
.activity2 .pageSwitch.pageNext:HOVER{ background-position: 50px 114px; }

.activity2 .activityBox{ margin-top:40px; position: relative; }
.activity2 .activityBox li{background:url("http://jiangsu.sinaimg.cn/2014/1015/U9263P1194DT20141015164154.png") no-repeat center 0; width:170px; height:223px; float:left; margin:0 10px 20px 10px; position:relative;}
.activity2 .activityBox .txt{ width:122px; height:40px; font-size:12px; line-height:20px;margin: 42px 0 12px 25px; overflow: hidden;}
.activity2 .activityBox .voteNum { width: 52px; height: 27px; line-height: 27px; text-align: center; top: 94px; left: 31px; }
.activity2 .activityBox .voteButton { width: 71px; height: 27px; top: 94px; left: 85px; cursor: pointer; }
.activity2 .activityBox .floReason {  width: 122px; height: 64px; top: 149px; left: 21px; color: #dc2425; line-height: 16px; overflow: hidden; }

</style>
</head>
<body>
	<div class="headimg"></div>
	
	
	<!-- 正文 -->
	<div class="activity2">
	    <div class="wrap">
		    <div class="tit"><img src="http://jiangsu.sinaimg.cn/2014/1015/U9263P1194DT20141015164155.png" /></div>
		    
		    <div class="abs pageSwitch pageLast" onclick="pageSwitch('last')"></div>
		    <div class="abs pageSwitch pageNext" onclick="pageSwitch('next')"></div>
		    <ul class="activityBox clearfix">
		    	<li>请稍后 正在加载...</li>
		    	<!-- 
				<li>
					<div class="txt">绝佳的地理位置造就了江苏</div>
					<div class="abs voteNum" id="1111">1234</div>
					<div class="abs voteButton" onclick="voteTo(1111)"></div>
					<div class="abs floReason">绝佳的地理位置造就了江苏苏苏苏苏苏苏苏苏苏苏苏苏苏苏苏苏苏苏苏苏苏苏苏苏</div>
				</li>
				 -->
		    </ul>
	    </div>
	    <!-- 抽奖弹出层 -->
			<style>
			.popuplayer{ position:fixed; z-index:100; left:0; top:0; width: 100%; height: 100%; background-color: RGBA(0,0,0,0.5); filter:progid:DXImageTransform.Microsoft.Gradient(startColorStr=#80000000,endColorStr=#80000000); }
			.popuplayer .sp{ position:relative; width: 692px; height: 445px; margin: 20px auto;  background-image: url("http://jiangsu.sinaimg.cn/2014/1022/U9263P1194DT20141022100431.png");}
			.popuplayer #sp2{ background-image: url("http://jiangsu.sinaimg.cn/2014/1022/U9263P1194DT20141022100433.png"); }
			.popuplayer #sp3{ background-image: url("http://jiangsu.sinaimg.cn/2014/1022/U9263P1194DT20141022100436.png"); }
			.popuplayer,#sp1,#sp2,#sp3{ display: none;}
			.popuplayer .closeBtn{ position: absolute; top: 10px; left: 620px; width: 60px; height: 60px; cursor: pointer;   background-image: url("http://jiangsu.sinaimg.cn/zt/s/blank.gif"); }
			.popuplayer #sp1 .choujiang{ position: absolute;top: 131px;left: 225px;width: 248px;height: 119px; cursor: pointer;   background-image: url("http://jiangsu.sinaimg.cn/zt/s/blank.gif"); }
			.popuplayer #sp2 .sp2CloseBtn{ position: absolute;top: 131px;left: 225px;width: 248px;height: 119px; cursor: pointer;   background-image: url("http://jiangsu.sinaimg.cn/zt/s/blank.gif"); }
			
			.popuplayer #sp3 .awardInfo{  font-size: 24px; color: #FFF; text-align: center;padding-top: 270px;  }
			.popuplayer #sp3 .uinfo{ position: absolute;top: 354px;left: 114px;width: 159px;height: 30px; font-size: 20px;}
			.popuplayer #sp3 .uinfo#uphone{ left: 368px; }
			.popuplayer #sp3 .submitBtn{ position: absolute;top: 354px;left: 545px;width: 94px;height: 43px; cursor: pointer;   background-image: url("http://jiangsu.sinaimg.cn/zt/s/blank.gif"); }
			</style>
			<div class="popuplayer">
				<div id="sp1" class="sp">
					<div class="closeBtn" onclick="$('.popuplayer').fadeOut()"></div>
					<div class="choujiang" onclick="choujiangFun()"></div>
				</div>
				<div id="sp2" class="sp">
					<div class="closeBtn" onclick="$('.popuplayer').fadeOut()"></div>
					<div class="sp2CloseBtn" onclick="$('.popuplayer').fadeOut()"></div>
				</div>
				<div id="sp3" class="sp">
					<div class="closeBtn" onclick="$('.popuplayer').fadeOut()"></div>
					<input class="uinfo" id="uname" type="text">
					<input class="uinfo" id="uphone" type="tel">
					<div class="submitBtn" onclick="submitZhongjiangInfo()"></div>
				</div>
			</div>
	</div>

</body>
<script type="text/javascript">
var currentPage = 1;
var data;


$(function() {
	getData(currentPage);
});

function getData(p){
	if (data == '' | data == undefined | data == null) {
		 $.JSONP('http://act.city.sina.com.cn/interface/activity/json_get_user_works.php',{act_id:7994,p:1,pcount:30,order:'time'},function(json){
			 data = json.data.sort( function(){ return 0.5 - Math.random()} );
			 var html="";
				
				for(var i=(p-1)*10; i<p*10; i++){
			        html+='<li>';
			    	html+='<div class="txt">'+data[i].form_data.custom_1.value+'</div>';
					html+='<div class="abs voteNum" id="'+data[i].id+'">'+data[i].vote_count+'</div>';
					html+='<div class="abs voteButton" onclick="voteTo('+data[i].id+')">&nbsp;</div>';
					html+='<div class="abs floReason">'+data[i].form_data.custom_2.value+'</div>';
			    	html+='</li>';
				}
				$(".activityBox").html(html);
		});
		
	}else{
		var html="";
		
		for(var i=(p-1)*10; i<p*10; i++){
	        html+='<li>';
	    	html+='<div class="txt">'+data[i].form_data.custom_1.value+'</div>';
			html+='<div class="abs voteNum" id="'+data[i].id+'">'+data[i].vote_count+'</div>';
			html+='<div class="abs voteButton" onclick="voteTo('+data[i].id+')">&nbsp;</div>';
			html+='<div class="abs floReason">'+data[i].form_data.custom_2.value+'</div>';
	    	html+='</li>';
		}
		$(".activityBox").html(html);
	}
}



function pageSwitch( direction ){
	switch (direction) {
	case 'last':
		currentPage--;
		currentPage = currentPage < 1 ? 3 : currentPage;
		break;
	case 'next':
		currentPage++;
		currentPage = currentPage > 3 ? 1 : currentPage;
		break;
	default:
		break;
	}
	
	getData(currentPage);
}

function voteTo(uid){
	////////////////////////////////
	////////////////////////////////
	////////////////////////////////
	////////////////////////////////
		
	//抽奖
	alert('这是一个测试页面，总是未中奖');
	$(".popuplayer").show();
	$(".popuplayer .sp").hide();
	// 没中奖
	$(".popuplayer .sp").hide();
	$("#sp2").show();
	
	var dom = document.getElementById(uid);
	var num = parseInt(dom.innerHTML);
	dom.innerHTML = ++num ;
	
	// TODO 对data修改 +1
	for (var i = 0; i < data.length; i++) {
		if( data[i].id == uid){
			data[i].vote_count = parseInt(data[i].vote_count) + 1;
		}
	}
	return;
	////////////////////////////////
	////////////////////////////////
	////////////////////////////////
	////////////////////////////////
	////////////////////////////////
	
	$.JSONP('http://act.city.sina.com.cn/interface/activity/json_add_vote.php',{
		id : uid
	}, function(bm) { //返回结果
		if (bm.error == 0) {

			//抽奖
			$(".popuplayer").show();
			$(".popuplayer .sp").hide();
			
			//判断是否中奖
			if (bm.draw.is_win == 1) {
				
				//中奖
				$(".popuplayer .sp").hide();
				$("#sp3").show();
				document.getElementById("uname").focus();
				
			} else {
				// 没中奖
				$(".popuplayer .sp").hide();
				$("#sp2").show();
			}
			
			var dom = document.getElementById(uid);
			var num = parseInt(dom.innerHTML);
			dom.innerHTML = ++num ;
			
			// TODO 对data修改 +1
			for (var i = 0; i < data.length; i++) {
				if( data[i].id == uid){
					data[i].vote_count = parseInt(data[i].vote_count) + 1;
				}
			}
		} else {
			alert(bm.errmsg);
		}
	});
}

function choujiangFun() {
	//抽奖按钮废弃
}
	
function submitZhongjiangInfo() {
	var name = $("#uname").val();
    var custom_0 = $("#uphone").val();
    var partten = /^1[3,5,8]\d{9}$/;
    if((name=="") || (name=="请输入姓名")){alert("请输入姓名！");document.getElementById("uname").focus(); return false;}
    if(!partten.test(custom_0)){alert("请填写正确的手机号！");document.getElementById("uphone").focus(); return false;}
    
    $.JSONP('http://act.city.sina.com.cn/interface/activity/json_add_signup.php',{
	    act_id:7995,
	    custom_1:name,
	    custom_2:custom_0
	},function(bm){
        if(bm.error==0){
            	alert("提交成功");
            	$('.popuplayer').fadeOut();
            }else{
            alert(bm.errmsg);
        }
    }); 
}

</script>

</html>