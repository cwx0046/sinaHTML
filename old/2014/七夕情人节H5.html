<!DOCTYPE HTML>
<html>
<head>
<meta charset="gb2312"/>
<meta http-equiv="Cache-Control" content="no-cache"/>
<meta content="telephone=no" name="format-detection" />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=3.0"/>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="format-detection" content="telephone=no"/>
<title>全城热恋 和心爱的TA激情一夜</title>
<meta name="Keywords" content="最快拼图达人将有机会赢取五星级酒店房券，与TA共度浪漫之夜。" />
<meta name="Description" content="最快拼图达人将有机会赢取五星级酒店房券，与TA共度浪漫之夜。" />
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<style>
body, ul, ol, li, p, h1, h2, h3, h4, h5, h6, table, td, th, form, fieldset, img, dl, dt, dd { margin: 0; padding: 0; }
textarea, input, select, body { font-size: 12px; }
select, input { vertical-align: middle; }
fieldset, img { border: 0; }
ul, ol { list-style: none; }
img { border: 0; }
a { text-decoration: none; color: #000; }
a:hover { color: #ffa10d; }
.fl { float: left; display: inline; }
.fr { float: right; display: inline; }
.red { color: #a40000; }
.cb { clear: both; display: block; height: 0px; overflow: hidden; width: 100%; }
.clearfix:after { clear: both; content: " "; display: block; height: 0; }
body { background-color: #feebda; }
.main { background: url("http://jiangsu.sinaimg.cn/zt/s/2014qixi/qixi/2.jpg") repeat-x 0 0; width: 100%; padding-top: 20px; padding-bottom:20px;}
.wrap { width: 300px; margin: 0 auto; }
.rules { background: url("http://jiangsu.sinaimg.cn/zt/s/2014qixi/qixi/3.gif") no-repeat 0 0; background-size: 63px auto; padding-left: 70px; }
.rules h2 { font-size: 14px; color: #ff214b; }
.rules p { font-size: 10px; margin-top: 5px; }
.time p { font-size: 10px; text-align: center; color: #ff214b; margin-top: 5px; }
/*game*/
.gameBox { width: 300px; height: 300px; margin: 0 auto; background-color: #FFF; margin-top: 20px; z-index: 2; position: relative; }
.starGame { width: 300px; margin: 20px auto 0; }
.starGame a { border: 2px solid rgba(0,0,0,0.3); padding: 5px; border-radius: 6px; color: #fff; background-color: #f2395b; font-size: 22px; line-height: 40px; text-align: center; height: 40px; display: inline-block; font-weight: bold; width: 160px; }
ul.yy_yh { width: 170px; line-height:16px; float:left; height: 158px; font-size:10px;background: url("http://jiangsu.sinaimg.cn/zt/s/2014qixi/qixi/4.gif") no-repeat 0 0; background-size: 87px auto; padding-top: 38px; margin-top: 10px; }
ul.yy_yh li { height: 15px; padding-left: 18px; }
.recomm, .address { width: 320px; margin: 20px auto 0; }
.sales, .focus { width: 282px; margin: 20px auto 0; }
.address { margin-bottom: 20px; }
#imgArea { width: 300px; height: 300px; position: relative; }
#imgArea div.imgCell { float: left; width: 73px; height: 73px; border: 1px solid #fff; border-radius: 4px; position: absolute; z-index: 10; box-shadow: 0px 0px 8px #fff; transition-property: background-position; transition-duration: 300ms; transition-timing-function: ease-in-out; }
#imgArea div.hover { filter: alpha(opacity=80); opacity: .8; box-shadow: 0px 0px 8px #000; z-index: 20; *border:1px solid #09F;
}
#time { height: 25px; margin-left: 5px; line-height: 25px; width: 225px; color: #000; font-family: '微软雅黑'; font-size: 20px; }
#time span { color: #000; }

.about{ text-align:center;color:#ce3546; line-height:14px; float:left; width:125px; font-size:8px;}
.about .p4{}
.about .p5{ text-align:left;}

.aboutTxt{ font-size:20px; margin-top:10px;}
.aboutTxt a{ color:#ce3546;}

</style>
<script src="http://i2.sinaimg.cn/cj/dfz/js/base.js" type="text/javascript"></script>
<script>
if(navigator.platform.indexOf('Win32')!=-1){
        //go to pc
//window.location= 'http://jiangsu.sina.com.cn/zt/s/2014qxj.html'; 
     }
</script>
<script>
<!--
var dataForWeixin = {
		  appId: "",
		  TLImg: "http://jiangsu.sinaimg.cn/2014/0801/U7404P1194DT20140801195510.jpg",
		  url: "http://jiangsu.sina.com.cn/zt/s/2014qxj.html",
		  title: "全城热恋 和心爱的TA激情一夜",
		  desc: "把战绩截图发送给新浪江苏微信，也有机会赢取五星级酒店房券喔"
	};

	var onBridgeReady = function(){
		WeixinJSBridge.on('menu:share:appmessage', function(argv){
			WeixinJSBridge.invoke('sendAppMessage', {
				"appid": dataForWeixin.appId,
				"img_url": dataForWeixin.TLImg,
				"img_width": "120",
				"img_height": "120",
				"link": dataForWeixin.url,
				"title": dataForWeixin.title,
				"desc": dataForWeixin.desc 
			});
	 //setTimeout(function () {location.href = "http://jiangsu.sina.com.cn/zt/s/2014qxj.html";}, 1500); 
		});
	};
	if(document.addEventListener){
		document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
	}else if(document.attachEvent){
		document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
		document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
	} 
-->
</script>
<script>
var t;
var s=ms=ten=lock=0;
function startTime() 
{ 
	ms++;
	if (ms>=10){s++;ms=0;}
	$('#time span').html(s+"."+ms); 
	t=setTimeout('startTime()',100);
} 
function resetTime()
{
	clearTimeout(t);
	$('#time span').html(0+"."+0);	
}

function topTen()
{
	$(".yy_yh").html("");
	$.JSONP('http://act.city.sina.com.cn/interface/activity/json_get_user_works.php',{act_id:6442,p:1,pcount:999999,order:'vote'},function(json){
		var jDate = json.data;	
		for (var i = 0; i < jDate.length; i++)
        {
            for (var j = i; j < jDate.length; j++)
             {
               if (parseFloat(jDate[i]["form_data"]["custom_2"]["value"]) > parseFloat(jDate[j]["form_data"]["custom_2"]["value"]))
                {
                    var temp = jDate[i];
                    jDate[i] = jDate[j];
                    jDate[j] = temp;
                }
            }
		}
		$.each(jDate, function (index, value) 
		{	
			//console.log(jDate);
			
			var custom_1 = 	value.form_data.custom_1.value;
			var html = '<li>用户'+custom_1.substring(0,3)+'**'+custom_1.substring(5)+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;用时'+value.form_data.custom_2.value+'秒</li>'
			$(".yy_yh").append(html);
			if(index==9){ ten=value.form_data.custom_2.value;return false;}
		});
	});
}

topTen();

function subData(a,b)
{
	var t_phone = a;
	var t_time = b;
	$.JSONP('http://act.city.sina.com.cn/interface/activity/json_add_signup.php',{act_id:6442,custom_1:t_phone,custom_2:t_time,custom_3:"H5端"},function(bm){
		lock=0;
		if(bm.error==0){
			alert("关注我们");
			window.location="http://mp.weixin.qq.com/s?__biz=MjM5MDI4MTUwMA==&mid=200851464&idx=1&sn=a2259cf7ecb9cf7659ce0ea1dc5a18c5#rd";
			topTen();
			$("#myBg").hide();
			$(".myCon").hide();
			
		}else{
			alert(bm.errmsg)
		}
	});
}

function subPV()
{
	$.JSONP('http://act.city.sina.com.cn/interface/activity/json_add_signup.php',{act_id:6464,custom_1:"pv"},function(bm){
		if(bm.error==0){

		}else{
			alert(bm.errmsg)
		}
	});
}

$(".reset").live("click",function()
{
	s=ms=0;
	$("#myBg").hide();
	$(".myCon").hide();
})

$(".sub").live("click",function()
{
	if(lock==0){
		lock=1;
		var cellphone = $("#t_phone").val();	
		var partten = /^[1-9][0-9]{4,13}$/;	
		if(!partten.test(cellphone)){alert("请填写正确的QQ号！"); return false;}	
		subData(cellphone,s+(ms*0.1));
		s=ms=0;
	}
	
})

var puzzleGame = function (param) 
{
    this.img = param.img || '';
    this.btnStart = $('#start');
	this.myPhone = $('#phone');
    this.imgArea = $('#imgArea');
    this.imgCells = '';
    this.imgOrigArr = [];
    this.imgRandArr = [];
    this.levelArr = [[3, 3]];
    this.levelNow = 0;
    this.imgWidth = parseInt(this.imgArea.css('width'));
    this.imgHeight = parseInt(this.imgArea.css('height'));
    this.cellWidth = this.imgWidth  / this.levelArr[this.levelNow][1];
    this.cellHeight = this.imgHeight  / this.levelArr[this.levelNow][0];
    this.hasStart = 0;
    this.moveTime = 200;
	this.myTime;
	this.seconds=this.ms=0;
    this.init();
}
puzzleGame.prototype = 
{
    init : function () 
    {
        this.imgSplit();
        this.gameState();
    },
    imgSplit : function () 
    {
        this.imgOrigArr = [];
        this.imgArea.html("");
        var cell = '';
        for (var i = 0; i < this.levelArr[this.levelNow][0]; i++) 
        {
            for (var j = 0; j < this.levelArr[this.levelNow][1]; j++) 
            {
                this.imgOrigArr.push(i * this.levelArr[this.levelNow][1] + j);
                cell = document.createElement("div");
                cell.className = "imgCell";
                $(cell).css(
                {
                    'width' : (this.cellWidth - 2) + 'px', 'height' : (this.cellHeight - 2) + 'px', 'left' : j * this.cellWidth + 'px',
                    'top' : i * this.cellHeight + 'px', "background" : "url('" + this.img + "')", 'backgroundPosition' : ( - j) * this.cellWidth + 'px ' + ( - i) * this.cellHeight + 'px' 
                });
                this.imgArea.append(cell);
            }
        }
        this.imgCells = $('#imgArea div.imgCell');
    },
    gameState : function () 
    {
        var self = this;
        this.btnStart.bind('touchstart', function () 
        {
            $(this).addClass('mouseOn');
        }).bind('click', function () 
        {
			$(this).removeClass('mouseOn');
			if (self.hasStart == 0) 
					{
			
						$(this).text('重新开始');
						startTime();
						self.hasStart = 1;
						self.randomArr();
						self.cellOrder(self.imgRandArr);
						self.imgCells.css({
							'cursor' : 'pointer' 
						}).bind('touchstart', function (e) 
						{
					e.preventDefault();
					var touch = event.targetTouches[0];
					$(this).addClass('hover');
                    /*此处是图片移动*/
                    $(this).css('cursor', 'move');
                    //所选图片碎片的下标以及鼠标相对该碎片的位置
                    var cellIndex_1 = $(this).index();
                    var cell_mouse_x = touch.pageX - self.imgCells.eq(cellIndex_1).offset().left;
                    var cell_mouse_y = touch.pageY - self.imgCells.eq(cellIndex_1).offset().top;
					
                    $(document).bind('touchmove', function (e2) 
                    {
						e2.preventDefault();
						var touch2 = event.targetTouches[0];
						//alert(touch2.pageX - cell_mouse_x - self.imgArea.offset().left)
                        self.imgCells.eq(cellIndex_1).css(
                        {
                            'z-index' : '40', 'left' : (touch2.pageX - cell_mouse_x - self.imgArea.offset().left) + 'px', 
                            'top' : (touch2.pageY - cell_mouse_y - self.imgArea.offset().top) + 'px' 
                        });
                    }).bind('touchend', function (e3) 
                    {
                        //被交换的碎片下标
						e3.preventDefault();
						var touch3 = event.changedTouches[0];
						console.log(touch3); 
                        var cellIndex_2 = self.cellChangeIndex((touch3.pageX - self.imgArea.offset().left), 
                        (touch3.pageY - self.imgArea.offset().top), cellIndex_1);
						//console.log(cellIndex_2); 
                        //碎片交换
                        if (cellIndex_1 == cellIndex_2) {
                            self.cellReturn(cellIndex_1);
                        }
                        else {
                            self.cellExchange(cellIndex_1, cellIndex_2);
                        }
                        //移除绑定
                        $(document).unbind('touchmove').unbind('touchend');
                    });
                }).bind('touchend', function () 
						{
							$(this).removeClass('hover');
							$(this).css('cursor', 'pointer');
						});
					}
					else if (self.hasStart == 1) 
					{
						
						if (!confirm('确定要重新开始？')) {
							return false;
						}
						resetTime();
						s=ms=0;
						$(this).text('开始拼图');
						self.hasStart = 0;
						self.cellOrder(self.imgOrigArr);
						self.imgCells.css('cursor', 'default').unbind('touchstart').unbind('touchend').unbind('touchstart');
					}
					
					
			
			
        });
    },
    randomArr : function () 
    {
        this.imgRandArr = [];
        var order;
        for (var i = 0, len = this.imgOrigArr.length; i < len; i++)  
        {
            order = Math.floor(Math.random() * len);  //产生随机数
            if (this.imgRandArr.length > 0)  
            {
                while (jQuery.inArray(order, this.imgRandArr) > - 1) { //如果当前产生的随机数已经存在于数组中，则重新获取随机数
                    order = Math.floor(Math.random() * len);
                }
            }
            this.imgRandArr.push(order);
        }
        return;
    },
    cellOrder : function (arr) 
    {
        for (var i = 0, len = arr.length; i < len; i++) 
        {
            this.imgCells.eq(i).animate(
            {
                'left' : arr[i] % this.levelArr[this.levelNow][1] * this.cellWidth + 'px', 'top' : Math.floor(arr[i]  / this.levelArr[this.levelNow][0]) * this.cellHeight + 'px' 
            },
            this.moveTime);
        }
    },
    cellChangeIndex : function (x, y, orig) 
    {
        if (x < 0 || x > this.imgWidth || y < 0 || y > this.imgHeight) {
            return orig;
        }
        var row = Math.floor(y  / this.cellHeight), col = Math.floor(x  / this.cellWidth), location = row * this.levelArr[this.levelNow][1] + col;
        var i = 0, len = this.imgRandArr.length;
        while ((i < len) && (this.imgRandArr[i] != location)) {
            i++;
        }
        return i;
    },
    cellExchange : function (from, to) 
    {
        var self = this;
        var rowFrom = Math.floor(this.imgRandArr[from]  / this.levelArr[this.levelNow][1]);
        var colFrom = this.imgRandArr[from] % this.levelArr[this.levelNow][1];
        var rowTo = Math.floor(this.imgRandArr[to]  / this.levelArr[this.levelNow][1]);
        var colTo = this.imgRandArr[to] % this.levelArr[this.levelNow][1];
        var temp = this.imgRandArr[from];
        this.imgCells.eq(from).animate({
            'top' : rowTo * this.cellHeight + 'px', 'left' : colTo * this.cellWidth + 'px' 
        },
        this.moveTime, function () 
        {
            $(this).css('z-index', '10');
        });
        this.imgCells.eq(to).css('z-index', '30').animate({
            'top' : rowFrom * this.cellHeight + 'px', 'left' : colFrom * this.cellWidth + 'px' 
        },
        this.moveTime, function () 
        {
            $(this).css('z-index', '10');
            self.imgRandArr[from] = self.imgRandArr[to];
            self.imgRandArr[to] = temp;
            if (self.checkPass(self.imgOrigArr, self.imgRandArr)) {
                self.success();
            }
        });
    },
    cellReturn : function (index) 
    {
        var row = Math.floor(this.imgRandArr[index]  / this.levelArr[this.levelNow][1]);
        var col = this.imgRandArr[index] % this.levelArr[this.levelNow][1];
        this.imgCells.eq(index).animate({
            'top' : row * this.cellHeight + 'px', 'left' : col * this.cellWidth + 'px' 
        },
        this.moveTime, function () 
        {
            $(this).css('z-index', '10');
        });
    },
    checkPass : function (rightArr, puzzleArr) 
    {
        if (rightArr.toString() == puzzleArr.toString()) {
            return true;
        }
        return false;
    },
    success : function () 
    {
        for (var i = 0, len = this.imgOrigArr.length; i < len; i++) 
        {
            if (this.imgCells.eq(i).has('mouseOn')) {
                this.imgCells.eq(i).removeClass('mouseOn');
            }
        }
        this.imgCells.unbind('touchstart').unbind('touchend').unbind('touchend');
        this.btnStart.text('开始拼图');
        this.hasStart = 0;
		
		$(".showtime").html(s+ms*0.1);
		document.title = "我用了"+(s+ms*0.1)+"秒完成拼图，太棒了，可以免费去开房了！";
		if(parseFloat(s+ms*0.1)<=parseFloat(ten))
		{
			$("#myBg").show();
			$("#myConV").show();
		}else
		{
			$("#myBg").show();
			$("#myConF").show();
		}
		this.imgCells.unbind('touchstart').unbind('touchend').unbind('touchend');
		this.btnStart.text('开始拼图');
		this.hasStart = 0;
		resetTime();
		subPV();
    }
}
$(function () 
{
    var pg = new puzzleGame({
        'img' : 'http://jiangsu.sinaimg.cn/zt/s/2014qixi/qixi/6.jpg' 
    })
});
</script>
</head>
<body>
<header><img src="http://jiangsu.sinaimg.cn/2014/0804/U11392P1194DT20140804175907.jpg" width="100%"/></header>
<div class="main">
  <div class="wrap">
    <section class="rules">
      <h2>喜欢就是放肆,做爱做的事,无需克制</h2>
      <p class="p1">排名前三的最快拼图达人即可赢取五星级酒店免费房券，
        让你和TA共度浪漫夏夜。</p>
      <p class="p2">1、点击"开始拼图"按钮，立即加入拼图大战；<br>
        2、完成拼图，输入QQ号即可看到自己的排名；<br>
        3、关注"新浪江苏"微信，第一时间获取领奖方式；<br>
        4、把你的战绩截图发给新浪江苏，也有机会获得五星级房券！</p>
    </section>
    <section class="time">
      <p class="p3">游戏时间：2014年8月1日18：00 - 2014年8月15日 24：00</p>
    </section>
    <div class="gameBox">
      <div id="imgArea"></div>
    </div>
    <div class="starGame"><a id="start" href="javascript:void(0);">开始拼图</a><span id="time">时间：<span>0.0</span></span></div>
    <div class="foot clearfix" style="margin-top:20px;">
    <ul class="yy_yh"></ul>
    <div class="about">
    <img src="http://jiangsu.sinaimg.cn/zt/s/2014qixi/qixi/5.jpg" width="75" />
    <p class="p4">扫一扫关注"新浪江苏"微信<br>第一时间获取中奖信息</p>
<p class="p5">1、五星级酒店房券范围为香格里拉、洲际、费尔蒙等同级别奢华酒店；<br>
2、为了保证此次活动的公平公正，内部工作人员不可领奖；<br>
3、最终活动解释权归新浪江苏所有。</p>
    </div>
    </div>
    <div class="aboutTxt"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDI4MTUwMA==&mid=200851464&idx=1&sn=a2259cf7ecb9cf7659ce0ea1dc5a18c5#rd" target="_blank">关注我们</a></div>
    
  </div>
</div>

<style>
#myBg{ position:fixed; width:100%; height:100%; top:0; left:0;z-index:998;display:none;}
.myCon{ position:fixed; top:0px;z-index:999; width:100%;}
.fenxiang{ width:90%; float:right; text-align:center; padding-top:25px; background:url("http://jiangsu.sinaimg.cn/zt/s/2014qixi/qixi/7.png") no-repeat right 0; background-size:40px auto; color:#FFF; font-size:20px; height:50px; margin-right:20px;}
.guanzhu{ width:150px; float:left; padding-left:15px; padding-top:10px; margin-top:60px; background:url("http://jiangsu.sinaimg.cn/zt/s/2014qixi/qixi/9.png") no-repeat right 0; background-size:35px auto;  font-size:25px; height:30px; }
.guanzhu a{color:#FFF;}
.red{ color:#ff3057;}
.succ{color:#FFF; font-size:18px; width:300px; margin:20px auto 0; text-align:center;}
.inp{ text-align:center; width:100%; margin-top:20px;}
.inp input{ width:200px; height:22px; border:none; font-size:16px;}
.btn{ width:200px; margin:0 auto; text-align:center;}
.btn a{ background-color:#ff3057;width:90px; height:40px; display:inline-block; line-height:40px; font-size:18px; text-align:center; margin:20px 5px 0; color:#FFF;}
.btn a:hover{}
#myConV{display:none;}
#myConF{display:none;}
#myConF .btn a{ width:120px;}

</style>
<div id="myBg"><img src="http://jiangsu.sinaimg.cn/zt/s/2014qixi/qixi/8.png" width="100%" height="100%" /></div>
<div id="myConV" class="myCon">
	<div class="fenxiang">分享<span class="red">高分</span>到<span class="red">朋友圈</span></div>
<div class="succ">    恭喜您成功入围前十，所用时间<span class="showtime">0.0</span>秒
请输入您的QQ号，记录您的排名!</div>
<div class="inp"><input id="t_phone" name="" type="text"></div>
<div class="btn"><a class="reset" href="javascript:void(0)" target="_blank">重玩</a><a class="sub" href="javascript:void(0)" target="_blank">确定</a></div>
	<div class="guanzhu"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDI4MTUwMA==&mid=200851464&idx=1&sn=a2259cf7ecb9cf7659ce0ea1dc5a18c5#rd" target="_blank"><span class="red">关注</span>我们</a></div>

</div>

<div id="myConF" class="myCon">
	<div class="fenxiang">分享<span class="red">高分</span>到<span class="red">朋友圈</span></div>
<div class="succ">    您所用时间为：<span class="showtime">0.0</span>秒<br>
将你的战绩截图发给我们，也有机会获得五星级房券哦~</div>
<div class="btn"><a class="reset" href="javascript:void(0)" target="_blank">重玩一次</a></div>
<div class="guanzhu"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDI4MTUwMA==&mid=200851464&idx=1&sn=a2259cf7ecb9cf7659ce0ea1dc5a18c5#rd" target="_blank"><span class="red">关注</span>我们</a></div>
</div>

</body>
</html>
