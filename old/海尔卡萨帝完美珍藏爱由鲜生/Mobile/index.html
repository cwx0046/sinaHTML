<!DOCTYPE html>
<html>
<head>
<meta charset="GB18030">
<meta http-equiv="cache-control" content="no-cache"/>
<meta name="format-detection" content="telephone=no"/>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="viewport" content="width=device-width, user-scalable=no">
<title>完美珍藏 爱由鲜生</title>
<meta name="keywords" content="海尔,卡萨帝,冰箱" />
<meta name="description" content="海尔卡萨帝完美珍藏爱由鲜生"/>
<meta name="author" content="NorthWind" />
<link rel="stylesheet" href="http://jiangsu.sinaimg.cn/zt/s/css/reset.css">
<!-- 
<script src="http://jiangsu.sinaimg.cn/js/jquery1.11.1.min.js"></script>
<script src="http://jiangsu.sinaimg.cn/js/jquery.transit.min.js"></script>
 -->
<link rel="stylesheet" href="http://jiangsu.sinaimg.cn/js/swiper.min.css">

<!-- 自适应缩放css -->
<style type="text/css">
body{ overflow-x: hidden; background-color: #000; margin: 0 auto; }
.swiper-container{  width: 320px; height: 540px;  -webkit-transform-origin: top left; -ms-transform-origin: top left; transform-origin: top left; margin: 0;   }
.swiper-slide{  position: relative; overflow: hidden;  }
.slide-top{ position: absolute; top: 0; width: inherit; /* background-color: RGBA(255,100,100,0.5); */ }
.slide-center{ width: inherit; height: 410px; position: absolute; top: 0; right: 0; bottom: 0; left: 0; margin: auto; /* background-color: RGBA(0,100,255,0.5); */ }
.slide-bottom{ position: absolute; bottom: 0; width: inherit; /* background-color: RGBA(100,255,100,0.5); */ }

/* 插件 */
.layermchild {  background-color: inherit; }
</style>
<style type="text/css">
.swiper-slide{ background-repeat: no-repeat; background-position: center top; background-size: 100%; }
#loadWrap{ position: absolute; top: 0; width: 100%; height: 100%; z-index: 2; background: url("http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/bg.jpg") no-repeat center top; background-size: cover;  }
#loadWrap img{ display: block; margin: 0 auto; }
.cicleWrap{  -webkit-perspective: 200px;   perspective: 200px;}
.cicle{ width: 72px; height: 72px;   margin: -65px auto 0; border: 3px solid #FFF; border-radius: 50%;	-webkit-animation: upyourscache1430043824293 3s infinite linear;animation: upyourscache1430043824293 3s infinite linear; }
@-webkit-keyframes upyourscache1430043824293 {
  0% {   -webkit-transform: rotateY(0) ;}
  40% {  -webkit-transform: rotateY(160deg) ; }
  60% {  -webkit-transform: rotateY(200deg) ; }
  100% {  -webkit-transform: rotateY(360deg) ; }
}
@keyframes upyourscache1430043824293 {
  0% {   transform: rotateY(0) ;}
  40% {  transform: rotateY(160deg) ; }
  60% {  transform: rotateY(200deg) ; }
  100% {  transform: rotateY(360deg) ; }
}

#swiper-container{ background: url("http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/bg.jpg") no-repeat center top; background-size: cover; }
#s11{ background-image: url("http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/p1_1.png"); }
#s12{ background-image: url("http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/p1.png"); }
#s2{ background-image: url("http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/p2.png");  }
#s3{ background-image: url("http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/p3.png");  }

#我要去现场, #玩游戏赢大奖{ display: block; position: absolute; width: 110px; height: 30px; top: 226px; }
#我要去现场{ left: 45px; }
#玩游戏赢大奖{ left: 165px; }
.backBtn{ position: absolute; display: block; top: 12px; width: 47px; right: 16px; z-index: 1; }
#s13 .backBtn{ left: 16px; }
#报名按钮 {  width: 120px;  height: 35px;  position: absolute;  left: 100px;  top: 382px;}

#swiper-container-s1-s3{
  background: url(http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/logo.png) no-repeat center 21px;
  background-size: 126px;
}

#游戏说明, #开始按钮{ display: block; margin: 0 auto; margin-top: 60px; }
#开始按钮{ margin-top: 100px;  }
#游戏结束文字 {  position: absolute;  top: 56px;  left: 83px;  width: 158px;  color: #FFF;}
#g_phone {  position: absolute;  top: 108px;  left: 90px;  background: none;  border: none;  color: #ffd791;  width: 141px;  -webkit-appearance: none;}
#g_submitBtn{position: absolute;  top: 133px;  left: 118px;  width: 90px;  height: 26px;}
</style>
<style type="text/css">
/* 报名弹出层 */
#regLayer {
  width: 300px;
  height: 200px;
  background-image: url("http://jiangsu.sinaimg.cn/zt/s/haierayxs/images/regform.jpg");
  background-size: cover;
  position: relative;
}
.formWrap {
  position: absolute;
  left: 131px;
  top: 16px;
}
.formWrap input {
  display: block;
  -webkit-appearance: none;
  background: none;
  border: none;
  font-size: 14px;
  padding: 2px 0;
  margin: 7px 0 12px;
  width: 108px;
  color: #FFF;
}
 
input#submit {
  height: 33px;
  cursor: pointer;
}



#ui_time:BEFORE{ content: "用时："}
#ui_time:AFTER{ content: "秒"}
#ui_score:BEFORE{ content: "温度："}
#ui_score:AFTER{ content: "℃"}

#ui_time {
  position: absolute;
  left: 10px;
  top: 10px;
  color: #FFF;
}

#ui_score {
  position: absolute;
  top: 10px;
  right: 10px;
  color: #FFF;
}

.rankingWrap{
 box-sizing: border-box;
 width: 220px;
 padding: 16px;
 color: #FFF;
 margin: 0 auto;
 background-color: rgba(0, 0, 0, 0.4);
}
#排行榜列表{
 width: 100%;
 text-align: center;
 height: 144px;
 overflow-y: scroll;
 -webkit-overflow-scrolling: touch;
 margin-bottom: 10px;
}
.c1, .c2, .c3 {  display: inline-block;}
.c1{ width: 16%; }
.c2{ width: 51%; }
.c3{ width: 24%; }

.swiper-container2{ width: 300px; height: 200px; overflow: hidden; }
.swiper-container2 img{ width: 300px; height: 200px;}

/* Bottom Arrow */
.btnBottom{ position:absolute; bottom: 1%; text-align:center; width: 100%;color: #FFF;text-shadow: 0 1px 0px #000;-webkit-animation-name:btnBottom;-webkit-animation-duration:1.8s;-webkit-animation-timing-function:linear;-webkit-animation-delay:0s;-webkit-animation-iteration-count:infinite;-webkit-animation-direction:normal;-webkit-animation-play-state:running;}
.btnBottom img{ background-color: RGBA(0,0,0,0.1); padding: 4px 10px;}

@-webkit-keyframes btnBottom /* Safari and Chrome */
{
0% {-webkit-transform:translateY(0px); opacity: 0;}
90% { opacity: 1;}
100% {-webkit-transform:translateY(-5px); opacity: 0;}
}

</style>
<script type="text/javascript">
var mySwiper;
var mySwiper_s1;
var mySwiper_s1_s3;
</script>
</head>
<body ontouchmove="event.preventDefault()">
	<!-- 
	* 说明：
	* 多页面滑动模板，适用于 类ppt 页面
	* 页面 320*540 按宽度缩放
	* 使用 idangerous.swiper 插件切换页面 ，参数请在下方 【Initialize swiper】中自行更改
	* 页 swiper-slide
	*   页眉 slide-top
	*   正文 slide-center
	*   页脚 slide-bottom
	 -->
	<div class="swiper-container" id="swiper-container">
		<div class="swiper-wrapper">
		    <!--First Slide-->
			<div class="swiper-slide" id="s1">
				<div id="loadWrap" title="加载层"     onclick="$(this).hide()"    >
					<div class="slide-center">
						<img src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/logo.png" width="126" style="margin-top: 81px;">
						<img src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/i1.png"   width="22"  style="margin-top: 46px;">
						<div class=".cicleWrap">
							<div class="cicle"></div>
						</div>
					</div>
				</div>
				
				<div class="swiper-container" id="swiper-container-s1">
					<div class="swiper-wrapper">
						<div class="swiper-slide" id="s11" title="我要去现场">
							<img class="backBtn" title="返回" src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/backBtn.png" onclick="mySwiper_s1.slideTo(1)">
							<a href="#" onclick="showRegForm();return false;" id="报名按钮"></a>	
<!-- <div id="regLayer" style="display: none;">
	<div class="formWrap">
		<input id="name"/>
		<input id="cellphone"/>
		<input id="job"/>
		<input id="text"/>
		<input id="submit" type="button" onclick="submit()"/>
	</div>
</div> -->
						</div>
						<div class="swiper-slide" id="s12">
							<a id="我要去现场" href="javascript:mySwiper_s1.slideTo(0);"></a>
							<a id="玩游戏赢大奖" href="javascript:mySwiper_s1.slideTo(2);"></a>
							<div class="btnBottom"><img src="http://jiangsu.sinaimg.cn/zt/s/jsxwzl/nanjing/images/up.png" width="14"></div>
						</div>
						<div class="swiper-slide" id="s13" title="玩游戏赢大奖">
							<div class="swiper-container" id="swiper-container-s1-s3" title="游戏三页">
								<div class="swiper-wrapper">
									<div class="swiper-slide" id="s31" title="首页">
										<img class="backBtn" title="返回" src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/backBtn.png" onclick="mySwiper_s1.slideTo(1)">
										<div class="slide-center">
											<img id="游戏说明" src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/g1.png" width="320">
											<img id="开始按钮" src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/g2.png" width="144" onclick="gamestart()">
										</div>
									</div>
									<div class="swiper-slide" id="s32" title="游戏过程">
										<div title="游戏画布" class="slide-center" style="height: 380px;">
											<!-- CANVAS -->
											<canvas id="gameZone" width="320" height="380"></canvas>
											<div id="ui_time"></div>
											<div id="ui_score"></div>
											
										</div>
									</div>
									<div class="swiper-slide" id="s33" title="游戏结束">
										<img class="backBtn" title="返回" src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/backBtn.png" onclick="mySwiper_s1.slideTo(1)">
										<div class="wrap" style="position: relative; margin-top: 68px;">
											<img id="游戏结束" src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/g3.png" width="320" >
											<div id="游戏结束文字"><span id="g_seconds">30</span>秒，就让你的啤酒变成冰饮，开启夏季畅饮吧！分享到朋友圈，邀好友来战！</div>
											<input type="tel" id="g_phone" placeholder="输入手机号，仅作中奖通知使用">
											<a id="g_submitBtn" href="javascript:submitGame()"></a>
										</div>
									</div>
									<div class="swiper-slide" id="s34" title="排名">
										<img class="backBtn" title="返回" src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/backBtn.png" onclick="mySwiper_s1.slideTo(1)">
										<div class="slide-center">
											<div class="rankingWrap">
												<img alt="排行榜标题" src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/g4.png" width="126" style="margin: 10px auto; display: block;">
												<div id="排行榜列表" ontouchmove="event.stopPropagation();">
													<!-- <div><span class="c1">01</span><span class="c2">130****1111</span><span class="c3">20秒</span></div> -->
												</div>
												<div>
													活动规则：<br/>
													<br/>
													1、所有参与游戏的网友都可以领取1000元卡萨帝气悬浮无油冰箱现金抵用券一张。<br/>
													2、排名礼品，现金抵用券统一在活动现场签到领取。<br/>
													3、活动截止时间：4月30日12点，中奖网友请在4月30日下午2点至山西路乐购仕生活广场领奖。
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				
			</div>
			
			<!--Second Slide-->
			<div class="swiper-slide" id="s2">
                <div class="swiper-container2" style="position: absolute;  top: 182px;  left: 10px;">
			        <div class="swiper-wrapper">
			            <div class="swiper-slide"><img src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/images/photo/1.jpg"></div>
			            <div class="swiper-slide"><img src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/images/photo/2.jpg"></div>
			            <div class="swiper-slide"><img src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/images/photo/3.jpg"></div>
			            <div class="swiper-slide"><img src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/images/photo/4.jpg"></div>
			            <div class="swiper-slide"><img src="http://jiangsu.sinaimg.cn/zt/s/haierayxs/images/photo/5.jpg"></div>
			        </div>
			        <!-- Add Pagination -->
			        <div class="swiper-pagination"></div>
			    </div>
				<div class="btnBottom"><img src="http://jiangsu.sinaimg.cn/zt/s/jsxwzl/nanjing/images/up.png" width="14"></div>
			</div>
			
			<!--Third Slide-->
			<div class="swiper-slide" id="s3">
				<div class="btnBottom"><img src="http://jiangsu.sinaimg.cn/zt/s/jsxwzl/nanjing/images/up.png" width="14"></div>
			</div>
			
		</div>
	</div>
</body>

<script type="text/javascript" src="http://jiangsu.sinaimg.cn/js/jquery_1.11.2.min_jsonp.js"></script>
<script src="http://jiangsu.sinaimg.cn/js/swiper.jquery.min.3.0.6.js"></script>
<script src="http://jiangsu.sinaimg.cn/js/layer.mobile-v1.5/layer.m/layer.m.js"></script>
<!-- 预加载页 js -->
<script type="text/javascript">
document.onreadystatechange = function (){
	if(document.readyState == "complete"){ 
		setTimeout(function(){
			//alert("加载完毕！");
			$("#loadWrap").animate({top: -window.innerHeight}, "slow");
        },300);
	}
}
</script>

<!-- 初始化swiper -->
<script type="text/javascript">
var r;
/* zoom swiper-container */
fixPageHeight();
window.onresize = fixPageHeight;
function fixPageHeight() {
	r = document.body.offsetWidth / 320;
	$("#swiper-container").css({"-webkit-transform":"scale(" + r + ")", "-ms-transform":"scale(" + r + ")","transform":"scale(" + r + ")" });
	$("body, .swiper-container").height( window.innerHeight / r );	
	
	/* if (window.innerHeight <= 480) {
		$("#s31 .slide-center").attr("class","slide-bottom");
	} */
	return "page has been scaled!";
}
window.onload = function() {
	
	/* Initialize swiper */
	mySwiper = new Swiper('#swiper-container',{
		// options
		direction: 'vertical', //vertical //horizontal
		mousewheelControl: true, //鼠标滚轮控制
		keyboardControl: true,   // 键盘控制
		noSwiping: true,
		onSlideChangeEnd: function(p) {
			var act = p.activeIndex; //slideEndIndex
		}
	});  
	/* Initialize swiper */
	mySwiper_s1 = new Swiper('#swiper-container-s1',{
		initialSlide: 1,
		direction: 'horizontal', //vertical //horizontal
		speed: 500,
		keyboardControl: true,   // 键盘控制
		allowSwipeToPrev : false,
		allowSwipeToNext : false,
		effect: "coverflow",
		onSlideChangeStart: function(p) {
			var act = p.activeIndex; //slideEndIndex
			if (act == 1) {
				mySwiper.unlockSwipes()
			}else if (act == 2) {
				mySwiper_s1_s3.slideTo(0);
				mySwiper.lockSwipes()
			}else{
				mySwiper.lockSwipes()
			}
		}
	});  
	/* Initialize swiper */
	mySwiper_s1_s3 = new Swiper('#swiper-container-s1-s3',{
		direction: 'horizontal', //vertical //horizontal
		speed: 300,
		keyboardControl: true,   // 键盘控制
		simulateTouch : false,
		swipeHandler : "#ui_time",
		allowSwipeToPrev : false,
		allowSwipeToNext : false,
		effect: "fade",
		fade: {
			  crossFade: true,
			}
	});  
	
	/* 图片轮播 */
    swiper2 = new Swiper('.swiper-container2', {
        pagination: '.swiper-pagination',
        direction: 'horizontal',
        autoplay: 2000,
        paginationClickable: true
    });
	
	
}
</script>
<script type="text/javascript">
var fromPopup;
function showRegForm(){
	fromPopup = layer.open({
	    type: 1,
	    content: '<div id="regLayer" >	<div class="formWrap">		<input id="name"/>		<input id="cellphone" type="tel"/>		<input id="job"/>		<input id="text"/>	<input id="submit" type="button" onclick="submit()"/>	</div></div>',
	});
}

function submit(){
	var data = {};
	data.act_id = 11082;
	data.name = $("#name").val();
	data.cellphone = $("#cellphone").val();
	data.custom_1 = $("#job").val();
	data.custom_2 = $("#text").val();
	
	if (data.name == "") {
		$("#name").focus();
		layer.open({
		    content: '请填写姓名',
		    style: 'background-color:RGBA(0,0,0,0.8); color:#fff; border:none; text-align: center;',
		    time: 1
		});
		return false;
	}
	
	var id_partten = /^1[3,4,5,7,8]\d{9}$/;
    if (!id_partten.test(data.cellphone)){
    	$("#cellphone").focus();
		layer.open({
		    content: '请填正确的手机号',
		    style: 'background-color:RGBA(0,0,0,0.8); color:#fff; border:none; text-align: center;',
		    time: 1
		});
    	return false;
    }

	
    var submitAni = layer.open({
        type: 2,
        content: '正在提交',
       	shadeClose: false,
    });
	
	$.JSONP('http://act.city.sina.com.cn/interface/activity/json_add_signup.php',data,function(bm){
		if(bm.error==0){
			layer.open({
			    content: '提交成功！',
			    style: 'background-color:RGBA(0,0,0,0.8); color:#fff; border:none; text-align: center;',
			    time: 2
			});
			layer.close(fromPopup);
		}else{
			layer.open({
			    content: bm.errmsg,
			    style: 'background-color:RGBA(0,0,0,0.8); color:#fff; border:none; text-align: center;',
			    time: 2
			});
		}
		layer.close(submitAni);
	});
	
}

</script>

<script type="text/javascript">
function gamestart() {
	mySwiper_s1_s3.slideTo(1);
	gameStart(18);
}
</script>

<!-- game -->
<script type="text/javascript">
	
	var gameZone = document.getElementById("gameZone");
	var canvas=gameZone.getContext("2d");
	var continerDom = $("#page2");
	var diskDom = $("#ui_disk");
	var scoreDom = $("#ui_score");
	var finalScoreDom = $("#ui_finalScore");
	var timeDom = $("#ui_time");
	var GAMEWIDTH = 320;
	var GAMEHEIGHT = 380;
	var FPS = 60;
	var fruitCount = 10000; //元素id
	var frame = 0;
	var score = 26;
	var time = 0;
	var pause = false;
	var fruits = [];
	var scores = [];
	var iFrame; //帧循环器
	var iTime;  //游戏时间计时器
	var rate = 20;   //水果产生率
	
	var img_p = new Image(); img_p.src = "http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/cup.png";
	var img_3 = new Image(); img_3.src = "http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/sun.png";
	var img_1 = new Image(); img_1.src = "http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/sun.png";
	var img_m1 = new Image(); img_m1.src = "http://jiangsu.sinaimg.cn/zt/s/haierayxs/mobile/images/i1.png";
	
	
	var disk = {
			x: 30,
			y: 330,
			width: 50,
			height: 15,
			update: function (x){
						this.x = x;
					},
			draw : function(){
				canvas.drawImage(img_p, this.x -10 , this.y-20 , img_p.width/1.6, img_p.height/1.6);
			}
	};
	
	var t_f = [
			   {score : 1, className: "f_1"},
			   {score : -2,className: "f_-2"}]; 
	
	/* 游戏入口 */
	function gameStart(rate){
		this.rate = rate;
		gameReset();
		timer();//计时器
		/* 帧播放 */
		iFrame = setInterval(function() {
			frame++;
			update();
		}, 1000/FPS);
	}
	
	var ui_gc_pause = document.getElementById("gc_pause");
	function gamePause(){
		pause = !pause;
		pause ? ui_gc_pause.innerHTML="继续" : ui_gc_pause.innerHTML="暂停";
	}
	
	/* 游戏重置 */
	function gameReset(){
		fruitCount = 10000; //元素id
		frame = 0;
		score = 26;
		time = 0;
		pause = false;
		fruits = [];
		
		clearInterval(iFrame); //帧停止
		clearInterval(iTime);  //时间计时停止
		
		scoreDom.text(score);
		
		//移除所有 f_ 开头的类元素
		//$("div:[class^=abs f_]").remove();
	}
	
	/* 帧更新 */
	function update() {
		if(pause){return;}
		canvas.clearRect(0, 0, GAMEWIDTH, GAMEHEIGHT);
		handleFruitsAdd();
		handleFruitsUpdate(); //水果位置更新
		handleFruitsDraw(); //水果位置绘制
		handleDiskDraw();
		handleCollisions(); //碰撞检测
		handleScoreUpdate();
		handleScoreDraw();
		//handleFPS(); // FPS帧率显示
	}
	function handleFPS() {
		var FPS = calculateFps().toFixed(2);
		canvas.font = '30px Consolas';
		canvas.fillStyle = '#FFFF00';
		canvas.fillText( FPS + ' fps', 0, 30);
		canvas.lineWidth = 0.5;
		canvas.strokeStyle = '#000000';
		canvas.strokeText( FPS + ' fps', 0, 30);
	}
	
	var lastTime;
	function calculateFps() {
		var now = (+new Date),
		fps = 1000 / (now - lastTime);
		lastTime = now;
		return fps;
	}
	function handleScoreUpdate() {
		scores.forEach(function(S) {
			S.update();
		});
	}
	function handleScoreDraw() {
		scores.forEach(function(S) {
			S.draw();
		});
	}
	
	function handleFruitsAdd() {
		if(frame % Math.round(rate*Math.random()+rate) == 0){ // 生成
			var r = Math.floor(Math.random()*2)//随机
			var f = t_f[r];
			fruits.push(fruit({
				x: (GAMEWIDTH - 25) * Math.random(),
				score : f.score,
				className: f.className
			}));
			//console.info("Fruit pushed!");
		}
	}
	
	function handleFruitsUpdate() {
		fruits.forEach(function(F) { //水果位置更新
			//F.isInited ? F.update() : F.init();
			F.update();
		});
	}
	function handleFruitsDraw() {
		fruits.forEach(function(F) { //水果位置绘制
			F.draw();
		});
	}
	function handleDiskDraw() {
		disk.draw();
	}
	
	
	function handleCollisions() {
		fruits.forEach(function(F) {
			if (collides(F, disk)) {
				F.catched();
			}
		});
	}
	function collides(a, b) {
		  return a.x < b.x + b.width &&
		         a.x + a.width > b.x &&
		         a.y < b.y + b.height &&
		         a.y + a.height > b.y;
	}
	
	
	/* 时间 */
	function timer() {
		timeDom.text(time);
		iTime = setInterval(function() {
			/* if (pause) {
				return;
			}
			 */
			time += 0.1;
			if( score <= 0){
				gameover();
				pause = true;
				clearInterval(iTime);
				return;
			}
			timeDom.text(time.toFixed(1));
		}, 100);
	}
	function gameover() {
		//设置最终得分
		$("#g_seconds").text(time.toFixed(1));
		//游戏结束跳至第二页
		mySwiper_s1_s3.slideTo(2);
	}
	
	
	
	//水果构造器
	function fruit(F) {
		//F.x = 60;
		F.y = 60;
		F.width = 10;
		F.height = 30;
		//F.score = 3;
		F.v = -3.2;           //初速度
		F.a = 1;            //加速度
		F.frame = 34;       //起始帧
		F.id = "fruit_"+fruitCount;
		fruitCount++;
		//F.className = "f_3"; 
		
		F.update = function() {
			this.frame++;
			var t = this.frame/(1000/FPS);
			F.y += (F.v + F.a*t)*t;
			
			//var obj = $("#"+this.id);
			//obj.css("top",this.y);
			
			if(this.y >= GAMEHEIGHT){
				F.out();
			}
		};
		
		F.draw = function(){
			switch (this.score) {
			case 3:
				canvas.drawImage(img_3,this.x - 15,this.y, img_3.width, img_3.height);
				break;
			case 1:
				canvas.drawImage(img_1,this.x - 15,this.y, img_1.width/1.6, img_1.height/1.6);
				break;
			case -2:
				canvas.drawImage(img_m1,this.x - 15,this.y, img_m1.width/1.6, img_m1.height/1.6);
				break;
			default:
				break;
			}
			
		}
		F.destory = function() {
			fruits.forEach(function(o,i) {
				if(o.id === F.id){
					fruits.splice(i,1);
				}
			});
		}
		F.catched = function() { //被接住
			//console.log("Catched! " +this.score);
			//销毁div
			score += this.score; //分数计算
			scoreDom.text(score);
			
			scoreBubble(this.x,this.y,this.score); // 分数气泡
			 
			this.destory();
		};
		F.out = function() { //跌出屏幕
			//销毁div
			this.destory();
		};
		
		
		return F;
	}
	
	//分数构造器
	function scoreChar(S) {
		//S.score = 1;
		//S.color = "#FF3300";
		
		S.id = "score_" + fruitCount;
		S.opacity = 1;
		S.update = function(){
			this.opacity -= 0.016;
			S.y -= 1;
			if( this.opacity <= 0 ){ this.destory(); return; }
		};
		S.draw = function(){
			canvas.font = "30px 'Comic Sans MS'";
			canvas.fillStyle = S.color;
			canvas.globalAlpha=this.opacity;
			canvas.fillText(S.score, S.x, S.y);
			canvas.globalAlpha=1;
		};
		S.destory = function() {
			scores.forEach(function(o,i) {
				if(o.id === S.id){
					scores.splice(i,1);
				}
			});
		};
		return S;
	}
	/* 分数气泡 */
	function scoreBubble(x,y,score) {
		//var scoreText =  score>0 ? "+"+score : ""+score;
		//canvas绘制分数
		color = (score<0) ? "#05AAFF" : "#FC3C0F";
		score = (score>0) ? ("+"+score) : score;
		
		
		scores.push(scoreChar({
			x: x,
			y: y,
			score : score,
			color: color
		}));
	}
	
	//disk随鼠标移动
	$(function() {
		$(".swiper-container").bind("mousemove touchstart touchmove", function(e) {
			//e.preventDefault();
			if (e.type === "touchmove") {
				e.preventDefault();
			}
			
			
			if( e.type === "mousemove"){
				var x = e.clientX / r;
			}else{
				var touch = event.targetTouches[0];  
				var x = touch.pageX / r;
			}
			diskMove(x);
		});
	});
		
	
	
	function diskMove(x) {
		var x = x - disk.width/2;
		disk.update(x); //更新对象属性
		//diskDom.css("left",x); //dom位置更新 
	}
	
</script>
<script type="text/javascript">
function submitGame() {
	var data = {};
	data.act_id = 11084;
	data.cellphone = $("#g_phone").val();
	data.custom_1 = time.toFixed(1);
	var id_partten = /^1[3,4,5,7,8]\d{9}$/;
	
    if (!id_partten.test(data.cellphone)){
    	$("#g_phone").focus();
		layer.open({
		    content: '请填正确的手机号',
		    style: 'background-color:RGBA(0,0,0,0.8); color:#fff; border:none; text-align: center;',
		    time: 1
		});
    	return false;
    }
    
    var submitAni = layer.open({
        type: 2,
        content: '正在提交',
        shadeClose: false,
    });
	
	$.JSONP('http://act.city.sina.com.cn/interface/activity/json_add_signup.php',data,function(bm){
		if(bm.error==0){
			
			//获得所有成绩、排序、去重、筛选前15、放入页面
			var Top15List = $("#排行榜列表");
			var html = "";
			var data_Top15 = [];
			$.JSONP('http://act.city.sina.com.cn/interface/activity/json_get_user_works.php',{act_id:data.act_id,pcount:9999},function(json){
				for(var i=0; i<json.count; i++){
					var phone = json.data[i].form_data.cellphone.value;
					phone = phone.substr(0,3) + "****" + phone.substr(7,4);
					var score = parseFloat(json.data[i].form_data.custom_1.value);
					data_Top15[i] = [phone, score];
				}
		
			    var len = data_Top15.length; 
			    var tmp = [];
			    for(var i = 0; i<len; i++){
			        for(var j=len-1; j>i; j--){
			            if(data_Top15[j][1] < data_Top15[j-1][1]){
			                tmp = data_Top15[j-1];
			                data_Top15[j-1] = data_Top15[j];
			                data_Top15[j] = tmp;
			            }
			        }
			    }
		
			  //去重
		        var tmp2 = [];
		        for(var i = 0; i < data_Top15.length; i++){
		        	var isExist = false;
					for (var j = 0; j < tmp2.length; j++) {
						if(tmp2[j][0] == data_Top15[i][0] ){
							isExist = true;
						}
					}
					if (isExist) {
					}else{
						tmp2.push(data_Top15[i]);
					}
		        }
		        data_Top15 = tmp2;
		
			    for (var i = 0; i < 15; i++) {
			    	if (data_Top15[i]==null | data_Top15[i] == undefined) {
						continue;
					}
			    	var no = i + 1;
			    	no = (no<=9) ? ("0" + no) : no;
					html += '<div><span class="c1">'+ no +'</span><span class="c2">'+ data_Top15[i][0] +'</span><span class="c3">'+ data_Top15[i][1] +'秒</span></div>';
				}
		
				Top15List.html(html);
				
				layer.open({
				    content: '提交成功！',
				    style: 'background-color:RGBA(0,0,0,0.8); color:#fff; border:none; text-align: center;',
				    time: 2
				});
				layer.close(fromPopup);
				mySwiper_s1_s3.slideTo(3);
			});

			
			
			
			
		}else{
			layer.open({
			    content: bm.errmsg,
			    style: 'background-color:RGBA(0,0,0,0.8); color:#fff; border:none; text-align: center;',
			    time: 2
			});
		}
		layer.close(submitAni);
	});
	
}
</script>
</html>