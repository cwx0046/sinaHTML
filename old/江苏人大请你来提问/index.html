<!DOCTYPE html>
<html>
<head>
<meta charset="GB2312">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>江苏人大请你来提问_新浪江苏</title>
<meta name="keywords" content="人大,讨论,捎句话" />
<meta name="description" content="江苏人大请你来提问_新浪江苏" />
<meta name="author" content="NorthWind" />
<link rel="stylesheet" href="http://jiangsu.sinaimg.cn/zt/s/css/reset.css">
<script type="text/javascript" src="http://jiangsu.sinaimg.cn/js/jquery_1.11.2.min_jsonp.js"></script>

<style type="text/css">
body { max-width: 640px; margin: 0 auto; font-family: "microsoft yahei"; font-size: 13px; line-height: 1.6em; background-image: url("http://s3img.city.sina.com.cn/activity/common/large/29ad1614295a1d5f3ae40309bd9abfde.png"); background-size: 188px auto; }
.headimg{ max-width: 100%; display: block; }
.contentwrap{ padding: 0 5px; }
h2{ text-align: center;  color: #FFF; font-weight: bold; font-size: 20px; padding: 10px 0; background-color: #dd3034; }
.inner_content{ padding: 19px 20px; background-color: #FFF; }
.inner_content p{ text-indent: 2em; }

h2.withborder{   border-image: url("http://s3img.city.sina.com.cn/activity/common/large/3022d1f78dfe726d5ec33d91410b42e9.png") stretch;
 border-image-slice: 23 10 17; border-image-width: 10px 5px 8px; border-image-outset: 0; background-clip: padding-box; padding: 15px 0 14px;}
h3{ font-weight: bold; color: #000; font-size: 17px; margin: 8px 0; }


.must{ display: inline; margin-right: 4px; }
.must:AFTER{ content: "*"; color: #F00; }
label {   display: inline-block; float:left; clear:left;  height: 28px;  line-height: 28px;  font-size: 14px;  text-align: left;  cursor: pointer;  margin-bottom: 3px;  -webkit-tap-highlight-color: transparent;}
label input[type=radio]{ display: none; }
label input[type=radio]+span{ color: #FFF; background-color: #dd3034; display: block; border-radius: 3px; padding: 0 20px; display: inline-block;}
label+a{ float: left;  line-height: 30px;  margin-left: 10px;  color: #DD3034;  font-weight: bold;}
label input[type=radio]+span:HOVER{ background-color: #FFEF00; color: #19192C; }
label input[type=radio]:checked+span{ color: #19192C; background-color: #FFEF00; box-shadow: inset 2px 1px 5px RGBA(0,0,0,0.5); }
.submitBtn{ cursor: pointer; display: inline-block; float: right; 
color: #FFF; background-color: #dd3034; display: block; border-radius: 3px; padding: 0.4em 1.4em;
margin: 0.6em 0;
}
.submitBtn.disabled{ background-color: #DDD; color: #888; cursor: wait; } 


.msgshowbox{ width: 100%; border: 1px solid #b1b1b1;} 
.card{ width: 90%; margin: 0 auto; border-bottom: 1px dotted; padding: 4px 0; }
.name{ color: #dd3034; font-size: 0.88em; } 
.text{ text-indent: 2em; font-size: 0.8em; } 
.time{ color: #888; text-align: right; font-size: 0.8em; }
.loadMore{ cursor: pointer; color: #FFF; background-color: #dd3034; display: inline-block; border-radius: 3px; padding: 0.4em 1.4em; margin: 0.6em 0; width: auto; } 
.loadMore.disabled{ background-color: #DDD; color: #888; cursor: wait; } 
</style>
</head>
<body>
	<div class="wrap">
		<img class="headimg" src="http://s3img.city.sina.com.cn/activity/common/large/4e1b0d2193b9f60a60de63297a457d15.jpg">
	</div>
	<div class="contentwrap">
    <h2>导 语</h2>
		<div class="inner_content">
			<div style="padding: 1em;">
				<p>江苏省十二届人大常委会第十五次会议正在南京召开。本次会议将作出1件决议、审议3件法规1项报告，并批准江苏省2015年地方政府债券收支安排及省级预算调整方案，而这些都将与江苏人民的生活息息相关。</p>
        <p>现江苏省人大办公厅联合新浪江苏，邀请广大网友对正审议的决议、法规及报告等提出自己的问题。</p>
        <p>我们将带着您的问题，在江苏人大常委会新闻发布会上邀请相关方面负责人回应您的关切！</p>
			</div>
		</div>
	</div>
	
	<h2 class="withborder">捎句话</h2>
	<div class="contentwrap">
	   <div class="inner_content clearfix">
			<h3><div class="must"></div>选择分类</h3>
				<div class="clearfix" style="text-align: center;">
					<label onclick="javascript:getRadioValue('全面推进依法治省')"><input name="pid" type="radio" value="全面推进依法治省"   /><span>全面推进依法治省 </span></label>
					  <a href="#" target="_blank">详细&nbsp;&gt;&gt;</a>
					<label onclick="javascript:getRadioValue('江苏省特种设备安全监察条例')"><input name="pid" type="radio" value="江苏省特种设备安全监察条例"   /><span>江苏省特种设备安全监察条例</span></label> 
            <a href="#" target="_blank">详细&nbsp;&gt;&gt;</a>
					<label onclick="javascript:getRadioValue('江苏省绿色建筑发展条例')"><input name="pid" type="radio" value="江苏省绿色建筑发展条例"   /><span>江苏省绿色建筑发展条例</span></label>
					  <a href="#" target="_blank">详细&nbsp;&gt;&gt;</a>
					<label onclick="javascript:getRadioValue('江苏省人民调解条例')"><input name="pid" type="radio" value="江苏省人民调解条例" /><span>江苏省人民调解条例</span></label>
					  <a href="#" target="_blank">详细&nbsp;&gt;&gt;</a>
					<label onclick="javascript:getRadioValue('国有企业改革发展和国有资产监管')"><input name="pid" type="radio" value="国有企业改革发展和国有资产监管"   /><span>国有企业改革发展和国有资产监管</span></label>
					  <a href="#" target="_blank">详细&nbsp;&gt;&gt;</a>
					<label onclick="javascript:getRadioValue('地方政府债券收支及升级预算调整方案')"><input name="pid" type="radio" value="地方政府债券收支及升级预算调整方案"   /><span>地方政府债券收支及升级预算调整方案</span></label>
					  <a href="#" target="_blank">详细&nbsp;&gt;&gt;</a>
				</div>
			<h3><div class="must"></div>建言内容</h3>
					<textarea name="content" id="formContent" style="padding:0.5em; height:7em; font-size: 1em; width: 90%; margin: 0 auto; display: block; resize:vertical; background-color:RGBA(255,255,255,0.6); border: 1px solid #F0660A; border-radius: 2px; -webkit-box-shadow: inset 1px 2px 9px rgba(35,24,21,.3); box-shadow: inset 1px 2px 9px rgba(35,24,21,.3);" placeholder="请在此填写建言内容"></textarea>
			<div class="submitBtn">提交</div>
		</div>
	</div>
		
  <h2 class="withborder">建言选登</h2>
  <div class="contentwrap" style=" margin-bottom: 40px;">
    <div class="inner_content clearfix">
			<div class="wrap msgshowbox">
				<div class="msgListsBox">
					<div class="card">
						<div class="name">加载中...</div>
					</div>
				</div>
			</div>
			<div style="text-align: center;">
				<div class="loadMore">加载更多</div>
			</div>
		</div>
	</div>
	
</body>
<script type="text/javascript" src="http://jiangsu.sinaimg.cn/js/dial_sso_login_mann.js" charset="UTF-8"></script>  <!-- g=dialog_login_v1.1-sp1.js & ssologin.js & sinaSSOManager.js  _修正-->
<script src="http://jiangsu.sinaimg.cn/z/js/weiboApi.js"></script>
<script type="text/javascript">
var data = {};
data.act_id = 10642;
data.custom_1 = "[微博昵称]";
data.custom_2 = "[微博id]";
data.custom_3 = "[标题]";
data.custom_4 = "[类型]";
data.custom_5 = "[内容]";


function getRadioValue(pid) {
	data.custom_4 = pid;
}

var canclick = true;
var lmcanclick = false; // load more can lick
var listNum = 0;
var currentPage = 1;
$(".submitBtn").unbind().bind("click",function(){
	submitBtn(false);
	if(!canclick){
		return;
	}
	canclick = false;
	
	if (checkForm() === false) {
		canclick = true;
		submitBtn(true);
		return;
	}
	
	//记录微博信息
	var uinfo = sinaSSOManager.getSinaCookie();
	if (!uinfo) { //判断登陆
		data.custom_1 = "[用户未登录]";
		data.custom_2 = "[用户未登录]";
	} else {
		data.custom_1 = uinfo.nick;
		data.custom_2 = uinfo.uid;
		var contentWeibo = "#江苏人大请你来提问#";
		if (data.custom_4 != "其他") {
			contentWeibo += "#"+data.custom_4+"#";
		}
		contentWeibo += data.custom_5;
		addWeiboByCookie(contentWeibo,"","");
	}	
	
	//DO SUBMIT
	$(".submitBtn").text("提交中...");
	$.JSONP('http://act.city.sina.com.cn/interface/activity/json_add_signup.php',data,function(bm){
		if(bm.error==0){
			alert("提交成功！")
		}else{
			alert(bm.errmsg);
		}
		$(".submitBtn").text("提交");
		canclick = true;
    submitBtn(true);
	});

});

function checkForm() {
	data.custom_3 = "[条目被移除]";
	/* 
	data.custom_3 = $("input[name=title]").val().trim();
	if (data.custom_3 === "") {
		$("input[name=title]").focus();
		alert("您还没有填写 献策标题");
		return false;
	}
	 */
	 
	//data.custom_4 = $("input[name=pid]:radio:checked").val();
	if (data.custom_4 == "" |data.custom_4 == "[类型]" ) {
		$("input[name=pid]").focus();
		alert("请选择一个建言分类");
		return false;
	}
	
	data.custom_5 = $("textarea[name=content]").val();
	//data.custom_5 = $("#formContent").val();
	if (data.custom_5 === "") {
		$("input[name=content]").focus();
		alert("请填写 建言内容");
		return false;
	}
	
	return true;
}

$(function() {
	//填充用户留言
	$.JSONP('http://act.city.sina.com.cn/interface/activity/json_get_user_works.php',{act_id:data.act_id,pcount:10,p:currentPage},function(json){
		listNum = json.count;
		var html = "";
		for(var i=0; i<json.data.length; i++){
			var uname = json.data[i].form_data.custom_1.value;
			var uid = json.data[i].form_data.custom_2.value;
			var type = json.data[i].form_data.custom_4.value;
			var text = json.data[i].form_data.custom_5.value;
			var time = json.data[i].create_time;
			var time_format = time.substr(0,4)+"年"+time.substr(5,2)+"月"+time.substr(8,2)+"日"+" "+time.substr(11);
			
			if (uname == "[用户未登录]") {
				var ip10 = parseInt(json.data[i].create_ip);
				var ip16 = ip10.toString(16);
				var ipStr = parseInt(ip16.substr(0,2),16)+"."+"*"+"."+parseInt(ip16.substr(4,2),16)+"."+parseInt(ip16.substr(6,2),16);
				//var ipStr = parseInt(ip16.substr(0,2),16)+"."+parseInt(ip16.substr(2,2),16)+"."+parseInt(ip16.substr(4,2),16)+"."+parseInt(ip16.substr(6,2),16);
				uname = ipStr;
			}
			
			html += '<div class="card">';
			html += '<div class="name">新浪网友：【'+uname+'】 ['+type+']</div>';
			html += '<div class="text">'+text+'</div>';
			html += '<div class="time">'+time_format+'</div>';
			html += '</div>';
		}
		$(".msgListsBox").html(html);
		currentPage++;
		lmcanclick = true;
	});
});

$(function() {
	$(".loadMore").unbind().bind("click",function(){
		if(!lmcanclick){
			return;
		}
		lmcanclick = false;
		loadMoreBtn(false);
		$(".loadMore").text("请稍候...");
		$.JSONP('http://act.city.sina.com.cn/interface/activity/json_get_user_works.php',{act_id:data.act_id,pcount:10,p:currentPage},function(json){
			var html = "";
			for(var i=0; i<json.data.length; i++){
				var uname = json.data[i].form_data.custom_1.value;
				var uid = json.data[i].form_data.custom_2.value;
				var type = json.data[i].form_data.custom_4.value;
				var text = json.data[i].form_data.custom_5.value;
				var time = json.data[i].create_time;
				var time_format = time.substr(0,4)+"年"+time.substr(5,2)+"月"+time.substr(8,2)+"日"+" "+time.substr(11);
				
				if (uname == "[用户未登录]") {
					var ip10 = parseInt(json.data[i].create_ip);
					var ip16 = ip10.toString(16);
					var ipStr = parseInt(ip16.substr(0,2),16)+"."+"*"+"."+parseInt(ip16.substr(4,2),16)+"."+parseInt(ip16.substr(6,2),16);
					//var ipStr = parseInt(ip16.substr(0,2),16)+"."+parseInt(ip16.substr(2,2),16)+"."+parseInt(ip16.substr(4,2),16)+"."+parseInt(ip16.substr(6,2),16);
					uname = ipStr;
				}
				
				html += '<div class="card">';
				html += '<div class="name">新浪网友：【'+uname+'】 ['+type+']</div>';
				html += '<div class="text">'+text+'</div>';
				html += '<div class="time">'+time_format+'</div>';
				html += '</div>';
			}
			$(".msgListsBox").append(html);
			
			//是否还有内容加载
			if (currentPage*10<listNum) {
				lmcanclick = true;
				$(".loadMore").text("加载更多");
				loadMoreBtn(true);
			}else {
				$(".loadMore").text("没有更多了");
			}
			
			currentPage++;
		});
		
		
	});
});


function loadMoreBtn(bollean) {
	var dom = $(".loadMore");
	if (bollean) {
		dom.removeClass("disabled");
	}else{
		dom.addClass("disabled");
	}
}

function submitBtn(bollean) {
	  var dom = $(".submitBtn");
	  if (bollean) {
	    dom.removeClass("disabled");
	  }else{
	    dom.addClass("disabled");
	  }
	}

</script>
</html>