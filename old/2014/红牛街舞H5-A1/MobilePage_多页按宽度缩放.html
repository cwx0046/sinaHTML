<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="cache-control" content="no-cache"/>
<meta name="format-detection" content="telephone=no"/>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"> 
<title>红牛街舞挑战赛</title>
<meta name="keywords" content="红牛,街舞,挑战赛" />
<meta name="description" content="红牛街舞挑战赛" />
<script src="http://i2.sinaimg.cn/cj/dfz/js/base.js" type="text/javascript"></script>
<!-- 
<script src="http://jiangsu.sinaimg.cn/js/jquery.transit.min.js"></script>
 -->
 <!--please don't change the order of these scripts-->
<script type="text/javascript" src="http://ria.city.sina.com.cn/s/g=dialog_login_v1.1-sp1.js"></script>
<script type="text/javascript" src="http://i.sso.sina.com.cn/js/ssologin.js"></script>
<script type="text/javascript" src="http://i.sso.sina.com.cn/js/sinaSSOManager.js" charset="utf-8"></script>
<link type="text/css" href="http://ria.city.sina.com.cn/s/g=dialog_login_v1.1-sp1.css" rel="stylesheet" media="all" />
<link rel="stylesheet" href="http://jiangsu.sinaimg.cn/js/idangerous.swiper.css">
<script src="http://jiangsu.sinaimg.cn/js/idangerous.swiper.min.js"></script>
<style type="text/css">
body, ul, ol, li, p, h1, h2, h3, h4, h5, h6, table, td, th, form, fieldset, img, dl, dt, dd { margin:0; padding:0; }
textarea, input, select, body { font-size:12px; }
select, input { vertical-align:middle; }
fieldset, img { border:0; }
ul, ol { list-style:none; }
img { border:0; }
a { text-decoration:none; color:#000; }
a:hover { color:#ffa10d; }
.fl { float:left; display:inline; }
.fr { float:right; display:inline; }
.cb { clear:both; display:block; height:0px; overflow:hidden; width:100%; }
.clearfix:after { clear:both; content:""; display:block; height:0; }
</style>
<!-- 自适应缩放css -->
<style type="text/css">
body{ overflow-x: hidden; background-color: #2a2a2c; }
.swiper-container{ width: 640px; height: 960px; -webkit-transform-origin: top left; margin: 0; background-color: #2a2a2c; }
.swiper-wrapper *{ -webkit-backface-visibility: hidden; } /* 避免ip4Safari闪动 */
.page-provider{ position:absolute;top:0; text-align: center; width: 100%; font-size: 24px;line-height: 80px; color: #e5d2d4; }
.page-provider#page-provider-bottom{ top:auto; bottom: 0; }
.swiper-slide{ width: 640px; height: 960px; position: relative; overflow: hidden; }
</style>
<!-- end 自适应缩放css -->
<style type="text/css">
body{ font-size: 24px; font-family: "microsoft yahei";}
.btn{width:184px; height: 50px; line-height: 50px; text-align: center; color:#FFF; cursor: pointer; 
border-radius: 8px / 6px;-webkit-background-clip: padding-box;background-color: RGBA(35,36,38,0.9);
-webkit-box-shadow: 0 4px 0 rgba(24,25,29,.75), inset 0 2px 0 rgba(60,62,61,.75);}
.popup .btn{ width: 328px;height: 55px; line-height:55px; border-radius: 5px;background-color: #49454b; color: #FFF;text-align: center; color: #FFF; margin: 0 auto;}
.abs{ position: absolute;}
.text_nextpage{ left: 524px; top: 879px; color: RGBA(255,255,255,0.9);}
.subTitle{ color: #f7b732; text-align: center; margin-top: 171px; font-weight: bold;}
.pageContent{ margin: 0 auto; margin-top: 12px; width: 522px; height: 604px;
color:#FFF;padding: 18px;
overflow-y:scroll;
line-height: 42px;
border-radius: 10px;
-webkit-background-clip: padding-box;
background-color: RGBA(0,0,0,0.3);
}
.pageContent table td{ line-height: 40px;}
.pageContent th{ letter-spacing: 1em;}


#s1{ background-image: url("http://jiangsu.sinaimg.cn/2014/1030/U9263P1194DT20141030182716.jpg"); }
#s2,#s3,#s4,#s5{ background-image: url("http://jiangsu.sinaimg.cn/2014/1030/U9263P1194DT20141030182717.jpg"); }

#s1 .e1_1{ margin: 0 auto; width: 184px; margin-top: 576px;}
#s1 .e1_1 li{ margin-bottom: 21px; color: #fdd121; }
  
#s5 .e5_1 label{ min-width: 168px; float: left; }
#s5 .e5_1 input[type=radio]{ width: 20px;height: 20px;margin-bottom: 4px;}
#s5 .e5_2{margin: 0 auto;margin-top: 8px;}
#s5 .popup{ position:absolute; top:0; left:0; width: 100%; height: 100%; background-color: RGBA(0,0,0,0.5);}
#s5 .popup .r_content{ width:418px; margin: 0 auto; border-radius: 5px; background-color: #000;  text-align: center; color: #FFF; display: table;}

#s5 #reusult_wrong .r_content{ margin-top: 300px; }
#s5 #reusult_wrong .btn{ margin-bottom: 20px; }

#s5 #reusult_right .r_content{ margin-top: 163px; height: 710px;}
#s5 #reusult_right .guajiangqu{  width: 328px;height: 84px; line-height:84px; text-align:center; border-radius: 5px / 8px;background-color: #fff; margin: 0 auto;margin-top:44px;}
#s5 #reusult_right .guajiangqu #prize{  width: 328px;height: 84px; position: absolute; color: #000;}
#s5 #reusult_right .guajiangqu #scratchpad{  width: 328px;height: 84px; position: absolute;}
#s5 #reusult_right .award_win input{ width: 328px;height: 62px;font-size:32px;text-align:center;color: #000;margin: 0 auto;border-radius: 5px / 6px;background-color: #fff; padding: 0; margin-bottom: 18px;}
#s5 #reusult_right .award_win input{ width: 328px;height: 62px;font-size:32px;text-align:center;color: #000;margin: 0 auto;border-radius: 5px / 6px;background-color: #fff; padding: 0; margin-bottom: 18px;}
#s5 #reusult_right .award_win .submitBtn{ width: 184px;height: 50px;line-height: 50px; color:#FFF; text-align:center;margin:0 auto; border-radius: 8px / 6px; cursor:pointer;
-webkit-box-shadow: 0 4px 0 rgba(24,25,29,.75), inset 0 2px 0 rgba(60,62,61,.75);
box-shadow: 0 4px 0 rgba(24,25,29,.75), inset 0 2px 0 rgba(60,62,61,.75);
background-image: -webkit-linear-gradient(bottom, #00601b 0%, #e10019 100%);
background-image: linear-gradient(bottom, #00601b 0%, #e10019 100%);
}
#s5 #reusult_right .award_no .btn{ margin-top: 40px;}

</style>
<!-- Initialize swiper -->
<script type="text/javascript">
var mySwiper;

window.onload = function() {
	mySwiper = new Swiper('.swiper-container',{
		// options
		mode:'horizontal',
		mousewheelControl: true,
		onSlideChangeEnd : Swipercallback
	});  
}

/* SlideChangeEndCallback */
function Swipercallback(p){
    var act = p.activeIndex; //slideEndIndex
    // todo sth...
}
</script>
</head>
<body>
<audio id="bgm" src="http://jiangsu.sinaimg.cn/zt/s/music/BeatIt1.mp3" autoplay="autoplay" loop style="display: none; width: 0; height: 0;"></audio>
	<!-- 
	* 说明：
	* 多页面滑动模板，适用于 类ppt 页面
	* 页面 640x960 按宽度缩放
	* 使用 idangerous.swiper 插件切换页面 ，参数请在下方 【Initialize swiper】中自行更改
	*
	 -->
	<div class="swiper-container">
		<!-- 底层 -->
		<div class="page-provider" id="page-provider-top">新浪江苏 SINA 2014</div>
		<div class="page-provider" id="page-provider-bottom">新浪江苏 SINA 2014</div>
		
		<div class="swiper-wrapper">
		    <!--First Slide-->
			<div class="swiper-slide" id="s1">
				<ul class="e1_1">
					<li onclick="mySwiper.swipeTo(1);" class="btn">活动介绍</li>
					<li onclick="mySwiper.swipeTo(2);" class="btn">比赛规则</li>
					<li onclick="mySwiper.swipeTo(3);" class="btn">活动日程</li>
					<li onclick="mySwiper.swipeTo(4);" class="btn">答题抽奖</li>
				</ul>
				<div class="abs text_nextpage">>>下一页</div>
			</div>
			
			<!--Second Slide-->
			<div class="swiper-slide" id="s2">
				<div class="subTitle">·　活动介绍　·</div>
				<div class="e2_1 pageContent">
				为决出街舞四大舞种的最强舞者，2014年Hit Top分站赛选拔由先前的7 to smoke耐力赛制及Fight for your city城市团体赛制变为最纯粹的Popping 1on1、Hiphop 1on1、Breaking 3on3、Locking 2on2四大舞种单项对抗赛。<br/>
				同时，为了吸引更多的街舞爱好者踏入Hit Top战场，选手报名条件进一步放宽，12周岁以上，不限国籍，不设报名费；<br/>
				来自美国、法国、韩国的街舞四天王，Popping风格灵魂级人物Jr.boogaloo、Locking风格创始人Gemini、美国舞林争霸明星选手Comfort、韩国BreakingOGBboy Street将作为广州、成都、南京、武汉、北京、上海、郑州、长春等八站分站赛的赛事评委。并于12月14日在北京举办全国总决赛。<br/>
				比赛奖金也相当丰厚呦，南京站：POPPING/HIPHOP冠军：3000元现金+ 红牛大礼；LOCKING冠军：6000元现金+ 红牛大礼包；BREAKING冠军：9000元现金+红牛大礼包！<br/>
				</div><br/>
				<div class="abs text_nextpage">>>下一页</div>
			</div>
			
			<!--Third Slide-->
			<div class="swiper-slide" id="s3">
				<div class="subTitle">·　比赛规则　·</div>
				<div class="e3_1 pageContent">
				POPPING/HIPHOP海选方式：<br/>
				海选将以各自表演的形式， 通过F.A.T.E（foundation, artistic，technique，execution）四个维度进行评比，每个维度满分10分，由各自舞种的裁判通过打分，前16名队伍为晋级的选手。
				<br/>
				晋级决赛方式（16进8进4进2进1）<br/>
				对战淘汰将以对战的形式进行，采用直接淘汰制度分组进行，通过F.A.T.E.S（foundation, artistic，technique，execution，strategy）五个维度进行评比，评委直接判定胜利一方队伍；胜利者直接进入4强！再对战到2强！直到最后的冠军<br/>
				<br/>
				LOCKING/BREAKING比赛方式<br/>
				将以抽签方式决定对阵顺序，以BATTLE形式采用直接淘汰制度进行，通过F.A.T.E.S（foundation, artistic，technique，execution，strategy）五个维度进行评比，评委直接判定胜利一方队伍；胜利者直接进入4强！再对战到2强！直到最后的冠军<br/>
				<br/>
				评分标准：<br/>
				1） 音乐要求：<br/>
				 由专业DJ负责音乐播放，不同舞种播放由DJ控制；<br/>
				2） 评分标准：<br/>
				通过F.A.T.E.S（foundation, artistic，technique，execution，strategy）五个维度进行评比，每个维度满分10分，由各自舞种的裁判通过综合打分评出胜方（8强前每人出1轮，四强到决赛每人2轮，每轮45秒）。
				</div>
				<div class="abs text_nextpage">>>下一页</div>
			</div>
			
			<!--4 Slide-->
			<div class="swiper-slide" id="s4">
				<div class="subTitle">·　活动日程　·</div>
				<div class="e4_1 pageContent">
					<table>
						<tr>
							<th width="200">时间</th>
							<th>内容</th>
						</tr>
						<tr><td>10：00-12：20</td><td>选手登记报名、抽发号码牌</td></tr>
						<tr><td>12：30-12：35</td><td>开场舞表演</td></tr>
						<tr><td>12：35-15：35</td><td>各舞种海选（16强）</td></tr>
						<tr><td>15：40-16：00</td><td>各舞种二次海选</td></tr>
						<tr><td>16：00-18：00</td><td>各舞种16进8</td></tr>
						<tr><td>18：00-19：30</td><td>休息</td></tr>
						<tr><td>19：30-19：40</td><td>开场舞表演</td></tr>
						<tr><td>19：40-20：40</td><td>各舞种8进4</td></tr>
						<tr><td>20：40-21：20</td><td>各舞种4进2</td></tr>
						<tr><td>21：20-21：30</td><td>Judge Showcase</td></tr>
						<tr><td>21：30-21：50</td><td>各舞种决赛</td></tr>
						<tr><td>21：50-22：00</td><td>颁奖、合影</td></tr>
					</table>
				</div>
				<div class="abs text_nextpage">>>下一页</div>
			</div>
			
			<!--5 Slide-->
			<div class="swiper-slide" id="s5">
				<div class="subTitle">·　答题抽奖　·</div>
				<div class="e5_1 pageContent">
					<span style="color: #fdd121;">你现在对活动有多大了解呢？让红牛宝贝来考考你~全部答对即可获得抽奖机会呦，奖品是11月2日在太阳宫举办的红牛街舞挑战赛南京赛区门票2张！</span><br/>
					<br/>
					1、2014红牛街舞挑战赛南京赛区将在哪里落地？<br/>
					<label><input type="radio" name="q1" value="太阳宫第一吧"/>太阳宫第一吧</label>
					<label style="min-width: 158px;"><input type="radio" name="q1" value="奥体中心"/>奥体中心</label>
					<label><input type="radio" name="q1" value="五台山体育馆"/>五台山体育馆</label>
					<br/>
					<br/>
					2、本次比赛中，Breaking舞步比赛采用的是（）人对战（）   人的比赛形式？<br/>
					<label><input type="radio" name="q2" value="1"/>1</label>
					<label><input type="radio" name="q2" value="2"/>2</label>
					<label><input type="radio" name="q2" value="3"/>3</label>
					<br/>
					<br/>
					3、以下哪个舞种没有设置在本次比赛中？<br/>
					<label><input type="radio" name="q3" value="Popping"/>Popping</label>
					<label><input type="radio" name="q3" value="Locking"/>Locking</label>
					<label><input type="radio" name="q3" value="Jazz"/>Jazz</label>
					<br/>
					<br/>
					4、红牛街舞挑战赛什么时间将在南京举行？<br/>
					<label><input type="radio" name="q4" value="11月1日"/>11月1日</label>
					<label><input type="radio" name="q4" value="11月2日"/>11月2日</label>
					<label><input type="radio" name="q4" value="11月3日"/>11月3日</label>
					<br/>
					<br/>
					5、2014全国总决赛将在哪里举行？<br/>
					<label><input type="radio" name="q5" value="北京"/>北京</label>
					<label><input type="radio" name="q5" value="南京"/>南京</label>
					<label><input type="radio" name="q5" value="广州"/>广州</label>
				</div>
				
				<div class="e5_2 btn" onclick="submitForm()">提　交</div>
				
				<div id="reusult_wrong" class="abs popup"  style="display: none;">
					<div class="r_content">
						<div style="padding: 100px 0 42px;">很遗憾，您未答对所有题目。<br/>谢谢参与!</div>
						<div class="btn" onclick="$('#reusult_wrong').fadeOut();">再来一次</div>
					</div>
				</div>
				
				<div id="reusult_right" class="abs popup"  style="display: none;">
					<div class="r_content">
						<div style="padding: 42px 0 0px;">
							<p style="font-size: 30px; font-weight: bold;">恭喜你！</p>
							答对了所有问题，<br/>
							获得一次刮奖机会！
						</div>
						<div style="padding: 37px 0 0px; color: #b4eb4b;">
							将有机会获得11月2日在南京<br/>
							太阳宫举办的红牛街舞<br/>
							挑战赛门票2张！<br/>
						</div>
						<div class="guajiangqu">
							<div id="prize">
							</div>
							<div id="scratchpad">
							</div>
						</div>
						
						<div class="award_win" style="display: none;">
							<div style="text-align: center; line-height: 53px; color: #a6a6a6;">凭姓名和手机号11月2日现场领取</div>
							<input type="text" id="bm-name" placeholder="姓名">
							<input type="tel" id="bm-phone" placeholder="手机号">
							<div class="submitBtn" onclick="addUser()">提交</div>
						</div>
						<div class="award_no" style="display: none;">
							<div class="btn" onclick="$('#reusult_right').fadeOut();">确定</div>
						</div>
					</div>
				</div>
			</div>
			<!--Etc..-->
			
		</div>
	</div>
</body>

<!-- page Auto scale -->
<script type="text/javascript">
	$(function() {
		pageAutoScale();
	});
	$(window).resize(function() {
		pageAutoScale();
	});
	var r;
	function pageAutoScale(){
		r = document.body.offsetWidth / 640;
		$(".swiper-container").css("-webkit-transform", "scale(" + r + ")");
		$("body").height( window.innerHeight ); //修正整数页面高度
		//if (window.innerHeight<=960*r) {  //当用户显示区域小于960高度时，调整每页高度。
			//$(".swiper-container").css("height", parseInt( window.innerHeight / r) );
			// $(".btnBottom").css("top",(window.innerHeight / r - parseInt($(".btnBottom").css("bottom")) ) );  //滑动提示箭头
			// $("#page-provider-bottom").css({"top":(window.innerHeight / r ) - $("#page-provider-bottom").height() , "bottom" : "auto"});  //服务提供商置于可视区域bottom
		//}
	}
</script>
<script type="text/javascript">
$(".text_nextpage").click(function() {
	mySwiper.swipeNext();
});

</script>
<!-- Touch to play BGM. -->
<script type="text/javascript">
$('body').live("touchstart",function(e){  
	document.getElementById('bgm').play();
}, false);
</script>



<!-- 刮刮卡 -->
<script type="text/javascript">
var num = 0;
var goon = true;
var iswin = false;
var prizeSit = '';
function getPrize()
{
	$("#scratchpad").wScratchPad({
		width: 328,
		height: 84,
		size: 15,
		color: "#a9a9a7",
		scratchMove: function() {
			num++;
			$("#prize").html(prizeSit);
			if (num == 2) {
				//设置奖品
				if(prizeSit == "红牛街舞挑战赛门票2张！"){
					iswin = true;
				}else{
					iswin = false;
				}
			}else
			if (num > 60 && goon) {
				//刮开回调
				goon = false;
				if(iswin){ 
					$(".award_win").fadeIn();				
				}else{
					$(".award_no").fadeIn();				
				}
			}
		}
	});	
}
</script>

<!-- 题目检查 -->
<script type="text/javascript">
function submitForm() {
	
	var q1 = $("#s5 input[name=q1]:checked").val();
	var q2 = $("#s5 input[name=q2]:checked").val();
	var q3 = $("#s5 input[name=q3]:checked").val();
	var q4 = $("#s5 input[name=q4]:checked").val();
	var q5 = $("#s5 input[name=q5]:checked").val();
	
	if(  q1 == undefined
		|q2 == undefined
		|q3 == undefined
		|q4 == undefined
		|q5 == undefined
	){
		alert('您还有题目没作答呢');
		return;
	}
	
	if(  q1 != '太阳宫第一吧'
		|q2 != '3'
		|q3 != 'Jazz'
		|q4 != '11月2日'
		|q5 != '北京'
	){
		$('#reusult_wrong').fadeIn();
		return;
	}	
	
	$(".award_win,.award_no").hide();
	
	
	num = 0;
	goon = true;
	iswin = false;
	
	function openLoginDialog(){DFZ.APP.DialogLogin.open();$("#ui-dialog-title-1").html("新浪微博登录");}
	var uinfo = sinaSSOManager.getSinaCookie();
	if (!uinfo) {
		openLoginDialog();
		return false;
	} 
	
	
	$.JSONP('http://act.city.sina.com.cn/interface/activity/json_add_vote.php',{
		id : 1954641
	}, function(bm) { //返回结果
		if (bm.error == 0) {
			//抽奖
			//判断是否中奖
			if (bm.draw.is_win == 1) {
				prizeSit = "红牛街舞挑战赛门票2张！";
				//中奖
				iswin = true;
			} else {
				prizeSit = "谢谢参与";
				// 没中奖
				iswin = false;
			}
			$("#scratchpad").html("");
			getPrize();
			$("#reusult_right").fadeIn();
		} else {
			alert('1分钟只能提交1次哦');
			//alert(bm.errmsg);
		}
	});
}
</script>

<!-- 提交中奖用户 -->
<script type="text/javascript">
function addUser() {
    var name = $("#bm-name").val();
    var custom_0 = $("#bm-phone").val();
    var partten = /^1[3,5,8]\d{9}$/;
    if((name=="") || (name=="请输入姓名")){alert("请输入姓名！"); return false;}
    if(!partten.test(custom_0)){alert("请填写正确的手机号！"); return false;}

    $.JSONP('http://act.city.sina.com.cn/interface/activity/json_add_signup.php',{
	    act_id:8310,
	    custom_1:name,
	    custom_2:custom_0
	},function(bm){
        if(bm.error==0){
            alert("提交成功");
			$("#reusult_right").fadeOut();
        }else{
        	alert(bm.errmsg);
        }
    }); 
	
}
</script>


<!-- wScratchPad.js -->
<script type="text/javascript">
/******************************************
 * Websanova.com
 *
 * Resources for web entrepreneurs
 *
 * @author          Websanova
 * @copyright       Copyright (c) 2012 Websanova.
 * @license         This wScratchPad jQuery plug-in is dual licensed under the MIT and GPL licenses.
 * @link            http://www.websanova.com
 * @github			http://github.com/websanova/wScratchPad
 * @version         Version 1.4.2
 *
 ******************************************/
(function($)
{
	$.fn.wScratchPad = function(option, settings)
	{
		if(typeof option === 'object')
		{
			settings = option;
		}
		else if(typeof option == 'string')
		{
			var values = [];

			var elements = this.each(function()
			{
				var data = $(this).data('_wScratchPad');

				if(data)
				{
					if(option === 'reset') { data.reset(); }
					else if(option === 'clear') { data.clear(); }
					else if(option === 'enabled') { data.enabled = settings === true; }
					else if($.fn.wScratchPad.defaultSettings[option] !== undefined)
					{
						if(settings !== undefined) { data.settings[option] = settings; }
						else { values.push(data.settings[option]); }
					}
				}
			});

			if(values.length === 1) { return values[0]; }
			if(values.length > 0) { return values; }
			else { return elements; }
		}
		
		settings = $.extend({}, $.fn.wScratchPad.defaultSettings, settings || {});

		return this.each(function()
		{
			var elem = $(this);
			var $settings = jQuery.extend(true, {}, settings);

			//test for HTML5 canvas
			var test = document.createElement('canvas');
			if(!test.getContext)
			{
				elem.html("Browser does not support HTML5 canvas, please upgrade to a more modern browser.");
				return false;	
			}

			var sp = new ScratchPad($settings, elem);
			
			elem.append(sp.generate());
			
			//get number of pixels of canvas for percent calculations 
			sp.pixels = sp.canvas.width * sp.canvas.height;
			
			elem.data('_wScratchPad', sp);
			
			sp.init();
		});
	};

	$.fn.wScratchPad.defaultSettings =
	{
		width		: 210,						// set width - best to match image width
		height		: 100,						// set height - best to match image height
		image		: null,		// set image path
		image2		: null,						// set overlay image path - if set color is not used
		color		: '#336699',				// set scratch color - if image2 is not set uses color
		overlay		: 'none',					// set the type of overlay effect 'none', 'lighter' - only used with color
		size		: 10,						// set size of scratcher
		scratchDown	: null,						// scratchDown callback
		scratchUp	: null,						// scratchUp callback
		scratchMove	: null,						// scratcMove callback
		cursor		: null						// Set path to custom cursor
	};
	
	function ScratchPad(settings, elem)
	{
		this.sp = null;
		this.settings = settings;
		this.$elem = elem;
		
		this.enabled = true;
		this.scratch = false;
		
		this.canvas = null;
		this.ctx = null;
		
		return this;
	}
	
	ScratchPad.prototype = 
	{
		generate: function()
		{
			var $this = this;
			
			this.canvas = document.createElement('canvas');
			this.ctx = this.canvas.getContext('2d');
			
			this.sp =
			$('<div></div>')
			.css({position: 'relative'})
			.append(
				$(this.canvas)
				.attr('width', this.settings.width + 'px')
				.attr('height', this.settings.height + 'px')
			)
			
			$(this.canvas)
			.mousedown(function(e)
			{
				if(!$this.enabled) return true;

				e.preventDefault();
				e.stopPropagation();
				
				//reset canvas offset in case it has moved
				$this.canvas_offset = $($this.canvas).offset();
				
				$this.scratch = true;
				$this.scratchFunc(e, $this, 'Down');
			})
			.mousemove(function(e)
			{
				e.preventDefault();
				e.stopPropagation();
				
				if($this.scratch) $this.scratchFunc(e, $this, 'Move');
			})
			.mouseup(function(e)
			{
				e.preventDefault();
				e.stopPropagation();
				
				//make sure we are in draw mode otherwise this will fire on any mouse up.
				if($this.scratch)
				{
					$this.scratch = false;
					$this.scratchFunc(e, $this, 'Up');
				}
			});

			this.bindMobile(this.sp);
			
			return this.sp;
		},
		
		bindMobile: function($el)
		{
			$el.bind('touchstart touchmove touchend touchcancel', function ()
			{
				var touches = event.changedTouches, first = touches[0], type = ""; 
				event.preventDefault();
				event.stopPropagation();
				switch (event.type)
				{
					case "touchstart": type = "mousedown"; break; 
					case "touchmove": type = "mousemove"; break; 
					case "touchend": type = "mouseup"; break; 
					default: return;
				}

				var simulatedEvent = document.createEvent("MouseEvent"); 

				simulatedEvent.initMouseEvent(type, true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY, false, false, false, false, 0/*left*/, null);
				first.target.dispatchEvent(simulatedEvent);
				event.preventDefault();
			});
		},

		init: function()
		{
			this.sp.css('width', this.settings.width);
			this.sp.css('height', this.settings.height);
			this.sp.css('cursor', (this.settings.cursor ? 'url("' + this.settings.cursor + '"), default' : 'default'));

			$(this.canvas).css({cursor: (this.settings.cursor ? 'url("' + this.settings.cursor + '"), default' : 'default')});
			
			this.canvas.width = this.settings.width;
			this.canvas.height = this.settings.height;
			
			this.pixels = this.canvas.width * this.canvas.height;
			
			if(this.settings.image2)
			{
				this.drawImage(this.settings.image2);
			}
			else
			{
				if(this.settings.overlay != 'none')
				{
					if(this.settings.image)
					{
						this.drawImage(this.settings.image);
					}
					this.ctx.globalCompositeOperation = this.settings.overlay;
				}
				else
				{
					this.setBgImage();
				}
				
				this.ctx.fillStyle = this.settings.color;
				this.ctx.beginPath();
				this.ctx.rect(0, 0, this.settings.width, this.settings.height)
				this.ctx.fill();
				this.ctx.fillStyle="#361f29";
				this.ctx.font = "30px Arial";
				this.ctx.fillText('刮开此处',100,50);
			}
		},

		reset: function()
		{
			this.ctx.globalCompositeOperation = 'source-over';
			this.init();
		},

		clear: function()
		{
			this.ctx.clearRect(0, 0, this.settings.width, this.settings.height);
		},

		setBgImage: function()
		{
			if(this.settings.image)
			{
				this.sp.css({backgroundImage: 'url('+this.settings.image+')'});
			}
		},

		drawImage: function(imagePath)
		{
			var $this = this;
			var img = new Image();
  			img.src = imagePath;
  			$(img).load(function(){
  				$this.ctx.drawImage(img, 0, 0);
  				$this.setBgImage();
  			})
		},

		scratchFunc: function(e, $this, event)
		{
			e.pageX = Math.floor(e.pageX - $this.canvas_offset.left);
			e.pageY = Math.floor(e.pageY - $this.canvas_offset.top);
			
			
			$this['scratch' + event](e, $this);
			
			if($this.settings['scratch' + event]) $this.settings['scratch' + event].apply($this, [e, $this.scratchPercentage($this)]);
		},

		scratchPercentage: function($this)
		{
			var hits = 0;
			var imageData = $this.ctx.getImageData(0,0,$this.canvas.width,$this.canvas.height)
			
			for(var i=0, ii=imageData.data.length; i<ii; i=i+4)
			{
				if(imageData.data[i] == 0 && imageData.data[i+1] == 0 && imageData.data[i+2] == 0 && imageData.data[i+3] == 0) hits++;
			}
			
			return (hits / $this.pixels) * 100;
		},

		scratchDown: function(e, $this)
		{
			$this.ctx.globalCompositeOperation = 'destination-out';
			$this.ctx.lineJoin = "round";
			$this.ctx.lineCap = "round";
			$this.ctx.strokeStyle = $this.settings.color;
			$this.ctx.lineWidth = $this.settings.size;
			
			//draw single dot in case of a click without a move
			$this.ctx.beginPath();
			$this.ctx.arc(e.pageX/r, e.pageY/r, $this.settings.size/2, 0, Math.PI*2, true);
			$this.ctx.closePath();
			$this.ctx.fill();
			
			//start the path for a drag
			$this.ctx.beginPath();
			$this.ctx.moveTo(e.pageX/r, e.pageY/r);
		},
		
		scratchMove: function(e, $this)
		{
			$this.ctx.lineTo(e.pageX/r, e.pageY/r);
			$this.ctx.stroke();
		},
		
		scratchUp: function(e, $this)
		{
			$this.ctx.closePath();
		},
	}
})(jQuery);
</script>
</html>
